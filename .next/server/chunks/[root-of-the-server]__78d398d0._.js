module.exports = {

"[project]/.next-internal/server/app/api/patients/[id]/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[project]/src/lib/supabase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "createAdminUser": (()=>createAdminUser),
    "getCurrentUser": (()=>getCurrentUser),
    "signInWithEmail": (()=>signInWithEmail),
    "signOut": (()=>signOut),
    "signUpWithEmail": (()=>signUpWithEmail),
    "supabase": (()=>supabase)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
const supabaseUrl = 'https://zusheijhebsmjiyyeiqq.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1c2hlaWpoZWJzbWppeXllaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MjI0NDAsImV4cCI6MjA2NzM5ODQ0MH0.iwGPaOJPa6OvwX_iA1xvRt5cM72DWfd8Br1pwRTemRc';
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey);
const signInWithEmail = async (email, password)=>{
    const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
    });
    return {
        data,
        error
    };
};
const signUpWithEmail = async (email, password)=>{
    const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
            emailRedirectTo: `${window.location.origin}/auth/callback`
        }
    });
    return {
        data,
        error
    };
};
const createAdminUser = async (email, password)=>{
    const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
            emailRedirectTo: `${window.location.origin}/auth/callback`,
            data: {
                email_confirm: true
            }
        }
    });
    return {
        data,
        error
    };
};
const signOut = async ()=>{
    await supabase.auth.signOut();
};
const getCurrentUser = async ()=>{
    const { data: { user } } = await supabase.auth.getUser();
    return user;
};
}}),
"[project]/src/lib/barcodeUtils.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "extractBarcodeInfo": (()=>extractBarcodeInfo),
    "generateBarcodeForPatient": (()=>generateBarcodeForPatient),
    "generateBarcodeId": (()=>generateBarcodeId),
    "generateBarcodeSVG": (()=>generateBarcodeSVG),
    "generatePrintableBarcodeData": (()=>generatePrintableBarcodeData),
    "generateRealisticBarcodeSVG": (()=>generateRealisticBarcodeSVG),
    "getPatientByBarcodeId": (()=>getPatientByBarcodeId),
    "updatePatientWithBarcode": (()=>updatePatientWithBarcode),
    "validateBarcodeId": (()=>validateBarcodeId)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
;
function generateBarcodeId(uhid) {
    const now = new Date();
    const year = now.getFullYear().toString();
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    // Use UHID as base and add timestamp for uniqueness
    const timestamp = now.getTime().toString().slice(-4); // Last 4 digits of timestamp
    return `BARS${year}${month}${timestamp}`;
}
function generateBarcodeSVG(barcodeId) {
    const width = 300;
    const height = 80;
    const barWidth = 2;
    const barsCount = barcodeId.length * 6; // Approximate for Code-128
    let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;
    // Background
    svg += `<rect width="${width}" height="${height}" fill="white"/>`;
    // Generate bars pattern (simplified)
    let x = 10;
    for(let i = 0; i < barcodeId.length; i++){
        const char = barcodeId[i];
        const charCode = char.charCodeAt(0);
        // Create alternating pattern based on character
        for(let j = 0; j < 6; j++){
            if ((charCode + j) % 2 === 0) {
                svg += `<rect x="${x}" y="10" width="${barWidth}" height="50" fill="black"/>`;
            }
            x += barWidth;
        }
    }
    // Add text below barcode
    svg += `<text x="${width / 2}" y="${height - 10}" text-anchor="middle" font-family="monospace" font-size="12" fill="black">${barcodeId}</text>`;
    svg += '</svg>';
    return svg;
}
function generateRealisticBarcodeSVG(barcodeId) {
    const width = 300;
    const height = 80;
    const minBarWidth = 1;
    const maxBarWidth = 4;
    let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;
    // Background
    svg += `<rect width="${width}" height="${height}" fill="white"/>`;
    // Generate more realistic bar pattern
    let x = 20;
    let isBlack = true;
    // Start and end patterns
    const startPattern = [
        1,
        1,
        1,
        1,
        1,
        1
    ];
    const endPattern = [
        1,
        1,
        1,
        1,
        1,
        1
    ];
    // Draw start pattern
    for (const barWidth of startPattern){
        if (isBlack) {
            svg += `<rect x="${x}" y="10" width="${barWidth}" height="50" fill="black"/>`;
        }
        x += barWidth;
        isBlack = !isBlack;
    }
    // Draw data pattern
    for(let i = 0; i < barcodeId.length; i++){
        const char = barcodeId[i];
        const charCode = char.charCodeAt(0);
        // Create pattern based on character
        const pattern = [];
        for(let j = 0; j < 6; j++){
            const width = minBarWidth + (charCode + j) % (maxBarWidth - minBarWidth + 1);
            pattern.push(width);
        }
        for (const barWidth of pattern){
            if (isBlack) {
                svg += `<rect x="${x}" y="10" width="${barWidth}" height="50" fill="black"/>`;
            }
            x += barWidth;
            isBlack = !isBlack;
        }
    }
    // Draw end pattern
    for (const barWidth of endPattern){
        if (isBlack) {
            svg += `<rect x="${x}" y="10" width="${barWidth}" height="50" fill="black"/>`;
        }
        x += barWidth;
        isBlack = !isBlack;
    }
    // Add text below barcode
    svg += `<text x="${width / 2}" y="${height - 10}" text-anchor="middle" font-family="monospace" font-size="12" fill="black">${barcodeId}</text>`;
    svg += '</svg>';
    return svg;
}
async function updatePatientWithBarcode(patientId, barcodeId) {
    try {
        const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').update({
            barcode_id: barcodeId
        }).eq('patient_id', patientId);
        if (error) {
            console.error('Error updating patient with barcode:', error);
            throw new Error(`Failed to update patient with barcode: ${error.message}`);
        }
    } catch (error) {
        console.error('Error updating patient with barcode:', error);
        throw error;
    }
}
async function getPatientByBarcodeId(barcodeId) {
    try {
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select('*').eq('barcode_id', barcodeId).single();
        if (error) {
            console.error('Error fetching patient by barcode:', error);
            throw new Error(`Patient not found: ${error.message}`);
        }
        return patient;
    } catch (error) {
        console.error('Error fetching patient by barcode:', error);
        throw error;
    }
}
function generatePrintableBarcodeData(uhid, barcodeId, patientName) {
    const svg = generateRealisticBarcodeSVG(barcodeId);
    return `
    <div style="width: 4in; height: 2in; padding: 0.2in; font-family: Arial, sans-serif; border: 1px solid #ccc; margin: 0.1in;">
      <div style="text-align: center; margin-bottom: 0.1in;">
        <h3 style="margin: 0; font-size: 14px; color: #333;">ANNAM HOSPITAL</h3>
        <p style="margin: 0; font-size: 10px; color: #666;">Patient ID Card</p>
      </div>
      <div style="text-align: center; margin-bottom: 0.1in;">
        ${svg}
      </div>
      <div style="text-align: center; font-size: 12px;">
        <p style="margin: 0; font-weight: bold;">${patientName}</p>
        <p style="margin: 0; font-size: 10px; color: #666;">UHID: ${uhid}</p>
      </div>
    </div>
  `;
}
function validateBarcodeId(barcodeId) {
    // Check if it matches the format: BARS{Year}{Month}{4digits}
    const barcodeRegex = /^BARS\d{4}(0[1-9]|1[0-2])\d{4}$/;
    return barcodeRegex.test(barcodeId);
}
function extractBarcodeInfo(barcodeId) {
    if (!validateBarcodeId(barcodeId)) {
        return null;
    }
    const year = barcodeId.substring(4, 8);
    const month = barcodeId.substring(8, 10);
    const sequence = barcodeId.substring(10, 14);
    return {
        year,
        month,
        sequence
    };
}
async function generateBarcodeForPatient(patientId) {
    try {
        // Check if patient already has a barcode
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select('barcode_id, patient_id').eq('patient_id', patientId).single();
        if (error) {
            throw new Error(`Patient not found: ${error.message}`);
        }
        // If patient already has a barcode, return it
        if (patient.barcode_id && patient.barcode_id.trim() !== '') {
            return patient.barcode_id;
        }
        // Generate new barcode
        const barcodeId = generateBarcodeId(patientId);
        // Update patient with barcode
        await updatePatientWithBarcode(patientId, barcodeId);
        return barcodeId;
    } catch (error) {
        console.error('Error generating barcode for patient:', error);
        throw error;
    }
}
}}),
"[project]/src/lib/patientService.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "createInitialAppointment": (()=>createInitialAppointment),
    "createPatientAuthCredentials": (()=>createPatientAuthCredentials),
    "generateUHID": (()=>generateUHID),
    "getAllPatients": (()=>getAllPatients),
    "getPatientByUHID": (()=>getPatientByUHID),
    "getPatientWithRelatedData": (()=>getPatientWithRelatedData),
    "insertPatientRecord": (()=>insertPatientRecord),
    "linkAuthUserToPatient": (()=>linkAuthUserToPatient),
    "registerNewPatient": (()=>registerNewPatient),
    "updatePatientRecord": (()=>updatePatientRecord),
    "validateUHIDUnique": (()=>validateUHIDUnique)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$barcodeUtils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/barcodeUtils.ts [app-route] (ecmascript)");
;
;
async function generateUHID() {
    const now = new Date();
    const yearTwoDigits = now.getFullYear().toString().slice(-2); // Last two digits of year
    const month = (now.getMonth() + 1).toString().padStart(2, '0'); // Month with leading zero
    try {
        // Generate a unique 4-digit random number
        let uhid = '';
        let isUnique = false;
        let attempts = 0;
        const maxAttempts = 1000;
        while(!isUnique && attempts < maxAttempts){
            // Generate 4-digit random number
            const randomNumber = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            uhid = `AH${yearTwoDigits}${month}${randomNumber}`;
            // Check if this UHID already exists
            const { data: existing, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select('patient_id').eq('patient_id', uhid).single();
            if (error && error.code === 'PGRST116') {
                // No record found, UHID is unique
                isUnique = true;
            } else if (error) {
                console.error('Error checking UHID uniqueness:', error);
                throw new Error('Failed to generate UHID');
            }
            attempts++;
        }
        if (!isUnique) {
            throw new Error('Failed to generate unique UHID after maximum attempts');
        }
        return uhid;
    } catch (error) {
        console.error('Error generating UHID:', error);
        throw new Error('Failed to generate UHID');
    }
}
async function createPatientAuthCredentials(uhid) {
    const email = `${uhid}@annam.com`;
    const password = 'password';
    try {
        // Create auth user using Supabase Admin API
        const { data: authUser, error: authError } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].auth.signUp({
            email,
            password,
            options: {
                emailRedirectTo: `${window.location.origin}/auth/callback`,
                data: {
                    role: 'patient',
                    uhid: uhid,
                    email_confirm: true
                }
            }
        });
        if (authError) {
            console.error('Error creating auth user:', authError);
            throw new Error(`Failed to create authentication: ${authError.message}`);
        }
        return {
            authUser: authUser.user,
            credentials: {
                email,
                password
            }
        };
    } catch (error) {
        console.error('Error creating patient auth credentials:', error);
        throw error;
    }
}
async function insertPatientRecord(uhid, registrationData, userId) {
    try {
        const fullName = `${registrationData.firstName} ${registrationData.lastName}`;
        // Generate barcode ID
        const barcodeId = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$barcodeUtils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateBarcodeId"])(uhid);
        // Prepare admission date and time
        let admissionDateTime = null;
        if (registrationData.admissionDate) {
            if (registrationData.admissionTime) {
                admissionDateTime = `${registrationData.admissionDate}T${registrationData.admissionTime}`;
            } else {
                admissionDateTime = `${registrationData.admissionDate}T00:00:00`;
            }
        }
        const patientData = {
            // Basic Information
            patient_id: uhid,
            barcode_id: barcodeId,
            name: fullName,
            date_of_birth: registrationData.dateOfBirth,
            gender: registrationData.gender.toLowerCase(),
            marital_status: registrationData.maritalStatus || null,
            phone: registrationData.phone,
            email: registrationData.email || `${uhid}@annam.com`,
            address: registrationData.address,
            // Medical Information
            blood_group: registrationData.bloodGroup || null,
            allergies: registrationData.allergies || null,
            medical_history: registrationData.medicalHistory || null,
            current_medications: registrationData.currentMedications || null,
            chronic_conditions: registrationData.chronicConditions || null,
            previous_surgeries: registrationData.previousSurgeries || null,
            // New Admission Information
            admission_date: admissionDateTime,
            admission_time: registrationData.admissionTime || null,
            primary_complaint: registrationData.primaryComplaint,
            admission_type: registrationData.admissionType,
            referring_doctor_facility: registrationData.referringDoctorFacility || null,
            department_ward: registrationData.departmentWard || null,
            room_number: registrationData.roomNumber || null,
            // Guardian/Attendant Details (Optional)
            guardian_name: registrationData.guardianName || null,
            guardian_relationship: registrationData.guardianRelationship || null,
            guardian_phone: registrationData.guardianPhone || null,
            guardian_address: registrationData.guardianAddress || null,
            // Emergency Contact (Optional)
            emergency_contact_name: registrationData.emergencyContactName || null,
            emergency_contact_phone: registrationData.emergencyContactPhone || null,
            emergency_contact_relationship: registrationData.emergencyContactRelationship || null,
            // Insurance Information
            insurance_number: registrationData.insuranceNumber || null,
            insurance_provider: registrationData.insuranceProvider || null,
            // Additional fields
            initial_symptoms: registrationData.initialSymptoms || null,
            referred_by: registrationData.referredBy || null,
            // Link to users table
            user_id: userId || null,
            // System fields
            status: 'active'
        };
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').insert([
            patientData
        ]).select().single();
        if (error) {
            console.error('Error inserting patient record:', error);
            throw new Error(`Failed to create patient record: ${error.message}`);
        }
        return patient;
    } catch (error) {
        console.error('Error inserting patient record:', error);
        throw error;
    }
}
async function linkAuthUserToPatient(authUserId, uhid, registrationData) {
    try {
        const fullName = `${registrationData.firstName} ${registrationData.lastName}`;
        const userData = {
            auth_id: authUserId,
            employee_id: uhid,
            name: fullName,
            email: registrationData.email || `${uhid}@annam.com`,
            role: 'patient',
            phone: registrationData.phone,
            address: registrationData.address,
            status: 'active',
            permissions: {
                patient_portal: true,
                view_own_records: true,
                book_appointments: true
            }
        };
        const { data: user, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('users').insert([
            userData
        ]).select().single();
        if (error) {
            console.error('Error linking auth user to patient:', error);
            throw new Error(`Failed to create user record: ${error.message}`);
        }
        return user;
    } catch (error) {
        console.error('Error linking auth user to patient:', error);
        throw error;
    }
}
async function createInitialAppointment(patientId, registrationData) {
    try {
        if (!registrationData.initialSymptoms?.trim() && !registrationData.primaryComplaint?.trim()) {
            return null; // No appointment needed if no symptoms
        }
        // Generate appointment ID
        const appointmentId = `APT${Date.now()}`;
        // Use tomorrow as default appointment date
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const appointmentData = {
            appointment_id: appointmentId,
            patient_id: patientId,
            appointment_date: tomorrow.toISOString().split('T')[0],
            appointment_time: '09:00:00',
            type: 'consultation',
            status: 'scheduled',
            symptoms: registrationData.initialSymptoms || registrationData.primaryComplaint,
            notes: `Initial consultation for newly registered patient. Primary complaint: ${registrationData.primaryComplaint}`
        };
        const { data: appointment, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('appointments').insert([
            appointmentData
        ]).select().single();
        if (error) {
            console.error('Error creating initial appointment:', error);
            // Don't throw error for appointment creation failure
            return null;
        }
        return appointment;
    } catch (error) {
        console.error('Error creating initial appointment:', error);
        // Don't throw error for appointment creation failure
        return null;
    }
}
async function registerNewPatient(registrationData, preGeneratedUHID) {
    try {
        // Step 1: Use pre-generated UHID or generate new one
        const uhid = preGeneratedUHID || await generateUHID();
        console.log('Using UHID:', uhid);
        // Step 2: Create authentication credentials
        const { authUser, credentials } = await createPatientAuthCredentials(uhid);
        console.log('Created auth user:', authUser?.id);
        // Step 3: Create user record in users table
        const userRecord = await linkAuthUserToPatient(authUser.id, uhid, registrationData);
        console.log('Created user record:', userRecord.id);
        // Step 4: Insert patient record with user_id link
        const patient = await insertPatientRecord(uhid, registrationData, userRecord.id);
        console.log('Created patient record:', patient.id);
        // Step 5: Create initial appointment if symptoms provided
        if (registrationData.initialSymptoms?.trim() || registrationData.primaryComplaint?.trim()) {
            const appointment = await createInitialAppointment(patient.id, registrationData);
            if (appointment) {
                console.log('Created initial appointment:', appointment.id);
            }
        }
        return {
            success: true,
            patient,
            uhid,
            credentials
        };
    } catch (error) {
        console.error('Error registering new patient:', error);
        return {
            success: false,
            error: error instanceof Error ? error.message : 'Unknown error occurred'
        };
    }
}
async function validateUHIDUnique(uhid) {
    try {
        const { data: existingPatient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select('patient_id').eq('patient_id', uhid).single();
        if (error && error.code !== 'PGRST116') {
            console.error('Error validating UHID uniqueness:', error);
            throw new Error('Failed to validate UHID');
        }
        return !existingPatient; // Return true if no existing patient found
    } catch (error) {
        console.error('Error validating UHID uniqueness:', error);
        throw error;
    }
}
async function getPatientByUHID(uhid) {
    try {
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select('*').eq('patient_id', uhid).single();
        if (error) {
            console.error('Error fetching patient by UHID:', error);
            throw new Error(`Patient not found: ${error.message}`);
        }
        return patient;
    } catch (error) {
        console.error('Error fetching patient by UHID:', error);
        throw error;
    }
}
async function getPatientWithRelatedData(uhid) {
    try {
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select(`
        *,
        users:user_id (
          id,
          name,
          email,
          role,
          status,
          permissions
        ),
        appointments:appointments(
          id,
          appointment_id,
          appointment_date,
          appointment_time,
          type,
          status,
          symptoms,
          diagnosis,
          doctor:doctors(
            id,
            user:users(name, specialization)
          )
        ),
        bed_allocations:bed_allocations(
          id,
          admission_date,
          discharge_date,
          admission_type,
          status,
          bed:beds(bed_number, room_number, bed_type),
          doctor:doctors(
            id,
            user:users(name, specialization)
          )
        )
      `).eq('patient_id', uhid).single();
        if (error) {
            console.error('Error fetching patient with related data:', error);
            throw new Error(`Patient not found: ${error.message}`);
        }
        return patient;
    } catch (error) {
        console.error('Error fetching patient with related data:', error);
        throw error;
    }
}
async function updatePatientRecord(uhid, updateData) {
    try {
        const { data: patient, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').update(updateData).eq('patient_id', uhid).select().single();
        if (error) {
            console.error('Error updating patient record:', error);
            throw new Error(`Failed to update patient: ${error.message}`);
        }
        return patient;
    } catch (error) {
        console.error('Error updating patient record:', error);
        throw error;
    }
}
async function getAllPatients(options = {}) {
    try {
        const { page = 1, limit = 20, status, searchTerm } = options;
        const offset = (page - 1) * limit;
        let query = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('patients').select(`
        *,
        users:user_id (
          id,
          name,
          email,
          role,
          status,
          permissions
        )
      `, {
            count: 'exact'
        });
        // Apply filters
        if (status) {
            query = query.eq('status', status);
        }
        if (searchTerm) {
            query = query.or(`name.ilike.%${searchTerm}%,patient_id.ilike.%${searchTerm}%,phone.ilike.%${searchTerm}%`);
        }
        // Apply pagination
        const { data: patients, error, count } = await query.range(offset, offset + limit - 1).order('created_at', {
            ascending: false
        });
        if (error) {
            console.error('Error fetching patients:', error);
            throw new Error(`Failed to fetch patients: ${error.message}`);
        }
        return {
            patients: patients || [],
            total: count || 0,
            page,
            limit
        };
    } catch (error) {
        console.error('Error fetching patients:', error);
        throw error;
    }
}
}}),
"[project]/app/api/patients/[id]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET),
    "PATCH": (()=>PATCH)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$patientService$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/patientService.ts [app-route] (ecmascript)");
;
;
async function GET(request, { params }) {
    try {
        const { id } = params;
        if (!id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Patient ID is required'
            }, {
                status: 400
            });
        }
        const patient = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$patientService$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getPatientByUHID"])(id);
        if (!patient) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Patient not found'
            }, {
                status: 404
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            patient
        });
    } catch (error) {
        console.error('Error fetching patient:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch patient'
        }, {
            status: 500
        });
    }
}
async function PATCH(request, { params }) {
    try {
        const { id } = await params;
        if (!id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Patient ID is required'
            }, {
                status: 400
            });
        }
        const updateData = await request.json();
        console.log('Received update data:', updateData);
        if (!updateData || Object.keys(updateData).length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Update data is required'
            }, {
                status: 400
            });
        }
        // Validate required fields - only firstName is mandatory
        if (updateData.firstName !== undefined && (!updateData.firstName || updateData.firstName.trim() === '')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'First name is required'
            }, {
                status: 400
            });
        }
        // Map frontend fields to database fields
        const mappedData = {};
        // Combine firstName and lastName into name field
        if (updateData.firstName || updateData.lastName) {
            const firstName = updateData.firstName || '';
            const lastName = updateData.lastName || '';
            mappedData.name = `${firstName} ${lastName}`.trim();
        }
        // Map other fields that exist in database
        const fieldMapping = {
            dateOfBirth: 'date_of_birth',
            maritalStatus: 'marital_status',
            currentMedications: 'current_medications',
            chronicConditions: 'chronic_conditions',
            previousSurgeries: 'previous_surgeries',
            bloodGroup: 'blood_group',
            medicalHistory: 'medical_history',
            emergencyContactName: 'emergency_contact_name',
            emergencyContactPhone: 'emergency_contact_phone',
            emergencyContactRelationship: 'emergency_contact_relationship',
            insuranceProvider: 'insurance_provider',
            insuranceNumber: 'insurance_number'
        };
        // Direct field mappings (same name in frontend and database)
        const directFields = [
            'gender',
            'phone',
            'email',
            'address',
            'allergies',
            'status'
        ];
        // Map fields with different names
        Object.entries(fieldMapping).forEach(([frontendField, dbField])=>{
            if (updateData[frontendField] !== undefined) {
                mappedData[dbField] = updateData[frontendField];
            }
        });
        // Map direct fields
        directFields.forEach((field)=>{
            if (updateData[field] !== undefined) {
                mappedData[field] = updateData[field];
            }
        });
        // Skip fields that don't exist in database
        // primaryComplaint, initialSymptoms, guardianName, guardianRelationship, guardianPhone, guardianAddress, referredBy
        // Add updated timestamp
        mappedData.updated_at = new Date().toISOString();
        console.log('Mapped data being sent to database:', mappedData);
        const updatedPatient = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$patientService$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updatePatientRecord"])(id, mappedData);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(updatedPatient);
    } catch (error) {
        console.error('Error updating patient:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to update patient'
        }, {
            status: 500
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__78d398d0._.js.map