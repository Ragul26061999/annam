"use strict";exports.id=880,exports.ids=[880],exports.modules={10022:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},13861:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},19080:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},28561:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},43649:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},63143:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},88233:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},96474:(t,e,a)=>{a.d(e,{A:()=>i});let i=(0,a(62688).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},98309:(t,e,a)=>{a.d(e,{DK:()=>_,H5:()=>n,J4:()=>r,Xv:()=>s,eF:()=>c,gv:()=>m,tO:()=>l,y4:()=>p,yb:()=>o,zz:()=>d});var i=a(16391);async function r(t){try{let e=i.ND.from("medications").select("*").order("name");t?.category&&(e=e.eq("category",t.category)),t?.prescription_required!==void 0&&(e=e.eq("prescription_required",t.prescription_required)),t?.status&&(e=e.eq("status",t.status)),t?.search&&(e=e.or(`name.ilike.%${t.search}%,generic_name.ilike.%${t.search}%,medication_code.ilike.%${t.search}%`));let{data:a,error:r}=await e;if(r)throw console.error("Error fetching medications:",r),r;return a||[]}catch(t){throw console.error("Error in getMedications:",t),t}}async function n(){try{let{data:t,error:e}=await i.ND.from("medications").select("*").filter("stock_quantity","lte","minimum_stock_level").eq("status","active").order("stock_quantity");if(e)throw console.error("Error fetching low stock medications:",e),e;return t||[]}catch(t){throw console.error("Error in getLowStockMedications:",t),t}}async function o(t,e,a,r,n,o,c,s){try{let d=`TXN${Date.now()}${Math.floor(1e3*Math.random())}`,{data:_,error:p}=await i.ND.from("pharmacy_stock_transactions").insert({medication_id:t,transaction_id:d,transaction_type:"purchase",quantity:e,unit_price:a,total_amount:e*a,batch_number:r,expiry_date:n,supplier_name:o,notes:c,created_by:s}).select("*").single();if(p)throw console.error("Error adding stock:",p),p;let{data:l}=await i.ND.from("medications").select("stock_quantity").eq("id",t).single();return l&&await i.ND.from("medications").update({stock_quantity:l.stock_quantity+e,unit_price:a,updated_at:new Date().toISOString()}).eq("id",t),_}catch(t){throw console.error("Error in addStock:",t),t}}async function c(t,e,a=50){try{let r=i.ND.from("pharmacy_stock_transactions").select("*").order("created_at",{ascending:!1}).limit(a);t&&(r=r.eq("medication_id",t)),e&&(r=r.eq("transaction_type",e));let{data:n,error:o}=await r;if(o)throw console.error("Error fetching stock transactions:",o),o;return n||[]}catch(t){throw console.error("Error in getStockTransactions:",t),t}}async function s(t){try{let e=[],{data:a,error:r}=await i.ND.from("prescriptions").select(`
        id,
        created_at,
        doctor_id,
        prescription_items(
          medication_id,
          dosage,
          frequency,
          duration
        )
      `).eq("patient_id",t).order("created_at",{ascending:!1});if(r)console.error("Error fetching prescriptions:",r);else if(a){let r=[...new Set(a.map(t=>t.doctor_id))],{data:n}=await i.ND.from("users").select("id, name").in("id",r),o=a.flatMap(t=>t.prescription_items?.map(t=>t.medication_id)||[]),{data:c}=await i.ND.from("medications").select("id, name, generic_name").in("id",o);a.forEach(a=>{let i=n?.find(t=>t.id===a.doctor_id);a.prescription_items?.forEach(r=>{let n=c?.find(t=>t.id===r.medication_id);e.push({id:`presc_${a.id}_${r.medication_id}`,patient_id:t,medication_name:n?.name||"Unknown",generic_name:n?.generic_name||"",dosage:r.dosage||"",frequency:r.frequency||"",duration:r.duration||"",prescribed_date:a.created_at,prescribed_by:i?.name||"Unknown Doctor",status:"prescribed"})})})}let{data:n,error:o}=await i.ND.from("prescription_dispensed").select(`
        id,
        dispensed_at,
        total_amount,
        payment_status,
        dispensed_by,
        prescription_dispensed_items(
          medication_id,
          quantity_dispensed,
          unit_price,
          total_price
        )
      `).eq("patient_id",t).order("dispensed_at",{ascending:!1});if(o)console.error("Error fetching dispensed medications:",o);else if(n){let a=[...new Set(n.map(t=>t.dispensed_by))],{data:r}=await i.ND.from("users").select("id, name").in("id",a),o=n.flatMap(t=>t.prescription_dispensed_items?.map(t=>t.medication_id)||[]),{data:c}=await i.ND.from("medications").select("id, name, generic_name, strength, dosage_form").in("id",o);n.forEach(a=>{let i=r?.find(t=>t.id===a.dispensed_by);a.prescription_dispensed_items?.forEach(r=>{let n=c?.find(t=>t.id===r.medication_id);e.push({id:`disp_${a.id}_${r.medication_id}`,patient_id:t,medication_name:n?.name||"Unknown",generic_name:n?.generic_name||"",dosage:`${n?.strength} ${n?.dosage_form}`||"",frequency:`Qty: ${r.quantity_dispensed}`,duration:"",prescribed_date:"",dispensed_date:a.dispensed_at,prescribed_by:"",dispensed_by:i?.name||"Unknown Pharmacist",status:"dispensed",total_amount:r.total_price,payment_status:a.payment_status})})})}return e.sort((t,e)=>{let a=new Date(t.dispensed_date||t.prescribed_date);return new Date(e.dispensed_date||e.prescribed_date).getTime()-a.getTime()}),e}catch(t){throw console.error("Error in getPatientMedicationHistory:",t),t}}async function d(){try{let{count:t}=await i.ND.from("medications").select("*",{count:"exact",head:!0}).eq("status","active"),{count:e}=await i.ND.from("medications").select("*",{count:"exact",head:!0}).filter("stock_quantity","lte","minimum_stock_level").eq("status","active"),a=new Date().toISOString().split("T")[0],{data:r}=await i.ND.from("pharmacy_stock_transactions").select("total_amount").eq("transaction_type","sale").gte("created_at",`${a}T00:00:00`).lt("created_at",`${a}T23:59:59`),n=r?.reduce((t,e)=>t+e.total_amount,0)||0,{count:o}=await i.ND.from("pharmacy_billing").select("*",{count:"exact",head:!0}).eq("payment_status","pending"),c=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString(),{data:s}=await i.ND.from("pharmacy_billing").select("final_amount").eq("payment_status","paid").gte("created_at",c),d=s?.reduce((t,e)=>t+e.final_amount,0)||0,{count:_}=await i.ND.from("prescription_items").select("*",{count:"exact",head:!0}).eq("status","dispensed").gte("updated_at",`${a}T00:00:00`).lt("updated_at",`${a}T23:59:59`);return{totalMedications:t||0,lowStockCount:e||0,todaySales:n,pendingBills:o||0,totalRevenue:d,prescriptionsDispensed:_||0}}catch(t){return console.error("Error in getPharmacyDashboardStats:",t),{totalMedications:0,lowStockCount:0,todaySales:0,pendingBills:0,totalRevenue:0,prescriptionsDispensed:0}}}async function _(){try{let{data:t,error:e}=await i.ND.from("prescriptions").select(`
        id,
        prescription_id,
        patient_id,
        doctor_id,
        issue_date,
        status,
        patients!inner(name),
        users!inner(name),
        prescription_items(
          id,
          medication_id,
          medication_name,
          quantity,
          unit_price,
          total_price
        )
      `).eq("status","pending").order("issue_date",{ascending:!1});if(e)throw console.error("Error fetching pending prescriptions:",e),e;return(t||[]).map(t=>({id:t.id,prescription_id:t.prescription_id,patient_id:t.patient_id,patient_name:t.patients?.name||"Unknown Patient",doctor_name:t.users?.name||"Unknown Doctor",issue_date:t.issue_date,status:t.status,total_items:t.prescription_items?.length||0,total_amount:t.prescription_items?.reduce((t,e)=>t+e.total_price,0)||0,prescription_items:t.prescription_items||[]}))}catch(t){throw console.error("Error in getPendingPrescriptions:",t),t}}async function p(t,e,a,r,n){try{let{data:o,error:c}=await i.ND.from("medications").select("stock_quantity").eq("id",t).single();if(c)throw Error("Failed to fetch medication");let s=Math.max(0,o.stock_quantity+e),{error:d}=await i.ND.from("medications").update({stock_quantity:s,updated_at:new Date().toISOString()}).eq("id",t);if(d)throw Error("Failed to update medication stock");let _=`ADJ-${Date.now()}`,{data:p,error:l}=await i.ND.from("pharmacy_stock_transactions").insert({medication_id:t,transaction_id:_,transaction_type:"adjustment",quantity:Math.abs(e),unit_price:0,total_amount:0,notes:`${a}: ${r}`,created_by:n,created_at:new Date().toISOString()}).select().single();if(l)throw Error("Failed to create stock transaction");return p}catch(t){throw console.error("Error in adjustStock:",t),t}}async function l(t,e,a,r,n,o){try{let c=e.reduce((t,e)=>t+e.quantity*e.unit_price,0),s=c*a/100,d=c-s,_=d*r/100,p=d+_,l=`PH${Date.now()}`,{data:m,error:u}=await i.ND.from("pharmacy_billing").insert({bill_number:l,patient_id:t,subtotal:c,discount:s,tax_amount:_,tax_rate:r,final_amount:p,payment_method:n,payment_status:"paid",created_by:o,created_at:new Date().toISOString()}).select().single();if(u)throw Error("Failed to create pharmacy bill");for(let t of e){await i.ND.from("pharmacy_bill_items").insert({bill_id:m.id,medication_id:t.medication_id,quantity:t.quantity,unit_price:t.unit_price,total_price:t.quantity*t.unit_price});let{data:e}=await i.ND.from("medications").select("stock_quantity").eq("id",t.medication_id).single();if(e){let a=Math.max(0,e.stock_quantity-t.quantity);await i.ND.from("medications").update({stock_quantity:a}).eq("id",t.medication_id);let r=`SALE-${Date.now()}-${t.medication_id}`;await i.ND.from("pharmacy_stock_transactions").insert({medication_id:t.medication_id,transaction_id:r,transaction_type:"sale",quantity:t.quantity,unit_price:t.unit_price,total_amount:t.quantity*t.unit_price,notes:`Sold via bill ${l}`,created_by:o,created_at:new Date().toISOString()})}}return{...m,total_amount:p,items:e.map(t=>({medication_id:t.medication_id,quantity:t.quantity,unit_price:t.unit_price,total_price:t.quantity*t.unit_price}))}}catch(t){throw console.error("Error in createPharmacyBill:",t),t}}async function m(t){try{let e=i.ND.from("pharmacy_billing").select(`
        *,
        patient:patients(first_name, last_name)
      `).order("created_at",{ascending:!1});t&&(e=e.eq("patient_id",t));let{data:a,error:r}=await e;if(r)return console.error("Error fetching pharmacy bills:",r),[];return a?.map(t=>({...t,patient_name:t.patient?`${t.patient.first_name} ${t.patient.last_name}`:"Unknown",total_amount:t.final_amount,items:[]}))||[]}catch(t){return console.error("Error in getPharmacyBills:",t),[]}}}};