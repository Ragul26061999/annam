{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = 'https://zusheijhebsmjiyyeiqq.supabase.co';\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1c2hlaWpoZWJzbWppeXllaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MjI0NDAsImV4cCI6MjA2NzM5ODQ0MH0.iwGPaOJPa6OvwX_iA1xvRt5cM72DWfd8Br1pwRTemRc';\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const signInWithEmail = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  });\n  return { data, error };\n};\n\nexport const signUpWithEmail = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${window.location.origin}/auth/callback`,\n    },\n  });\n  return { data, error };\n};\n\n// Function to create admin user without email confirmation\nexport const createAdminUser = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${window.location.origin}/auth/callback`,\n      data: {\n        email_confirm: true,\n      },\n    },\n  });\n  return { data, error };\n};\n\nexport const signOut = async () => {\n  await supabase.auth.signOut();\n};\n\nexport const getCurrentUser = async () => {\n  const { data: { user } } = await supabase.auth.getUser();\n  return user;\n};\n\nexport const getCurrentUserProfile = async () => {\n  const { data: { user } } = await supabase.auth.getUser();\n  console.log('Auth user:', user);\n  \n  if (!user) {\n    console.log('No authenticated user found');\n    return null;\n  }\n\n  // Get the user profile from our users table\n  const { data: userProfile, error } = await supabase\n    .from('users')\n    .select('*')\n    .eq('auth_id', user.id)\n    .single();\n\n  console.log('User profile query result:', { userProfile, error });\n\n  if (error) {\n    console.error('Error fetching user profile:', error);\n    return null;\n  }\n\n  console.log('Returning user profile:', userProfile);\n  return userProfile;\n};\n"],"names":[],"mappings":";;;;;;;;;AAAA;;AAEA,MAAM,cAAc;AACpB,MAAM,kBAAkB;AAEjB,MAAM,WAAW,CAAA,GAAA,uLAAA,CAAA,eAAY,AAAD,EAAE,aAAa;AAE3C,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;QAC7D;QACA;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAEO,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;QACjD;QACA;QACA,SAAS;YACP,iBAAiB,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC;QAC5D;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAGO,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;QACjD;QACA;QACA,SAAS;YACP,iBAAiB,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC;YAC1D,MAAM;gBACJ,eAAe;YACjB;QACF;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAEO,MAAM,UAAU;IACrB,MAAM,SAAS,IAAI,CAAC,OAAO;AAC7B;AAEO,MAAM,iBAAiB;IAC5B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,OAAO;AACT;AAEO,MAAM,wBAAwB;IACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,QAAQ,GAAG,CAAC,cAAc;IAE1B,IAAI,CAAC,MAAM;QACT,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,4CAA4C;IAC5C,MAAM,EAAE,MAAM,WAAW,EAAE,KAAK,EAAE,GAAG,MAAM,SACxC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,QAAQ,GAAG,CAAC,8BAA8B;QAAE;QAAa;IAAM;IAE/D,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,2BAA2B;IACvC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/barcodeUtils.ts"],"sourcesContent":["import { supabase } from './supabase';\n\n/**\n * Generate a barcode ID for a patient\n * Format: BARS{Year}{Month}{RandomDigits}\n * Example: BARS2025010001\n */\nexport function generateBarcodeId(uhid: string): string {\n  const now = new Date();\n  const year = now.getFullYear().toString();\n  const month = (now.getMonth() + 1).toString().padStart(2, '0');\n  \n  // Use UHID as base and add timestamp for uniqueness\n  const timestamp = now.getTime().toString().slice(-4); // Last 4 digits of timestamp\n  \n  return `BARS${year}${month}${timestamp}`;\n}\n\n/**\n * Generate SVG barcode using Code-128 format\n * This is a simplified implementation - in production, you'd use a proper barcode library\n */\nexport function generateBarcodeSVG(barcodeId: string): string {\n  const width = 300;\n  const height = 80;\n  const barWidth = 2;\n  const barsCount = barcodeId.length * 6; // Approximate for Code-128\n  \n  let svg = `<svg width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\">`;\n  \n  // Background\n  svg += `<rect width=\"${width}\" height=\"${height}\" fill=\"white\"/>`;\n  \n  // Generate bars pattern (simplified)\n  let x = 10;\n  for (let i = 0; i < barcodeId.length; i++) {\n    const char = barcodeId[i];\n    const charCode = char.charCodeAt(0);\n    \n    // Create alternating pattern based on character\n    for (let j = 0; j < 6; j++) {\n      if ((charCode + j) % 2 === 0) {\n        svg += `<rect x=\"${x}\" y=\"10\" width=\"${barWidth}\" height=\"50\" fill=\"black\"/>`;\n      }\n      x += barWidth;\n    }\n  }\n  \n  // Add text below barcode\n  svg += `<text x=\"${width/2}\" y=\"${height-10}\" text-anchor=\"middle\" font-family=\"monospace\" font-size=\"12\" fill=\"black\">${barcodeId}</text>`;\n  \n  svg += '</svg>';\n  \n  return svg;\n}\n\n/**\n * Generate a more realistic barcode pattern\n * This creates a pattern that looks more like a real barcode\n */\nexport function generateRealisticBarcodeSVG(barcodeId: string): string {\n  const width = 300;\n  const height = 80;\n  const minBarWidth = 1;\n  const maxBarWidth = 4;\n  \n  let svg = `<svg width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\">`;\n  \n  // Background\n  svg += `<rect width=\"${width}\" height=\"${height}\" fill=\"white\"/>`;\n  \n  // Generate more realistic bar pattern\n  let x = 20;\n  let isBlack = true;\n  \n  // Start and end patterns\n  const startPattern = [1, 1, 1, 1, 1, 1];\n  const endPattern = [1, 1, 1, 1, 1, 1];\n  \n  // Draw start pattern\n  for (const barWidth of startPattern) {\n    if (isBlack) {\n      svg += `<rect x=\"${x}\" y=\"10\" width=\"${barWidth}\" height=\"50\" fill=\"black\"/>`;\n    }\n    x += barWidth;\n    isBlack = !isBlack;\n  }\n  \n  // Draw data pattern\n  for (let i = 0; i < barcodeId.length; i++) {\n    const char = barcodeId[i];\n    const charCode = char.charCodeAt(0);\n    \n    // Create pattern based on character\n    const pattern = [];\n    for (let j = 0; j < 6; j++) {\n      const width = minBarWidth + ((charCode + j) % (maxBarWidth - minBarWidth + 1));\n      pattern.push(width);\n    }\n    \n    for (const barWidth of pattern) {\n      if (isBlack) {\n        svg += `<rect x=\"${x}\" y=\"10\" width=\"${barWidth}\" height=\"50\" fill=\"black\"/>`;\n      }\n      x += barWidth;\n      isBlack = !isBlack;\n    }\n  }\n  \n  // Draw end pattern\n  for (const barWidth of endPattern) {\n    if (isBlack) {\n      svg += `<rect x=\"${x}\" y=\"10\" width=\"${barWidth}\" height=\"50\" fill=\"black\"/>`;\n    }\n    x += barWidth;\n    isBlack = !isBlack;\n  }\n  \n  // Add text below barcode\n  svg += `<text x=\"${width/2}\" y=\"${height-10}\" text-anchor=\"middle\" font-family=\"monospace\" font-size=\"12\" fill=\"black\">${barcodeId}</text>`;\n  \n  svg += '</svg>';\n  \n  return svg;\n}\n\n/**\n * Update patient with barcode ID\n * Note: This function is currently disabled as barcode_id column doesn't exist in the database\n */\nexport async function updatePatientWithBarcode(patientId: string, barcodeId: string): Promise<void> {\n  console.log('Barcode update skipped - barcode_id column not available in database schema');\n  // Function disabled as barcode_id column doesn't exist\n  return;\n}\n\n/**\n * Get patient by barcode ID\n * Note: This function is currently disabled as barcode_id column doesn't exist in the database\n */\nexport async function getPatientByBarcodeId(barcodeId: string): Promise<any> {\n  console.log('Barcode lookup skipped - barcode_id column not available in database schema');\n  // Function disabled as barcode_id column doesn't exist\n  throw new Error('Barcode functionality is currently unavailable - barcode_id column not in database schema');\n}\n\n/**\n * Generate printable barcode data\n */\nexport function generatePrintableBarcodeData(uhid: string, barcodeId: string, patientName: string): string {\n  const svg = generateRealisticBarcodeSVG(barcodeId);\n  \n  return `\n    <div style=\"width: 4in; height: 2in; padding: 0.2in; font-family: Arial, sans-serif; border: 1px solid #ccc; margin: 0.1in;\">\n      <div style=\"text-align: center; margin-bottom: 0.1in;\">\n        <h3 style=\"margin: 0; font-size: 14px; color: #333;\">ANNAM HOSPITAL</h3>\n        <p style=\"margin: 0; font-size: 10px; color: #666;\">Patient ID Card</p>\n      </div>\n      <div style=\"text-align: center; margin-bottom: 0.1in;\">\n        ${svg}\n      </div>\n      <div style=\"text-align: center; font-size: 12px;\">\n        <p style=\"margin: 0; font-weight: bold;\">${patientName}</p>\n        <p style=\"margin: 0; font-size: 10px; color: #666;\">UHID: ${uhid}</p>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Validate barcode ID format\n */\nexport function validateBarcodeId(barcodeId: string): boolean {\n  // Check if it matches the format: BARS{Year}{Month}{4digits}\n  const barcodeRegex = /^BARS\\d{4}(0[1-9]|1[0-2])\\d{4}$/;\n  return barcodeRegex.test(barcodeId);\n}\n\n/**\n * Extract information from barcode ID\n */\nexport function extractBarcodeInfo(barcodeId: string): {\n  year: string;\n  month: string;\n  sequence: string;\n} | null {\n  if (!validateBarcodeId(barcodeId)) {\n    return null;\n  }\n  \n  const year = barcodeId.substring(4, 8);\n  const month = barcodeId.substring(8, 10);\n  const sequence = barcodeId.substring(10, 14);\n  \n  return { year, month, sequence };\n}\n\n/**\n * Generate barcode for existing patient\n * Note: This function is modified to work without database barcode_id column\n */\nexport async function generateBarcodeForPatient(patientId: string): Promise<string> {\n  try {\n    // Check if patient exists\n    const { data: patient, error } = await supabase\n      .from('patients')\n      .select('patient_id')\n      .eq('patient_id', patientId)\n      .single();\n    \n    if (error) {\n      throw new Error(`Patient not found: ${error.message}`);\n    }\n    \n    // Generate new barcode based on patient ID\n    const barcodeId = generateBarcodeId(patientId);\n    \n    // We don't update the database since barcode_id column doesn't exist\n    // Just return the generated barcode\n    return barcodeId;\n  } catch (error) {\n    console.error('Error generating barcode for patient:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 364, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/patientService.ts"],"sourcesContent":["import { supabase } from './supabase';\nimport { generateBarcodeId, updatePatientWithBarcode } from './barcodeUtils';\n\n// Types - Updated to match comprehensive registration form\nexport interface PatientRegistrationData {\n  // Personal Information (Mandatory)\n  firstName: string;\n  lastName: string;\n  dateOfBirth: string;\n  gender: string;\n  maritalStatus?: string; // single, married, divorced, widowed, separated\n  phone: string;\n  email?: string;\n  address: string;\n  \n  // Medical & Admission Information \n  bloodGroup: string;\n  allergies: string;\n  medicalHistory: string;\n  currentMedications: string;\n  chronicConditions: string;\n  previousSurgeries: string;\n  \n  // Admission Details\n  admissionDate?: string;\n  admissionTime?: string;\n  primaryComplaint: string;\n  admissionType: string; // emergency, elective, referred\n  referringDoctorFacility?: string;\n  consultingDoctorId?: string;\n  consultingDoctorName?: string;\n  departmentWard?: string;\n  roomNumber?: string;\n  \n  // Guardian/Attendant Details (Optional)\n  guardianName?: string;\n  guardianRelationship?: string;\n  guardianPhone?: string;\n  guardianAddress?: string;\n  \n  // Emergency Contact (Optional)\n  emergencyContactName?: string;\n  emergencyContactPhone?: string;\n  emergencyContactRelationship?: string;\n  \n  // Insurance Information (Optional)\n  insuranceProvider?: string;\n  insuranceNumber?: string;\n  \n  // Initial Visit Information\n  initialSymptoms?: string;\n  referredBy?: string;\n}\n\nexport interface PatientResponse {\n  success: boolean;\n  patient?: any;\n  uhid?: string;\n  credentials?: {\n    email: string;\n    password: string;\n  };\n  error?: string;\n}\n\n/**\n * Generate a unique UHID (Unique Hospital ID) for a new patient\n * Format: UHID + current year + 6-digit sequential number\n * Example: UHID2025000001\n */\nexport async function generateUHID(): Promise<string> {\n  const now = new Date();\n  const yearTwoDigits = now.getFullYear().toString().slice(-2); // Last two digits of year\n  const month = (now.getMonth() + 1).toString().padStart(2, '0'); // Month with leading zero\n  \n  try {\n    // Generate a unique 4-digit random number\n    let uhid: string = '';\n    let isUnique = false;\n    let attempts = 0;\n    const maxAttempts = 1000;\n    \n    while (!isUnique && attempts < maxAttempts) {\n      // Generate 4-digit random number\n      const randomNumber = Math.floor(Math.random() * 10000).toString().padStart(4, '0');\n      uhid = `AH${yearTwoDigits}${month}${randomNumber}`;\n      \n      // Check if this UHID already exists\n      const { data: existing, error } = await supabase\n        .from('patients')\n        .select('patient_id')\n        .eq('patient_id', uhid)\n        .single();\n      \n      if (error && error.code === 'PGRST116') {\n        // No record found, UHID is unique\n        isUnique = true;\n      } else if (error) {\n        console.error('Error checking UHID uniqueness:', error);\n        throw new Error('Failed to generate UHID');\n      }\n      \n      attempts++;\n    }\n    \n    if (!isUnique) {\n      throw new Error('Failed to generate unique UHID after maximum attempts');\n    }\n    \n    return uhid;\n  } catch (error) {\n    console.error('Error generating UHID:', error);\n    throw new Error('Failed to generate UHID');\n  }\n}\n\n/**\n * Create authentication credentials for a new patient\n * Email format: UHID@annam.com\n * Password: \"password\" (as specified in requirements)\n */\nexport async function createPatientAuthCredentials(uhid: string): Promise<{ \n  authUser: any; \n  credentials: { email: string; password: string } \n}> {\n  const email = `${uhid}@annam.com`;\n  const password = 'password';\n\n  try {\n    // Create auth user using Supabase Admin API\n    const { data: authUser, error: authError } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        emailRedirectTo: `${window.location.origin}/auth/callback`,\n        data: {\n          role: 'patient',\n          uhid: uhid,\n          email_confirm: true\n        }\n      }\n    });\n\n    if (authError) {\n      console.error('Error creating auth user:', authError);\n      throw new Error(`Failed to create authentication: ${authError.message}`);\n    }\n\n    return {\n      authUser: authUser.user,\n      credentials: { email, password }\n    };\n  } catch (error) {\n    console.error('Error creating patient auth credentials:', error);\n    throw error;\n  }\n}\n\n/**\n * Insert comprehensive patient record into the patients table with all new fields\n */\nexport async function insertPatientRecord(\n  uhid: string, \n  registrationData: PatientRegistrationData,\n  userId?: string\n): Promise<any> {\n  try {\n    const fullName = `${registrationData.firstName} ${registrationData.lastName}`;\n    \n    // Generate barcode ID\n    const barcodeId = generateBarcodeId(uhid);\n    \n    // Prepare admission date and time\n    let admissionDateTime = null;\n    if (registrationData.admissionDate) {\n      if (registrationData.admissionTime) {\n        admissionDateTime = `${registrationData.admissionDate}T${registrationData.admissionTime}`;\n      } else {\n        admissionDateTime = `${registrationData.admissionDate}T00:00:00`;\n      }\n    }\n    \n    const patientData = {\n      // Basic Information\n      patient_id: uhid,\n      // barcode_id field removed as it doesn't exist in the database schema\n      name: fullName,\n      date_of_birth: registrationData.dateOfBirth,\n      gender: registrationData.gender.toLowerCase(),\n      marital_status: registrationData.maritalStatus || null,\n      phone: registrationData.phone,\n      email: registrationData.email || `${uhid}@annam.com`,\n      address: registrationData.address,\n      \n      // Medical Information\n      blood_group: registrationData.bloodGroup || null,\n      allergies: registrationData.allergies || null,\n      medical_history: registrationData.medicalHistory || null,\n      current_medications: registrationData.currentMedications || null,\n      chronic_conditions: registrationData.chronicConditions || null,\n      previous_surgeries: registrationData.previousSurgeries || null,\n      \n      // New Admission Information\n      admission_date: admissionDateTime,\n      admission_time: registrationData.admissionTime || null,\n      primary_complaint: registrationData.primaryComplaint,\n      admission_type: registrationData.admissionType,\n      referring_doctor_facility: registrationData.referringDoctorFacility || null,\n      department_ward: registrationData.departmentWard || null,\n      room_number: registrationData.roomNumber || null,\n      \n      // Guardian/Attendant Details (Optional)\n      guardian_name: registrationData.guardianName || null,\n      guardian_relationship: registrationData.guardianRelationship || null,\n      guardian_phone: registrationData.guardianPhone || null,\n      guardian_address: registrationData.guardianAddress || null,\n      \n      // Emergency Contact (Optional)\n      emergency_contact_name: registrationData.emergencyContactName || null,\n      emergency_contact_phone: registrationData.emergencyContactPhone || null,\n      emergency_contact_relationship: registrationData.emergencyContactRelationship || null,\n      \n      // Insurance Information\n      insurance_number: registrationData.insuranceNumber || null,\n      insurance_provider: registrationData.insuranceProvider || null,\n      \n      // Additional fields\n      initial_symptoms: registrationData.initialSymptoms || null,\n      referred_by: registrationData.referredBy || null,\n      \n      // Link to users table\n      user_id: userId || null,\n      \n      // System fields\n      status: 'active'\n    };\n\n    const { data: patient, error } = await supabase\n      .from('patients')\n      .insert([patientData])\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error inserting patient record:', error);\n      throw new Error(`Failed to create patient record: ${error.message}`);\n    }\n\n    return patient;\n  } catch (error) {\n    console.error('Error inserting patient record:', error);\n    throw error;\n  }\n}\n\n/**\n * Link the Supabase auth user to the users table for role management\n */\nexport async function linkAuthUserToPatient(\n  authUserId: string, \n  uhid: string, \n  registrationData: PatientRegistrationData\n): Promise<any> {\n  try {\n    const fullName = `${registrationData.firstName} ${registrationData.lastName}`;\n    \n    const userData = {\n      auth_id: authUserId,\n      employee_id: uhid, // Using UHID as employee_id for patients\n      name: fullName,\n      email: registrationData.email || `${uhid}@annam.com`,\n      role: 'patient',\n      phone: registrationData.phone,\n      address: registrationData.address,\n      status: 'active',\n      permissions: {\n        patient_portal: true,\n        view_own_records: true,\n        book_appointments: true\n      }\n    };\n\n    const { data: user, error } = await supabase\n      .from('users')\n      .insert([userData])\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error linking auth user to patient:', error);\n      throw new Error(`Failed to create user record: ${error.message}`);\n    }\n\n    return user;\n  } catch (error) {\n    console.error('Error linking auth user to patient:', error);\n    throw error;\n  }\n}\n\n/**\n * Create an initial appointment if symptoms are provided\n */\nexport async function createInitialAppointment(\n  patientId: string,\n  registrationData: PatientRegistrationData\n): Promise<any> {\n  try {\n    if (!registrationData.initialSymptoms?.trim() && !registrationData.primaryComplaint?.trim()) {\n      return null; // No appointment needed if no symptoms\n    }\n\n    // Generate appointment ID\n    const appointmentId = `APT${Date.now()}`;\n    \n    // Use tomorrow as default appointment date\n    const tomorrow = new Date();\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    \n    const appointmentData = {\n      appointment_id: appointmentId,\n      patient_id: patientId,\n      appointment_date: tomorrow.toISOString().split('T')[0],\n      appointment_time: '09:00:00',\n      type: 'consultation',\n      status: 'scheduled',\n      symptoms: registrationData.initialSymptoms || registrationData.primaryComplaint,\n      notes: `Initial consultation for newly registered patient. Primary complaint: ${registrationData.primaryComplaint}`\n    };\n\n    const { data: appointment, error } = await supabase\n      .from('appointments')\n      .insert([appointmentData])\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating initial appointment:', error);\n      // Don't throw error for appointment creation failure\n      return null;\n    }\n\n    return appointment;\n  } catch (error) {\n    console.error('Error creating initial appointment:', error);\n    // Don't throw error for appointment creation failure\n    return null;\n  }\n}\n\n/**\n * Main function to register a new patient with complete workflow\n */\nexport async function registerNewPatient(\n  registrationData: PatientRegistrationData,\n  preGeneratedUHID?: string\n): Promise<PatientResponse> {\n  try {\n    // Step 1: Use pre-generated UHID or generate new one\n    const uhid = preGeneratedUHID || await generateUHID();\n    console.log('Using UHID:', uhid);\n\n    // Step 2: Create authentication credentials\n    const { authUser, credentials } = await createPatientAuthCredentials(uhid);\n    console.log('Created auth user:', authUser?.id);\n\n    // Step 3: Create user record in users table\n    const userRecord = await linkAuthUserToPatient(authUser.id, uhid, registrationData);\n    console.log('Created user record:', userRecord.id);\n\n    // Step 4: Insert patient record with user_id link\n    const patient = await insertPatientRecord(uhid, registrationData, userRecord.id);\n    console.log('Created patient record:', patient.id);\n\n    // Step 5: Create initial appointment if symptoms provided\n    if (registrationData.initialSymptoms?.trim() || registrationData.primaryComplaint?.trim()) {\n      const appointment = await createInitialAppointment(patient.id, registrationData);\n      if (appointment) {\n        console.log('Created initial appointment:', appointment.id);\n      }\n    }\n\n    return {\n      success: true,\n      patient,\n      uhid,\n      credentials,\n    };\n\n  } catch (error) {\n    console.error('Error registering new patient:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error occurred'\n    };\n  }\n}\n\n/**\n * Validate that UHID is unique\n */\nexport async function validateUHIDUnique(uhid: string): Promise<boolean> {\n  try {\n    const { data: existingPatient, error } = await supabase\n      .from('patients')\n      .select('patient_id')\n      .eq('patient_id', uhid)\n      .single();\n\n    if (error && error.code !== 'PGRST116') {\n      console.error('Error validating UHID uniqueness:', error);\n      throw new Error('Failed to validate UHID');\n    }\n\n    return !existingPatient; // Return true if no existing patient found\n  } catch (error) {\n    console.error('Error validating UHID uniqueness:', error);\n    throw error;\n  }\n}\n\n/**\n * Get patient by UHID with comprehensive data\n */\nexport async function getPatientByUHID(uhid: string): Promise<any> {\n  try {\n    const { data: patient, error } = await supabase\n      .from('patients')\n      .select('*')\n      .eq('patient_id', uhid)\n      .single();\n\n    if (error) {\n      console.error('Error fetching patient by UHID:', error);\n      throw new Error(`Patient not found: ${error.message}`);\n    }\n\n    return patient;\n  } catch (error) {\n    console.error('Error fetching patient by UHID:', error);\n    throw error;\n  }\n}\n\n/**\n * Get patient with related data (appointments, bills, etc.)\n */\nexport async function getPatientWithRelatedData(uhid: string): Promise<any> {\n  try {\n    const { data: patient, error } = await supabase\n      .from('patients')\n      .select(`\n        *,\n        users:user_id (\n          id,\n          name,\n          email,\n          role,\n          status,\n          permissions\n        ),\n        appointments:appointments(\n          id,\n          appointment_id,\n          appointment_date,\n          appointment_time,\n          type,\n          status,\n          symptoms,\n          diagnosis,\n          doctor:doctors(\n            id,\n            user:users(name, specialization)\n          )\n        ),\n        bed_allocations:bed_allocations(\n          id,\n          admission_date,\n          discharge_date,\n          admission_type,\n          status,\n          bed:beds(bed_number, room_number, bed_type),\n          doctor:doctors(\n            id,\n            user:users(name, specialization)\n          )\n        )\n      `)\n      .eq('patient_id', uhid)\n      .single();\n\n    if (error) {\n      console.error('Error fetching patient with related data:', error);\n      throw new Error(`Patient not found: ${error.message}`);\n    }\n\n    return patient;\n  } catch (error) {\n    console.error('Error fetching patient with related data:', error);\n    throw error;\n  }\n}\n\n/**\n * Update patient information\n */\nexport async function updatePatientRecord(\n  uhid: string, \n  updateData: any\n): Promise<any> {\n  try {\n    const { data: patient, error } = await supabase\n      .from('patients')\n      .update(updateData)\n      .eq('patient_id', uhid)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating patient record:', error);\n      throw new Error(`Failed to update patient: ${error.message}`);\n    }\n\n    return patient;\n  } catch (error) {\n    console.error('Error updating patient record:', error);\n    throw error;\n  }\n}\n\n/**\n * Get all patients with pagination and filtering\n */\nexport async function getAllPatients(\n  options: {\n    page?: number;\n    limit?: number;\n    status?: string;\n    searchTerm?: string;\n  } = {}\n): Promise<{ patients: any[]; total: number; page: number; limit: number }> {\n  try {\n    const { page = 1, limit = 20, status, searchTerm } = options;\n    const offset = (page - 1) * limit;\n\n    let query = supabase\n      .from('patients')\n      .select(`\n        *,\n        users:user_id (\n          id,\n          name,\n          email,\n          role,\n          status,\n          permissions\n        )\n      `, { count: 'exact' });\n\n    // Apply filters\n    if (status) {\n      query = query.eq('status', status);\n    }\n\n    if (searchTerm) {\n      query = query.or(`name.ilike.%${searchTerm}%,patient_id.ilike.%${searchTerm}%,phone.ilike.%${searchTerm}%`);\n    }\n\n    // Apply pagination\n    const { data: patients, error, count } = await query\n      .range(offset, offset + limit - 1)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patients:', error);\n      throw new Error(`Failed to fetch patients: ${error.message}`);\n    }\n\n    return {\n      patients: patients || [],\n      total: count || 0,\n      page,\n      limit\n    };\n  } catch (error) {\n    console.error('Error fetching patients:', error);\n    throw error;\n  }\n}\n\n/**\n * Update patient admission status\n * @param uhid - Patient's unique hospital ID\n * @param isAdmitted - Whether the patient is admitted\n * @returns Promise with updated patient data\n */\nexport async function updatePatientAdmissionStatus(\n  uhid: string,\n  isAdmitted: boolean\n): Promise<any> {\n  try {\n    const { data, error } = await supabase\n      .from('patients')\n      .update({ \n        is_admitted: isAdmitted,\n        updated_at: new Date().toISOString()\n      })\n      .eq('patient_id', uhid)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating patient admission status:', error);\n      throw new Error(`Failed to update admission status: ${error.message}`);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error updating patient admission status:', error);\n    throw error;\n  }\n}\n\n/**\n * Update patient critical status\n * @param uhid - Patient's unique hospital ID\n * @param isCritical - Whether the patient is in critical condition\n * @returns Promise with updated patient data\n */\nexport async function updatePatientCriticalStatus(\n  uhid: string,\n  isCritical: boolean\n): Promise<any> {\n  try {\n    const { data, error } = await supabase\n      .from('patients')\n      .update({ \n        is_critical: isCritical,\n        updated_at: new Date().toISOString()\n      })\n      .eq('patient_id', uhid)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating patient critical status:', error);\n      throw new Error(`Failed to update critical status: ${error.message}`);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error updating patient critical status:', error);\n    throw error;\n  }\n}\n\n/**\n * Update both admission and critical status\n * @param uhid - Patient's unique hospital ID\n * @param isAdmitted - Whether the patient is admitted\n * @param isCritical - Whether the patient is in critical condition\n * @returns Promise with updated patient data\n */\nexport async function updatePatientStatus(\n  uhid: string,\n  isAdmitted?: boolean,\n  isCritical?: boolean\n): Promise<any> {\n  try {\n    const updateData: any = {\n      updated_at: new Date().toISOString()\n    };\n\n    if (isAdmitted !== undefined) {\n      updateData.is_admitted = isAdmitted;\n    }\n\n    if (isCritical !== undefined) {\n      updateData.is_critical = isCritical;\n    }\n\n    const { data, error } = await supabase\n      .from('patients')\n      .update(updateData)\n      .eq('patient_id', uhid)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating patient status:', error);\n      throw new Error(`Failed to update patient status: ${error.message}`);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error updating patient status:', error);\n    throw error;\n  }\n}\n\n/**\n * Get patients by admission status\n * @param isAdmitted - Filter by admission status\n * @param isCritical - Optional filter by critical status\n * @returns Promise with filtered patients\n */\nexport async function getPatientsByStatus(\n  isAdmitted?: boolean,\n  isCritical?: boolean\n): Promise<any[]> {\n  try {\n    let query = supabase\n      .from('patients')\n      .select(`\n        *,\n        users:user_id (\n          id,\n          name,\n          email,\n          role,\n          status,\n          permissions\n        )\n      `);\n\n    if (isAdmitted !== undefined) {\n      query = query.eq('is_admitted', isAdmitted);\n    }\n\n    if (isCritical !== undefined) {\n      query = query.eq('is_critical', isCritical);\n    }\n\n    const { data, error } = await query\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patients by status:', error);\n      throw new Error(`Failed to fetch patients: ${error.message}`);\n    }\n\n    return data || [];\n  } catch (error) {\n    console.error('Error fetching patients by status:', error);\n    throw error;\n  }\n}\n\n/**\n * Get admitted patients count\n * @returns Promise with count of admitted patients\n */\nexport async function getAdmittedPatientsCount(): Promise<number> {\n  try {\n    const { count, error } = await supabase\n      .from('patients')\n      .select('*', { count: 'exact', head: true })\n      .eq('is_admitted', true);\n\n    if (error) {\n      console.error('Error getting admitted patients count:', error);\n      throw new Error(`Failed to get count: ${error.message}`);\n    }\n\n    return count || 0;\n  } catch (error) {\n    console.error('Error getting admitted patients count:', error);\n    throw error;\n  }\n}\n\n/**\n * Get critical patients count\n * @returns Promise with count of critical patients\n */\nexport async function getCriticalPatientsCount(): Promise<number> {\n  try {\n    const { count, error } = await supabase\n      .from('patients')\n      .select('*', { count: 'exact', head: true })\n      .eq('is_critical', true);\n\n    if (error) {\n      console.error('Error getting critical patients count:', error);\n      throw new Error(`Failed to get count: ${error.message}`);\n    }\n\n    return count || 0;\n  } catch (error) {\n    console.error('Error getting critical patients count:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 883, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/vitalsService.ts"],"sourcesContent":["import { supabase } from './supabase';\n\n// Simplified interfaces for the new single vitals table\nexport interface VitalSigns {\n  patientId: string;\n  recordedBy?: string;\n  bloodPressureSystolic?: number;\n  bloodPressureDiastolic?: number;\n  heartRate?: number;\n  temperature?: number;\n  respiratoryRate?: number;\n  oxygenSaturation?: number;\n  weight?: number;\n  height?: number;\n  painScale?: number;\n  bloodGlucose?: number;\n  notes?: string;\n  recordedAt?: string;\n}\n\nexport interface VitalRecord {\n  id: string;\n  patient_id: string;\n  recorded_by: string;\n  blood_pressure_systolic?: number;\n  blood_pressure_diastolic?: number;\n  heart_rate?: number;\n  temperature?: number;\n  respiratory_rate?: number;\n  oxygen_saturation?: number;\n  weight?: number;\n  height?: number;\n  pain_scale?: number;\n  blood_glucose?: number;\n  notes?: string;\n  recorded_at: string;\n  created_at: string;\n  updated_at: string;\n  \n  // Related data\n  patient?: { patient_id: string; name: string };\n  recorded_by_user?: { name: string };\n}\n\n// Record new vitals\nexport async function recordVitals(vitalsData: VitalSigns): Promise<VitalRecord> {\n  try {\n    console.log('recordVitals called with:', vitalsData);\n    \n    // Convert patient display ID to UUID if needed\n    let actualPatientId = vitalsData.patientId;\n    \n    if (!vitalsData.patientId.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\n      const { data: patient, error: patientError } = await supabase\n        .from('patients')\n        .select('id')\n        .eq('patient_id', vitalsData.patientId)\n        .single();\n      \n      if (patientError || !patient) {\n        throw new Error(`Patient not found: ${vitalsData.patientId}`);\n      }\n      \n      actualPatientId = patient.id;\n    }\n\n    // Validate recorded_by field - it must be a valid user ID\n    if (!vitalsData.recordedBy) {\n      console.error('No recordedBy provided:', vitalsData.recordedBy);\n      \n      // Try to get a default user (first doctor or admin)\n      const { data: defaultUser } = await supabase\n        .from('users')\n        .select('id, name, role')\n        .in('role', ['doctor', 'md', 'admin'])\n        .limit(1)\n        .single();\n      \n      if (defaultUser) {\n        console.log('Using default user:', defaultUser);\n        vitalsData.recordedBy = defaultUser.id;\n      } else {\n        throw new Error('No valid user found to record vitals. Please ensure you are logged in.');\n      }\n    }\n\n    console.log('Checking if user exists with ID:', vitalsData.recordedBy);\n    \n    // Verify the user exists\n    const { data: user, error: userError } = await supabase\n      .from('users')\n      .select('id, name, role')\n      .eq('id', vitalsData.recordedBy)\n      .single();\n\n    console.log('User lookup result:', { user, userError });\n\n    if (userError || !user) {\n      console.error('User validation failed:', { userError, user });\n      \n      // Try to get a default user as fallback\n      const { data: fallbackUser } = await supabase\n        .from('users')\n        .select('id, name, role')\n        .in('role', ['doctor', 'md', 'admin'])\n        .limit(1)\n        .single();\n      \n      if (fallbackUser) {\n        console.log('Using fallback user:', fallbackUser);\n        vitalsData.recordedBy = fallbackUser.id;\n      } else {\n        throw new Error(`No valid users found in the system. Please contact administrator.`);\n      }\n    } else {\n      console.log('User validated successfully:', user);\n    }\n\n    const vitalRecord = {\n      patient_id: actualPatientId,\n      recorded_by: vitalsData.recordedBy,\n      blood_pressure_systolic: vitalsData.bloodPressureSystolic,\n      blood_pressure_diastolic: vitalsData.bloodPressureDiastolic,\n      heart_rate: vitalsData.heartRate,\n      temperature: vitalsData.temperature,\n      respiratory_rate: vitalsData.respiratoryRate,\n      oxygen_saturation: vitalsData.oxygenSaturation,\n      weight: vitalsData.weight,\n      height: vitalsData.height,\n      pain_scale: vitalsData.painScale,\n      blood_glucose: vitalsData.bloodGlucose,\n      notes: vitalsData.notes,\n      recorded_at: vitalsData.recordedAt || new Date().toISOString()\n    };\n\n    console.log('Inserting vital record:', vitalRecord);\n\n    const { data, error } = await supabase\n      .from('vitals')\n      .insert(vitalRecord)\n      .select('*')\n      .single();\n\n    console.log('Insert result:', { data, error });\n\n    if (error) {\n      console.error('Database insert error:', error);\n      throw new Error(`Failed to record vitals: ${error.message}`);\n    }\n\n    // Fetch related data\n    const [patientData, userData] = await Promise.all([\n      supabase.from('patients').select('patient_id, name').eq('id', data.patient_id).single(),\n      supabase.from('users').select('name').eq('id', data.recorded_by).single()\n    ]);\n\n    return {\n      ...data,\n      patient: patientData.data,\n      recorded_by_user: userData.data\n    };\n  } catch (error) {\n    console.error('Error in recordVitals:', error);\n    throw error;\n  }\n}\n\n// Get patient vitals history\nexport async function getPatientVitals(patientId: string): Promise<VitalRecord[]> {\n  try {\n    // Convert patient display ID to UUID if needed\n    let actualPatientId = patientId;\n    \n    if (!patientId.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\n      const { data: patient, error: patientError } = await supabase\n        .from('patients')\n        .select('id')\n        .eq('patient_id', patientId)\n        .single();\n      \n      if (patientError || !patient) {\n        return [];\n      }\n      \n      actualPatientId = patient.id;\n    }\n\n    const { data, error } = await supabase\n      .from('vitals')\n      .select('*')\n      .eq('patient_id', actualPatientId)\n      .order('recorded_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patient vitals:', error);\n      throw new Error(`Failed to fetch patient vitals: ${error.message}`);\n    }\n\n    // Fetch related data for each record\n    const vitalsWithRelations = await Promise.all(\n      data.map(async (vital) => {\n        const [patientData, userData] = await Promise.all([\n          supabase.from('patients').select('patient_id, name').eq('id', vital.patient_id).single(),\n          supabase.from('users').select('name').eq('id', vital.recorded_by).single()\n        ]);\n\n        return {\n          ...vital,\n          patient: patientData.data,\n          recorded_by_user: userData.data\n        };\n      })\n    );\n\n    return vitalsWithRelations;\n  } catch (error) {\n    console.error('Error in getPatientVitals:', error);\n    throw error;\n  }\n}\n\n// Get latest vitals for a patient\nexport async function getLatestVitals(patientId: string): Promise<VitalRecord | null> {\n  try {\n    // Convert patient display ID to UUID if needed\n    let actualPatientId = patientId;\n    \n    if (!patientId.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\n      const { data: patient, error: patientError } = await supabase\n        .from('patients')\n        .select('id')\n        .eq('patient_id', patientId)\n        .single();\n      \n      if (patientError || !patient) {\n        return null;\n      }\n      \n      actualPatientId = patient.id;\n    }\n\n    const { data, error } = await supabase\n      .from('vitals')\n      .select('*')\n      .eq('patient_id', actualPatientId)\n      .order('recorded_at', { ascending: false })\n      .limit(1)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return null; // No records found\n      }\n      console.error('Error fetching latest vitals:', error);\n      throw new Error(`Failed to fetch latest vitals: ${error.message}`);\n    }\n\n    // Fetch related data\n    const [patientData, userData] = await Promise.all([\n      supabase.from('patients').select('patient_id, name').eq('id', data.patient_id).single(),\n      supabase.from('users').select('name').eq('id', data.recorded_by).single()\n    ]);\n\n    return {\n      ...data,\n      patient: patientData.data,\n      recorded_by_user: userData.data\n    };\n  } catch (error) {\n    console.error('Error in getLatestVitals:', error);\n    throw error;\n  }\n}\n\n// Update vital record\nexport async function updateVitalRecord(vitalId: string, updates: Partial<VitalSigns>): Promise<VitalRecord> {\n  try {\n    const updateData = {\n      blood_pressure_systolic: updates.bloodPressureSystolic,\n      blood_pressure_diastolic: updates.bloodPressureDiastolic,\n      heart_rate: updates.heartRate,\n      temperature: updates.temperature,\n      respiratory_rate: updates.respiratoryRate,\n      oxygen_saturation: updates.oxygenSaturation,\n      weight: updates.weight,\n      height: updates.height,\n      pain_scale: updates.painScale,\n      blood_glucose: updates.bloodGlucose,\n      notes: updates.notes,\n      updated_at: new Date().toISOString()\n    };\n\n    const { data, error } = await supabase\n      .from('vitals')\n      .update(updateData)\n      .eq('id', vitalId)\n      .select('*')\n      .single();\n\n    if (error) {\n      console.error('Error updating vital record:', error);\n      throw new Error(`Failed to update vital record: ${error.message}`);\n    }\n\n    // Fetch related data\n    const [patientData, userData] = await Promise.all([\n      supabase.from('patients').select('patient_id, name').eq('id', data.patient_id).single(),\n      supabase.from('users').select('name').eq('id', data.recorded_by).single()\n    ]);\n\n    return {\n      ...data,\n      patient: patientData.data,\n      recorded_by_user: userData.data\n    };\n  } catch (error) {\n    console.error('Error in updateVitalRecord:', error);\n    throw error;\n  }\n}\n\n// Delete vital record\nexport async function deleteVitalRecord(vitalId: string): Promise<void> {\n  try {\n    const { error } = await supabase\n      .from('vitals')\n      .delete()\n      .eq('id', vitalId);\n\n    if (error) {\n      console.error('Error deleting vital record:', error);\n      throw new Error(`Failed to delete vital record: ${error.message}`);\n    }\n  } catch (error) {\n    console.error('Error in deleteVitalRecord:', error);\n    throw error;\n  }\n}\n\n// Get vitals summary for dashboard\nexport async function getVitalsSummary(patientId: string): Promise<{\n  latestVitals: VitalRecord | null;\n  totalReadings: number;\n  lastRecordedAt: string | null;\n}> {\n  try {\n    // Convert patient display ID to UUID if needed\n    let actualPatientId = patientId;\n    \n    if (!patientId.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\n      const { data: patient, error: patientError } = await supabase\n        .from('patients')\n        .select('id')\n        .eq('patient_id', patientId)\n        .single();\n      \n      if (patientError || !patient) {\n        return { latestVitals: null, totalReadings: 0, lastRecordedAt: null };\n      }\n      \n      actualPatientId = patient.id;\n    }\n\n    const [latestVitals, countResult] = await Promise.all([\n      getLatestVitals(patientId),\n      supabase.from('vitals').select('*', { count: 'exact', head: true }).eq('patient_id', actualPatientId)\n    ]);\n\n    return {\n      latestVitals,\n      totalReadings: countResult.count || 0,\n      lastRecordedAt: latestVitals?.recorded_at || null\n    };\n  } catch (error) {\n    console.error('Error in getVitalsSummary:', error);\n    return { latestVitals: null, totalReadings: 0, lastRecordedAt: null };\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1151, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/medicalHistoryService.ts"],"sourcesContent":["import { supabase } from './supabase';\n\nexport interface MedicalHistoryEvent {\n  id: string;\n  patient_id: string;\n  event_type: string;\n  event_name: string;\n  event_date: string;\n  details: string | null;\n  doctor_name: string | null;\n  facility_name: string | null;\n  source: 'history' | 'symptom' | 'allergy';\n}\n\nexport interface CreateMedicalHistoryInput {\n  patientId: string;\n  eventType: string;\n  eventName: string;\n  eventDate: string;\n  details?: string;\n  doctorName?: string;\n  facilityName?: string;\n}\n\nexport const createMedicalHistory = async (input: CreateMedicalHistoryInput): Promise<MedicalHistoryEvent> => {\n  if (!input.patientId) {\n    throw new Error('Patient ID is required to create medical history.');\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('medical_history')\n      .insert({\n        patient_id: input.patientId,\n        event_type: input.eventType,\n        event_name: input.eventName,\n        event_date: input.eventDate,\n        details: input.details || null,\n        doctor_name: input.doctorName || null,\n        facility_name: input.facilityName || null\n      })\n      .select()\n      .single();\n\n    if (error) {\n      // Handle case where medical_history table doesn't exist\n      if (error.code === '42P01') {\n        throw new Error('Medical history table does not exist. Please contact system administrator.');\n      }\n      console.error('Error creating medical history:', error);\n      throw new Error('Failed to create medical history entry.');\n    }\n\n    return { ...data, source: 'history' };\n  } catch (error) {\n    console.error('An unexpected error occurred while creating medical history:', error);\n    throw error;\n  }\n};\n\n// Add some dummy medical history data for testing\nexport const addDummyMedicalHistory = async (patientId: string): Promise<MedicalHistoryEvent[]> => {\n  const dummyData: CreateMedicalHistoryInput[] = [\n    {\n      patientId,\n      eventType: 'Diagnosis',\n      eventName: 'Hypertension',\n      eventDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 days ago\n      details: 'Diagnosed with Stage 1 Hypertension. Prescribed lifestyle changes and monitoring.',\n      doctorName: 'Dr. Sarah Johnson',\n      facilityName: 'City General Hospital'\n    },\n    {\n      patientId,\n      eventType: 'Surgery',\n      eventName: 'Appendectomy',\n      eventDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString(), // 6 months ago\n      details: 'Laparoscopic appendectomy performed due to acute appendicitis. Recovery was uneventful.',\n      doctorName: 'Dr. Michael Chen',\n      facilityName: 'University Medical Center'\n    },\n    {\n      patientId,\n      eventType: 'Vaccination',\n      eventName: 'COVID-19 Vaccine',\n      eventDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(), // 3 months ago\n      details: 'Received second dose of COVID-19 vaccine. No adverse reactions reported.',\n      doctorName: 'Dr. Lisa Wong',\n      facilityName: 'Community Health Clinic'\n    }\n  ];\n\n  const results: MedicalHistoryEvent[] = [];\n  \n  for (const entry of dummyData) {\n    try {\n      const result = await createMedicalHistory(entry);\n      results.push(result);\n    } catch (error) {\n      console.error('Error adding dummy data:', error);\n    }\n  }\n\n  return results;\n};\n\nexport const getMedicalHistory = async (patientId: string): Promise<MedicalHistoryEvent[]> => {\n  if (!patientId) {\n    console.error('Patient ID is required to fetch medical history.');\n    return [];\n  }\n\n  try {\n    // Initialize combined history array\n    const combinedHistory: MedicalHistoryEvent[] = [];\n\n    // Fetch from medical_history table (handle if table doesn't exist)\n    try {\n      const { data: historyData, error: historyError } = await supabase\n        .from('medical_history')\n        .select('*')\n        .eq('patient_id', patientId);\n\n      if (historyError) {\n        if (historyError.code === '42P01') {\n          console.log('Medical history table does not exist, skipping');\n        } else if (historyError.code !== 'PGRST116') {\n          console.error('Error fetching medical history:', historyError);\n        }\n      } else if (historyData) {\n        historyData.forEach((item: any) => {\n          combinedHistory.push({ ...item, source: 'history' as const });\n        });\n      }\n    } catch (err: any) {\n      if (err.message?.includes('relation') && err.message?.includes('does not exist')) {\n        console.log('Medical history table does not exist, skipping');\n      } else {\n        console.warn('Medical history table may not exist:', err);\n      }\n    }\n\n    // Fetch from patient_symptoms table (handle if table doesn't exist)\n    try {\n      const { data: symptomsData, error: symptomsError } = await supabase\n        .from('patient_symptoms')\n        .select('*')\n        .eq('patient_id', patientId);\n\n      if (symptomsError) {\n        if (symptomsError.code === '42P01') {\n          console.log('Patient symptoms table does not exist, skipping');\n        } else if (symptomsError.code !== 'PGRST116') {\n          console.error('Error fetching patient symptoms:', symptomsError);\n        }\n      } else if (symptomsData) {\n        symptomsData.forEach((item: any) => {\n          combinedHistory.push({\n            id: item.id,\n            patient_id: item.patient_id,\n            event_type: 'Symptom',\n            event_name: item.symptom_name,\n            event_date: item.recorded_at,\n            details: `Severity: ${item.severity}, Onset: ${item.onset_date}`,\n            doctor_name: null,\n            facility_name: null,\n            source: 'symptom' as const,\n          });\n        });\n      }\n    } catch (err: any) {\n      if (err.message?.includes('relation') && err.message?.includes('does not exist')) {\n        console.log('Patient symptoms table does not exist, skipping');\n      } else {\n        console.warn('Patient symptoms table may not exist:', err);\n      }\n    }\n\n    // Fetch from patient_allergies table (handle if table doesn't exist)\n    try {\n      const { data: allergiesData, error: allergiesError } = await supabase\n        .from('patient_allergies')\n        .select('*')\n        .eq('patient_id', patientId);\n\n      if (allergiesError) {\n        if (allergiesError.code === '42P01') {\n          console.log('Patient allergies table does not exist, skipping');\n        } else if (allergiesError.code !== 'PGRST116') {\n          console.error('Error fetching patient allergies:', allergiesError);\n        }\n      } else if (allergiesData) {\n        allergiesData.forEach((item: any) => {\n          combinedHistory.push({\n            id: item.id,\n            patient_id: item.patient_id,\n            event_type: 'Allergy',\n            event_name: item.allergen,\n            event_date: item.recorded_at,\n            details: `Reaction: ${item.reaction}, Severity: ${item.severity}`,\n            doctor_name: null,\n            facility_name: null,\n            source: 'allergy' as const,\n          });\n        });\n      }\n    } catch (err: any) {\n      if (err.message?.includes('relation') && err.message?.includes('does not exist')) {\n        console.log('Patient allergies table does not exist, skipping');\n      } else {\n        console.warn('Patient allergies table may not exist:', err);\n      }\n    }\n\n    // Sort by event date, most recent first\n    combinedHistory.sort((a, b) => new Date(b.event_date).getTime() - new Date(a.event_date).getTime());\n\n    return combinedHistory;\n\n  } catch (error) {\n    console.error('An unexpected error occurred while fetching medical history:', error);\n    return [];\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1338, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/MedicalHistoryForm.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { X } from 'lucide-react';\nimport { CreateMedicalHistoryInput, createMedicalHistory } from '../lib/medicalHistoryService';\n\ninterface MedicalHistoryFormProps {\n  patientId: string;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport default function MedicalHistoryForm({ patientId, onClose, onSuccess }: MedicalHistoryFormProps) {\n  const [formData, setFormData] = useState<CreateMedicalHistoryInput>({\n    patientId,\n    eventType: '',\n    eventName: '',\n    eventDate: new Date().toISOString().split('T')[0],\n    details: '',\n    doctorName: '',\n    facilityName: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>\n  ) => {\n    const { name, value } = e.target;\n    setFormData((prev) => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    try {\n      await createMedicalHistory(formData);\n      onSuccess();\n      onClose();\n    } catch (err) {\n      console.error('Error creating medical history:', err);\n      setError('Failed to create medical history entry. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg p-6 w-full max-w-lg\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-lg font-medium text-gray-900\">Add Medical Event</h3>\n          <button\n            onClick={onClose}\n            className=\"text-gray-500 hover:text-gray-700\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4\">\n            {error}\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit}>\n          <div className=\"space-y-4\">\n            <div>\n              <label htmlFor=\"eventType\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Event Type\n              </label>\n              <select\n                id=\"eventType\"\n                name=\"eventType\"\n                value={formData.eventType}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                required\n              >\n                <option value=\"\">Select Event Type</option>\n                <option value=\"Diagnosis\">Diagnosis</option>\n                <option value=\"Surgery\">Surgery</option>\n                <option value=\"Vaccination\">Vaccination</option>\n                <option value=\"Medication\">Medication</option>\n                <option value=\"Test\">Test/Lab Result</option>\n                <option value=\"Procedure\">Procedure</option>\n                <option value=\"Visit\">Visit</option>\n                <option value=\"Other\">Other</option>\n              </select>\n            </div>\n            \n            <div>\n              <label htmlFor=\"eventName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Event Name\n              </label>\n              <input\n                type=\"text\"\n                id=\"eventName\"\n                name=\"eventName\"\n                value={formData.eventName}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                placeholder=\"e.g., Appendectomy, Flu Shot, etc.\"\n                required\n              />\n            </div>\n            \n            <div>\n              <label htmlFor=\"eventDate\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Date\n              </label>\n              <input\n                type=\"date\"\n                id=\"eventDate\"\n                name=\"eventDate\"\n                value={formData.eventDate}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                required\n              />\n            </div>\n            \n            <div>\n              <label htmlFor=\"details\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Details\n              </label>\n              <textarea\n                id=\"details\"\n                name=\"details\"\n                value={formData.details || ''}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                rows={3}\n                placeholder=\"Enter any relevant details about this medical event\"\n              />\n            </div>\n            \n            <div>\n              <label htmlFor=\"doctorName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Doctor Name\n              </label>\n              <input\n                type=\"text\"\n                id=\"doctorName\"\n                name=\"doctorName\"\n                value={formData.doctorName || ''}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                placeholder=\"Dr. Name (optional)\"\n              />\n            </div>\n            \n            <div>\n              <label htmlFor=\"facilityName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Facility Name\n              </label>\n              <input\n                type=\"text\"\n                id=\"facilityName\"\n                name=\"facilityName\"\n                value={formData.facilityName || ''}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                placeholder=\"Hospital or clinic name (optional)\"\n              />\n            </div>\n            \n            <div className=\"flex justify-end gap-2 pt-4\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\"\n                disabled={loading}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                className=\"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 disabled:bg-orange-300\"\n                disabled={loading}\n              >\n                {loading ? 'Saving...' : 'Save Medical Event'}\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1746, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/AddDummyMedicalHistory.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { addDummyMedicalHistory } from '../lib/medicalHistoryService';\n\ninterface AddDummyMedicalHistoryProps {\n  patientId: string;\n  onSuccess: () => void;\n}\n\nexport default function AddDummyMedicalHistory({ patientId, onSuccess }: AddDummyMedicalHistoryProps) {\n  const [loading, setLoading] = useState(false);\n\n  const handleAddDummyData = async () => {\n    if (!patientId) return;\n    \n    setLoading(true);\n    try {\n      await addDummyMedicalHistory(patientId);\n      onSuccess();\n    } catch (error) {\n      console.error('Error adding dummy data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleAddDummyData}\n      disabled={loading}\n      className=\"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2 disabled:bg-blue-300\"\n    >\n      {loading ? 'Adding...' : 'Add Dummy Data'}\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAOe,SAAS,uBAAuB,EAAE,SAAS,EAAE,SAAS,EAA+B;IAClG,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,qBAAqB;QACzB,IAAI,CAAC,WAAW;QAEhB,WAAW;QACX,IAAI;YACF,MAAM,CAAA,GAAA,mIAAA,CAAA,yBAAsB,AAAD,EAAE;YAC7B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;QAC5C,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,8OAAC;QACC,SAAS;QACT,UAAU;QACV,WAAU;kBAET,UAAU,cAAc;;;;;;AAG/B","debugId":null}},
    {"offset": {"line": 1786, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/pharmacyService.ts"],"sourcesContent":["import { supabase } from './supabase';\n\n// =====================================================\n// INTERFACES AND TYPES\n// =====================================================\n\nexport interface Medication {\n  id: string;\n  medication_code: string;\n  name: string;\n  generic_name: string;\n  manufacturer: string;\n  category: string;\n  dosage_form: string;\n  strength: string;\n  unit_price: number;\n  stock_quantity: number;\n  minimum_stock_level: number;\n  maximum_stock_level?: number;\n  batch_number?: string;\n  expiry_date?: string;\n  storage_conditions?: string;\n  prescription_required: boolean;\n  status: 'active' | 'inactive' | 'discontinued';\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface StockTransaction {\n  id: string;\n  medication_id: string;\n  transaction_id: string;\n  transaction_type: 'purchase' | 'sale' | 'adjustment' | 'return' | 'expired';\n  quantity: number;\n  unit_price: number;\n  total_amount: number;\n  batch_number?: string;\n  expiry_date?: string;\n  supplier_name?: string;\n  customer_name?: string;\n  notes?: string;\n  created_by: string;\n  created_at: string;\n}\n\nexport interface MedicationHistory {\n  id: string;\n  patient_id: string;\n  medication_name: string;\n  generic_name: string;\n  dosage: string;\n  frequency: string;\n  duration: string;\n  prescribed_date: string;\n  dispensed_date?: string;\n  prescribed_by: string;\n  dispensed_by?: string;\n  status: 'prescribed' | 'dispensed' | 'completed' | 'discontinued';\n  total_amount?: number;\n  payment_status?: string;\n}\n\nexport interface PharmacyBilling {\n  id: string;\n  bill_number: string;\n  patient_id: string;\n  patient_name?: string;\n  items: PharmacyBillItem[];\n  subtotal: number;\n  discount: number;\n  tax_amount: number;\n  tax_rate: number;\n  total_amount: number;\n  payment_method: 'cash' | 'card' | 'insurance' | 'online';\n  payment_status: 'pending' | 'paid' | 'partial' | 'refunded';\n  created_by: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface PharmacyBillItem {\n  id?: string;\n  medication_id: string;\n  medication_name?: string;\n  quantity: number;\n  unit_price: number;\n  total_price: number;\n}\n\nexport interface PrescriptionDispensing {\n  id: string;\n  prescription_id: string;\n  medication_id: string;\n  quantity_prescribed: number;\n  quantity_dispensed: number;\n  dispensed_by: string;\n  dispensed_at: string;\n  notes?: string;\n  status: 'pending' | 'partial' | 'complete';\n}\n\n// =====================================================\n// MEDICATION MANAGEMENT\n// =====================================================\n\nexport async function getMedications(filters?: {\n  category?: string;\n  prescription_required?: boolean;\n  search?: string;\n  status?: string;\n}): Promise<Medication[]> {\n  try {\n    let query = supabase\n      .from('medications')\n      .select('*')\n      .order('name');\n\n    if (filters?.category) {\n      query = query.eq('category', filters.category);\n    }\n\n    if (filters?.prescription_required !== undefined) {\n      query = query.eq('prescription_required', filters.prescription_required);\n    }\n\n    if (filters?.status) {\n      query = query.eq('status', filters.status);\n    }\n\n    if (filters?.search) {\n      query = query.or(`name.ilike.%${filters.search}%,generic_name.ilike.%${filters.search}%,medication_code.ilike.%${filters.search}%`);\n    }\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error('Error fetching medications:', error);\n      throw error;\n    }\n\n    return data || [];\n  } catch (error) {\n    console.error('Error in getMedications:', error);\n    throw error;\n  }\n}\n\nexport async function getMedicationById(id: string): Promise<Medication | null> {\n  try {\n    const { data, error } = await supabase\n      .from('medications')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      console.error('Error fetching medication:', error);\n      throw error;\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error in getMedicationById:', error);\n    throw error;\n  }\n}\n\nexport async function getLowStockMedications(): Promise<Medication[]> {\n  try {\n    const { data, error } = await supabase\n      .from('medications')\n      .select('*')\n      .filter('stock_quantity', 'lte', 'minimum_stock_level')\n      .eq('status', 'active')\n      .order('stock_quantity');\n\n    if (error) {\n      console.error('Error fetching low stock medications:', error);\n      throw error;\n    }\n\n    return data || [];\n  } catch (error) {\n    console.error('Error in getLowStockMedications:', error);\n    throw error;\n  }\n}\n\n// =====================================================\n// STOCK MANAGEMENT\n// =====================================================\n\nexport async function addStock(\n  medicationId: string,\n  quantity: number,\n  unitPrice: number,\n  batchNumber?: string,\n  expiryDate?: string,\n  supplierName?: string,\n  notes?: string,\n  createdBy?: string\n): Promise<StockTransaction> {\n  try {\n    // Generate transaction ID\n    const transactionId = `TXN${Date.now()}${Math.floor(Math.random() * 1000)}`;\n\n    const { data, error } = await supabase\n      .from('pharmacy_stock_transactions')\n      .insert({\n        medication_id: medicationId,\n        transaction_id: transactionId,\n        transaction_type: 'purchase',\n        quantity,\n        unit_price: unitPrice,\n        total_amount: quantity * unitPrice,\n        batch_number: batchNumber,\n        expiry_date: expiryDate,\n        supplier_name: supplierName,\n        notes,\n        created_by: createdBy\n      })\n      .select('*')\n      .single();\n\n    if (error) {\n      console.error('Error adding stock:', error);\n      throw error;\n    }\n\n    // Update medication stock quantity\n    const { data: currentMed } = await supabase\n      .from('medications')\n      .select('stock_quantity')\n      .eq('id', medicationId)\n      .single();\n\n    if (currentMed) {\n      await supabase\n        .from('medications')\n        .update({\n          stock_quantity: currentMed.stock_quantity + quantity,\n          unit_price: unitPrice,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', medicationId);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error in addStock:', error);\n    throw error;\n  }\n}\n\nexport async function getStockTransactions(\n  medicationId?: string,\n  transactionType?: string,\n  limit: number = 50\n): Promise<StockTransaction[]> {\n  try {\n    let query = supabase\n      .from('pharmacy_stock_transactions')\n      .select('*')\n      .order('created_at', { ascending: false })\n      .limit(limit);\n\n    if (medicationId) {\n      query = query.eq('medication_id', medicationId);\n    }\n\n    if (transactionType) {\n      query = query.eq('transaction_type', transactionType);\n    }\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error('Error fetching stock transactions:', error);\n      throw error;\n    }\n\n    return data || [];\n  } catch (error) {\n    console.error('Error in getStockTransactions:', error);\n    throw error;\n  }\n}\n\n// =====================================================\n// PATIENT MEDICATION HISTORY\n// =====================================================\n\nexport async function getPatientMedicationHistory(patientId: string): Promise<MedicationHistory[]> {\n  try {\n    const history: MedicationHistory[] = [];\n\n    // Get prescribed medications from prescriptions\n    const { data: prescriptions, error: prescError } = await supabase\n      .from('prescriptions')\n      .select(`\n        id,\n        created_at,\n        doctor_id,\n        prescription_items(\n          medication_id,\n          dosage,\n          frequency,\n          duration\n        )\n      `)\n      .eq('patient_id', patientId)\n      .order('created_at', { ascending: false });\n\n    if (prescError) {\n      console.error('Error fetching prescriptions:', prescError);\n    } else if (prescriptions) {\n      // Get doctor names\n      const doctorIds = [...new Set(prescriptions.map(p => p.doctor_id))];\n      const { data: doctors } = await supabase\n        .from('users')\n        .select('id, name')\n        .in('id', doctorIds);\n\n      // Get medicine names\n      const medicineIds = prescriptions.flatMap(p => \n        p.prescription_items?.map(item => item.medication_id) || []\n      );\n      const { data: medicines } = await supabase\n        .from('medications')\n        .select('id, name, generic_name')\n        .in('id', medicineIds);\n\n      prescriptions.forEach(prescription => {\n        const doctor = doctors?.find(d => d.id === prescription.doctor_id);\n        \n        prescription.prescription_items?.forEach(item => {\n          const medicine = medicines?.find(m => m.id === item.medication_id);\n          \n          history.push({\n            id: `presc_${prescription.id}_${item.medication_id}`,\n            patient_id: patientId,\n            medication_name: medicine?.name || 'Unknown',\n            generic_name: medicine?.generic_name || '',\n            dosage: item.dosage || '',\n            frequency: item.frequency || '',\n            duration: item.duration || '',\n            prescribed_date: prescription.created_at,\n            prescribed_by: doctor?.name || 'Unknown Doctor',\n            status: 'prescribed'\n          });\n        });\n      });\n    }\n\n    // Get dispensed medications\n    const { data: dispensed, error: dispError } = await supabase\n      .from('prescription_dispensed')\n      .select(`\n        id,\n        dispensed_at,\n        total_amount,\n        payment_status,\n        dispensed_by,\n        prescription_dispensed_items(\n          medication_id,\n          quantity_dispensed,\n          unit_price,\n          total_price\n        )\n      `)\n      .eq('patient_id', patientId)\n      .order('dispensed_at', { ascending: false });\n\n    if (dispError) {\n      console.error('Error fetching dispensed medications:', dispError);\n    } else if (dispensed) {\n      // Get pharmacist names\n      const pharmacistIds = [...new Set(dispensed.map(d => d.dispensed_by))];\n      const { data: pharmacists } = await supabase\n        .from('users')\n        .select('id, name')\n        .in('id', pharmacistIds);\n\n      // Get medication names\n      const medicationIds = dispensed.flatMap(d => \n        d.prescription_dispensed_items?.map(item => item.medication_id) || []\n      );\n      const { data: medications } = await supabase\n        .from('medications')\n        .select('id, name, generic_name, strength, dosage_form')\n        .in('id', medicationIds);\n\n      dispensed.forEach(dispense => {\n        const pharmacist = pharmacists?.find(p => p.id === dispense.dispensed_by);\n        \n        dispense.prescription_dispensed_items?.forEach(item => {\n          const medication = medications?.find(m => m.id === item.medication_id);\n          \n          history.push({\n            id: `disp_${dispense.id}_${item.medication_id}`,\n            patient_id: patientId,\n            medication_name: medication?.name || 'Unknown',\n            generic_name: medication?.generic_name || '',\n            dosage: `${medication?.strength} ${medication?.dosage_form}` || '',\n            frequency: `Qty: ${item.quantity_dispensed}`,\n            duration: '',\n            prescribed_date: '',\n            dispensed_date: dispense.dispensed_at,\n            prescribed_by: '',\n            dispensed_by: pharmacist?.name || 'Unknown Pharmacist',\n            status: 'dispensed',\n            total_amount: item.total_price,\n            payment_status: dispense.payment_status\n          });\n        });\n      });\n    }\n\n    // Sort by date (most recent first)\n    history.sort((a, b) => {\n      const dateA = new Date(a.dispensed_date || a.prescribed_date);\n      const dateB = new Date(b.dispensed_date || b.prescribed_date);\n      return dateB.getTime() - dateA.getTime();\n    });\n\n    return history;\n  } catch (error) {\n    console.error('Error in getPatientMedicationHistory:', error);\n    throw error;\n  }\n}\n\n// =====================================================\n// DASHBOARD ANALYTICS\n// =====================================================\n\nexport async function getPharmacyDashboardStats(): Promise<{\n  totalMedications: number;\n  lowStockCount: number;\n  todaySales: number;\n  pendingBills: number;\n  totalRevenue: number;\n  prescriptionsDispensed: number;\n}> {\n  try {\n    // Get total medications\n    const { count: totalMedications } = await supabase\n      .from('medications')\n      .select('*', { count: 'exact', head: true })\n      .eq('status', 'active');\n\n    // Get low stock count\n    const { count: lowStockCount } = await supabase\n      .from('medications')\n      .select('*', { count: 'exact', head: true })\n      .filter('stock_quantity', 'lte', 'minimum_stock_level')\n      .eq('status', 'active');\n\n    // Get today's sales\n    const today = new Date().toISOString().split('T')[0];\n    const { data: todaySalesData } = await supabase\n      .from('pharmacy_stock_transactions')\n      .select('total_amount')\n      .eq('transaction_type', 'sale')\n      .gte('created_at', `${today}T00:00:00`)\n      .lt('created_at', `${today}T23:59:59`);\n\n    const todaySales = todaySalesData?.reduce((sum, transaction) => sum + transaction.total_amount, 0) || 0;\n\n    // Get pending bills count\n    const { count: pendingBills } = await supabase\n      .from('pharmacy_billing')\n      .select('*', { count: 'exact', head: true })\n      .eq('payment_status', 'pending');\n\n    // Get total revenue (this month)\n    const firstDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString();\n    const { data: revenueData } = await supabase\n      .from('pharmacy_billing')\n      .select('final_amount')\n      .eq('payment_status', 'paid')\n      .gte('created_at', firstDayOfMonth);\n\n    const totalRevenue = revenueData?.reduce((sum, bill) => sum + bill.final_amount, 0) || 0;\n\n    // Get prescriptions dispensed today\n    const { count: prescriptionsDispensed } = await supabase\n      .from('prescription_items')\n      .select('*', { count: 'exact', head: true })\n      .eq('status', 'dispensed')\n      .gte('updated_at', `${today}T00:00:00`)\n      .lt('updated_at', `${today}T23:59:59`);\n\n    return {\n      totalMedications: totalMedications || 0,\n      lowStockCount: lowStockCount || 0,\n      todaySales,\n      pendingBills: pendingBills || 0,\n      totalRevenue,\n      prescriptionsDispensed: prescriptionsDispensed || 0\n    };\n  } catch (error) {\n    console.error('Error in getPharmacyDashboardStats:', error);\n    return {\n      totalMedications: 0,\n      lowStockCount: 0,\n      todaySales: 0,\n      pendingBills: 0,\n      totalRevenue: 0,\n      prescriptionsDispensed: 0\n    };\n  }\n}\n\n// =====================================================\n// PRESCRIPTION MANAGEMENT\n// =====================================================\n\nexport interface PendingPrescription {\n  id: string;\n  prescription_id: string;\n  patient_id: string;\n  patient_name: string;\n  doctor_name: string;\n  issue_date: string;\n  status: string;\n  total_items: number;\n  total_amount: number;\n  prescription_items: {\n    id: string;\n    medication_id: string;\n    medication_name: string;\n    quantity: number;\n    unit_price: number;\n    total_price: number;\n  }[];\n}\n\nexport async function getPendingPrescriptions(): Promise<PendingPrescription[]> {\n  try {\n    const { data: prescriptions, error } = await supabase\n      .from('prescriptions')\n      .select(`\n        id,\n        prescription_id,\n        patient_id,\n        doctor_id,\n        issue_date,\n        status,\n        patients!inner(name),\n        users!inner(name),\n        prescription_items(\n          id,\n          medication_id,\n          medication_name,\n          quantity,\n          unit_price,\n          total_price\n        )\n      `)\n      .eq('status', 'pending')\n      .order('issue_date', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching pending prescriptions:', error);\n      throw error;\n    }\n\n    const formattedPrescriptions: PendingPrescription[] = (prescriptions || []).map(prescription => ({\n      id: prescription.id,\n      prescription_id: prescription.prescription_id,\n      patient_id: prescription.patient_id,\n      patient_name: (prescription.patients as any)?.name || 'Unknown Patient',\n      doctor_name: (prescription.users as any)?.name || 'Unknown Doctor',\n      issue_date: prescription.issue_date,\n      status: prescription.status,\n      total_items: prescription.prescription_items?.length || 0,\n      total_amount: prescription.prescription_items?.reduce((sum, item) => sum + item.total_price, 0) || 0,\n      prescription_items: prescription.prescription_items || []\n    }));\n\n    return formattedPrescriptions;\n  } catch (error) {\n    console.error('Error in getPendingPrescriptions:', error);\n    throw error;\n  }\n}\n\n// =====================================================\n// UTILITY FUNCTIONS\n// =====================================================\n\nexport async function searchMedications(searchTerm: string): Promise<Medication[]> {\n  return getMedications({ search: searchTerm, status: 'active' });\n}\n\nexport async function getMedicationCategories(): Promise<string[]> {\n  try {\n    const { data, error } = await supabase\n      .from('medications')\n      .select('category')\n      .eq('status', 'active');\n\n    if (error) {\n      console.error('Error fetching categories:', error);\n      return [];\n    }\n\n    const categories = [...new Set(data?.map(item => item.category) || [])];\n    return categories.sort();\n  } catch (error) {\n    console.error('Error in getMedicationCategories:', error);\n    return [];\n  }\n}\n\n// =====================================================\n// STOCK ADJUSTMENT FUNCTIONS\n// =====================================================\n\nexport async function adjustStock(\n  medicationId: string,\n  adjustmentQuantity: number,\n  reason: string,\n  notes: string,\n  userId: string\n): Promise<StockTransaction> {\n  try {\n    // Get current stock\n    const { data: medication, error: medicationError } = await supabase\n      .from('medications')\n      .select('stock_quantity')\n      .eq('id', medicationId)\n      .single();\n\n    if (medicationError) {\n      throw new Error('Failed to fetch medication');\n    }\n\n    // Calculate new stock quantity\n    const newStockQuantity = Math.max(0, medication.stock_quantity + adjustmentQuantity);\n\n    // Update medication stock\n    const { error: updateError } = await supabase\n      .from('medications')\n      .update({ \n        stock_quantity: newStockQuantity,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', medicationId);\n\n    if (updateError) {\n      throw new Error('Failed to update medication stock');\n    }\n\n    // Create stock transaction record\n    const transactionId = `ADJ-${Date.now()}`;\n    const { data: transaction, error: transactionError } = await supabase\n      .from('pharmacy_stock_transactions')\n      .insert({\n        medication_id: medicationId,\n        transaction_id: transactionId,\n        transaction_type: 'adjustment',\n        quantity: Math.abs(adjustmentQuantity),\n        unit_price: 0,\n        total_amount: 0,\n        notes: `${reason}: ${notes}`,\n        created_by: userId,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (transactionError) {\n      throw new Error('Failed to create stock transaction');\n    }\n\n    return transaction;\n  } catch (error) {\n    console.error('Error in adjustStock:', error);\n    throw error;\n  }\n}\n\n// =====================================================\n// PHARMACY BILLING FUNCTIONS\n// =====================================================\n\nexport async function createPharmacyBill(\n  patientId: string,\n  items: { medication_id: string; quantity: number; unit_price: number }[],\n  discount: number,\n  taxRate: number,\n  paymentMethod: string,\n  userId: string\n): Promise<PharmacyBilling> {\n  try {\n    // Calculate totals\n    const subtotal = items.reduce((sum, item) => sum + (item.quantity * item.unit_price), 0);\n    const discountAmount = (subtotal * discount) / 100;\n    const taxableAmount = subtotal - discountAmount;\n    const taxAmount = (taxableAmount * taxRate) / 100;\n    const totalAmount = taxableAmount + taxAmount;\n\n    // Generate bill number\n    const billNumber = `PH${Date.now()}`;\n\n    // Create bill\n    const { data: bill, error: billError } = await supabase\n      .from('pharmacy_billing')\n      .insert({\n        bill_number: billNumber,\n        patient_id: patientId,\n        subtotal,\n        discount: discountAmount,\n        tax_amount: taxAmount,\n        tax_rate: taxRate,\n        final_amount: totalAmount,\n        payment_method: paymentMethod,\n        payment_status: 'paid',\n        created_by: userId,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (billError) {\n      throw new Error('Failed to create pharmacy bill');\n    }\n\n    // Create bill items and update stock\n    for (const item of items) {\n      // Create bill item\n      await supabase\n        .from('pharmacy_bill_items')\n        .insert({\n          bill_id: bill.id,\n          medication_id: item.medication_id,\n          quantity: item.quantity,\n          unit_price: item.unit_price,\n          total_price: item.quantity * item.unit_price\n        });\n\n      // Update medication stock\n      const { data: medication } = await supabase\n        .from('medications')\n        .select('stock_quantity')\n        .eq('id', item.medication_id)\n        .single();\n\n      if (medication) {\n        const newStock = Math.max(0, medication.stock_quantity - item.quantity);\n        await supabase\n          .from('medications')\n          .update({ stock_quantity: newStock })\n          .eq('id', item.medication_id);\n\n        // Create stock transaction\n        const transactionId = `SALE-${Date.now()}-${item.medication_id}`;\n        await supabase\n          .from('pharmacy_stock_transactions')\n          .insert({\n            medication_id: item.medication_id,\n            transaction_id: transactionId,\n            transaction_type: 'sale',\n            quantity: item.quantity,\n            unit_price: item.unit_price,\n            total_amount: item.quantity * item.unit_price,\n            notes: `Sold via bill ${billNumber}`,\n            created_by: userId,\n            created_at: new Date().toISOString()\n          });\n      }\n    }\n\n    return {\n      ...bill,\n      total_amount: totalAmount,\n      items: items.map(item => ({\n        medication_id: item.medication_id,\n        quantity: item.quantity,\n        unit_price: item.unit_price,\n        total_price: item.quantity * item.unit_price\n      }))\n    };\n  } catch (error) {\n    console.error('Error in createPharmacyBill:', error);\n    throw error;\n  }\n}\n\nexport async function getPharmacyBills(patientId?: string): Promise<PharmacyBilling[]> {\n  try {\n    let query = supabase\n      .from('pharmacy_billing')\n      .select(`\n        *,\n        patient:patients(first_name, last_name)\n      `)\n      .order('created_at', { ascending: false });\n\n    if (patientId) {\n      query = query.eq('patient_id', patientId);\n    }\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error('Error fetching pharmacy bills:', error);\n      return [];\n    }\n\n    // Transform data to include patient name and total_amount\n    const bills = data?.map(bill => ({\n      ...bill,\n      patient_name: bill.patient ? `${bill.patient.first_name} ${bill.patient.last_name}` : 'Unknown',\n      total_amount: bill.final_amount,\n      items: [] // Items would need to be fetched separately if needed\n    })) || [];\n\n    return bills;\n  } catch (error) {\n    console.error('Error in getPharmacyBills:', error);\n    return [];\n  }\n}\n\n// =====================================================\n// PRESCRIPTION DISPENSING FUNCTIONS\n// =====================================================\n\nexport async function dispensePrescription(\n  prescriptionId: string,\n  medicationId: string,\n  quantityDispensed: number,\n  userId: string,\n  notes?: string\n): Promise<PrescriptionDispensing> {\n  try {\n    // Create dispensing record\n    const { data: dispensing, error: dispensingError } = await supabase\n      .from('prescription_dispensing')\n      .insert({\n        prescription_id: prescriptionId,\n        medication_id: medicationId,\n        quantity_dispensed: quantityDispensed,\n        dispensed_by: userId,\n        dispensed_at: new Date().toISOString(),\n        notes,\n        status: 'complete'\n      })\n      .select()\n      .single();\n\n    if (dispensingError) {\n      throw new Error('Failed to create dispensing record');\n    }\n\n    // Update medication stock\n    const { data: medication } = await supabase\n      .from('medications')\n      .select('stock_quantity')\n      .eq('id', medicationId)\n      .single();\n\n    if (medication) {\n      const newStock = Math.max(0, medication.stock_quantity - quantityDispensed);\n      await supabase\n        .from('medications')\n        .update({ stock_quantity: newStock })\n        .eq('id', medicationId);\n\n      // Create stock transaction\n      const transactionId = `DISP-${Date.now()}-${prescriptionId}`;\n      await supabase\n        .from('pharmacy_stock_transactions')\n        .insert({\n          medication_id: medicationId,\n          transaction_id: transactionId,\n          transaction_type: 'sale',\n          quantity: quantityDispensed,\n          unit_price: 0,\n          total_amount: 0,\n          notes: `Dispensed for prescription ${prescriptionId}`,\n          created_by: userId,\n          created_at: new Date().toISOString()\n        });\n    }\n\n    return dispensing;\n  } catch (error) {\n    console.error('Error in dispensePrescription:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2329, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/MedicationHistory.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { \n  Pill, \n  Calendar, \n  Clock, \n  User, \n  Package, \n  ShoppingCart, \n  AlertCircle, \n  CheckCircle, \n  XCircle,\n  Plus,\n  Search,\n  Filter\n} from 'lucide-react';\nimport { getPatientMedicationHistory, type MedicationHistory } from '../lib/pharmacyService';\n\ninterface MedicationHistoryProps {\n  patientId: string;\n}\n\nexport default function MedicationHistory({ patientId }: MedicationHistoryProps) {\n  const [medicationHistory, setMedicationHistory] = useState<MedicationHistory[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [filter, setFilter] = useState<'all' | 'prescribed' | 'dispensed'>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  useEffect(() => {\n    loadMedicationHistory();\n  }, [patientId]);\n\n  const loadMedicationHistory = async () => {\n    try {\n      setLoading(true);\n      const history = await getPatientMedicationHistory(patientId);\n      setMedicationHistory(history);\n    } catch (err) {\n      setError('Failed to load medication history');\n      console.error('Error loading medication history:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredHistory = medicationHistory.filter(item => {\n    const matchesFilter = filter === 'all' || \n      (filter === 'prescribed' && !item.dispensed_date) ||\n      (filter === 'dispensed' && item.dispensed_date);\n    \n    const matchesSearch = !searchTerm || \n      item.medication_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      item.dosage.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    return matchesFilter && matchesSearch;\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getStatusIcon = (item: MedicationHistory) => {\n    if (item.dispensed_date) {\n      return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\n    }\n    return <Clock className=\"h-5 w-5 text-yellow-500\" />;\n  };\n\n  const getStatusText = (item: MedicationHistory) => {\n    if (item.dispensed_date) {\n      return 'Dispensed';\n    }\n    return 'Prescribed';\n  };\n\n  const getStatusColor = (item: MedicationHistory) => {\n    if (item.dispensed_date) {\n      return 'bg-green-100 text-green-800 border-green-200';\n    }\n    return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500\"></div>\n        <span className=\"ml-3 text-gray-600\">Loading medication history...</span>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n        <div className=\"flex items-center\">\n          <AlertCircle className=\"h-5 w-5 text-red-500 mr-2\" />\n          <span className=\"text-red-700\">{error}</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2 bg-orange-100 rounded-lg\">\n            <Pill className=\"h-5 w-5 text-orange-600\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-gray-900\">Medication History</h3>\n            <p className=\"text-sm text-gray-600\">Prescribed and dispensed medications</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Filters and Search */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search medications...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => setFilter('all')}\n            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n              filter === 'all'\n                ? 'bg-orange-100 text-orange-700 border border-orange-200'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            All\n          </button>\n          <button\n            onClick={() => setFilter('prescribed')}\n            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n              filter === 'prescribed'\n                ? 'bg-orange-100 text-orange-700 border border-orange-200'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            Prescribed\n          </button>\n          <button\n            onClick={() => setFilter('dispensed')}\n            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n              filter === 'dispensed'\n                ? 'bg-orange-100 text-orange-700 border border-orange-200'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            Dispensed\n          </button>\n        </div>\n      </div>\n\n      {/* Medication List */}\n      {filteredHistory.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <Pill className=\"h-12 w-12 text-gray-300 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No medications found</h3>\n          <p className=\"text-gray-600\">\n            {searchTerm || filter !== 'all' \n              ? 'Try adjusting your search or filter criteria.'\n              : 'No medications have been prescribed for this patient yet.'\n            }\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {filteredHistory.map((item, index) => (\n            <div key={index} className=\"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <div className=\"p-2 bg-blue-100 rounded-lg\">\n                      <Pill className=\"h-4 w-4 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">{item.medication_name}</h4>\n                      <p className=\"text-sm text-gray-600\">{item.dosage}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-3\">\n                    <div className=\"flex items-center text-sm text-gray-600\">\n                      <Calendar className=\"h-4 w-4 mr-2\" />\n                      <span>Prescribed: {formatDate(item.prescribed_date)}</span>\n                    </div>\n                    \n                    {item.dispensed_date && (\n                      <div className=\"flex items-center text-sm text-gray-600\">\n                        <ShoppingCart className=\"h-4 w-4 mr-2\" />\n                        <span>Dispensed: {formatDate(item.dispensed_date)}</span>\n                      </div>\n                    )}\n                    \n                    <div className=\"flex items-center text-sm text-gray-600\">\n                      <User className=\"h-4 w-4 mr-2\" />\n                      <span>By: {item.prescribed_by}</span>\n                    </div>\n                    \n                    <div className=\"flex items-center text-sm text-gray-600\">\n                      <Package className=\"h-4 w-4 mr-2\" />\n                      <span>Frequency: {item.frequency}</span>\n                    </div>\n                    \n                    <div className=\"flex items-center text-sm text-gray-600\">\n                      <Clock className=\"h-4 w-4 mr-2\" />\n                      <span>Duration: {item.duration}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-center gap-2 ml-4\">\n                  {getStatusIcon(item)}\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium border ${getStatusColor(item)}`}>\n                    {getStatusText(item)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAjBA;;;;;AAuBe,SAAS,kBAAkB,EAAE,SAAS,EAA0B;IAC7E,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAuB,EAAE;IAClF,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAsC;IACzE,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,wBAAwB;QAC5B,IAAI;YACF,WAAW;YACX,MAAM,UAAU,MAAM,CAAA,GAAA,6HAAA,CAAA,8BAA2B,AAAD,EAAE;YAClD,qBAAqB;QACvB,EAAE,OAAO,KAAK;YACZ,SAAS;YACT,QAAQ,KAAK,CAAC,qCAAqC;QACrD,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,kBAAkB,kBAAkB,MAAM,CAAC,CAAA;QAC/C,MAAM,gBAAgB,WAAW,SAC9B,WAAW,gBAAgB,CAAC,KAAK,cAAc,IAC/C,WAAW,eAAe,KAAK,cAAc;QAEhD,MAAM,gBAAgB,CAAC,cACrB,KAAK,eAAe,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW,OAClE,KAAK,MAAM,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW;QAE3D,OAAO,iBAAiB;IAC1B;IAEA,MAAM,aAAa,CAAC;QAClB,OAAO,IAAI,KAAK,YAAY,kBAAkB,CAAC,SAAS;YACtD,MAAM;YACN,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;QACV;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,KAAK,cAAc,EAAE;YACvB,qBAAO,8OAAC,2NAAA,CAAA,cAAW;gBAAC,WAAU;;;;;;QAChC;QACA,qBAAO,8OAAC,oMAAA,CAAA,QAAK;YAAC,WAAU;;;;;;IAC1B;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,KAAK,cAAc,EAAE;YACvB,OAAO;QACT;QACA,OAAO;IACT;IAEA,MAAM,iBAAiB,CAAC;QACtB,IAAI,KAAK,cAAc,EAAE;YACvB,OAAO;QACT;QACA,OAAO;IACT;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;;;;;8BACf,8OAAC;oBAAK,WAAU;8BAAqB;;;;;;;;;;;;IAG3C;IAEA,IAAI,OAAO;QACT,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,oNAAA,CAAA,cAAW;wBAAC,WAAU;;;;;;kCACvB,8OAAC;wBAAK,WAAU;kCAAgB;;;;;;;;;;;;;;;;;IAIxC;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,kMAAA,CAAA,OAAI;gCAAC,WAAU;;;;;;;;;;;sCAElB,8OAAC;;8CACC,8OAAC;oCAAG,WAAU;8CAA8B;;;;;;8CAC5C,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;;;;;;;;;;;;;;;;;;0BAM3C,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAI,WAAU;;8CACb,8OAAC,sMAAA,CAAA,SAAM;oCAAC,WAAU;;;;;;8CAClB,8OAAC;oCACC,MAAK;oCACL,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;oCAC7C,WAAU;;;;;;;;;;;;;;;;;kCAIhB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,SAAS,IAAM,UAAU;gCACzB,WAAW,CAAC,2DAA2D,EACrE,WAAW,QACP,2DACA,+CACJ;0CACH;;;;;;0CAGD,8OAAC;gCACC,SAAS,IAAM,UAAU;gCACzB,WAAW,CAAC,2DAA2D,EACrE,WAAW,eACP,2DACA,+CACJ;0CACH;;;;;;0CAGD,8OAAC;gCACC,SAAS,IAAM,UAAU;gCACzB,WAAW,CAAC,2DAA2D,EACrE,WAAW,cACP,2DACA,+CACJ;0CACH;;;;;;;;;;;;;;;;;;YAOJ,gBAAgB,MAAM,KAAK,kBAC1B,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,kMAAA,CAAA,OAAI;wBAAC,WAAU;;;;;;kCAChB,8OAAC;wBAAG,WAAU;kCAAyC;;;;;;kCACvD,8OAAC;wBAAE,WAAU;kCACV,cAAc,WAAW,QACtB,kDACA;;;;;;;;;;;qCAKR,8OAAC;gBAAI,WAAU;0BACZ,gBAAgB,GAAG,CAAC,CAAC,MAAM,sBAC1B,8OAAC;wBAAgB,WAAU;kCACzB,cAAA,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,kMAAA,CAAA,OAAI;wDAAC,WAAU;;;;;;;;;;;8DAElB,8OAAC;;sEACC,8OAAC;4DAAG,WAAU;sEAA6B,KAAK,eAAe;;;;;;sEAC/D,8OAAC;4DAAE,WAAU;sEAAyB,KAAK,MAAM;;;;;;;;;;;;;;;;;;sDAIrD,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,0MAAA,CAAA,WAAQ;4DAAC,WAAU;;;;;;sEACpB,8OAAC;;gEAAK;gEAAa,WAAW,KAAK,eAAe;;;;;;;;;;;;;gDAGnD,KAAK,cAAc,kBAClB,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,sNAAA,CAAA,eAAY;4DAAC,WAAU;;;;;;sEACxB,8OAAC;;gEAAK;gEAAY,WAAW,KAAK,cAAc;;;;;;;;;;;;;8DAIpD,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,kMAAA,CAAA,OAAI;4DAAC,WAAU;;;;;;sEAChB,8OAAC;;gEAAK;gEAAK,KAAK,aAAa;;;;;;;;;;;;;8DAG/B,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,wMAAA,CAAA,UAAO;4DAAC,WAAU;;;;;;sEACnB,8OAAC;;gEAAK;gEAAY,KAAK,SAAS;;;;;;;;;;;;;8DAGlC,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,oMAAA,CAAA,QAAK;4DAAC,WAAU;;;;;;sEACjB,8OAAC;;gEAAK;gEAAW,KAAK,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;8CAKpC,8OAAC;oCAAI,WAAU;;wCACZ,cAAc;sDACf,8OAAC;4CAAK,WAAW,CAAC,kDAAkD,EAAE,eAAe,OAAO;sDACzF,cAAc;;;;;;;;;;;;;;;;;;uBA9Cb;;;;;;;;;;;;;;;;AAwDtB","debugId":null}},
    {"offset": {"line": 2891, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/PrescriptionForm.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useEffect } from 'react';\nimport { \n  X, \n  Plus, \n  Trash2, \n  Search, \n  Pill, \n  Calendar, \n  Clock, \n  User, \n  FileText, \n  AlertCircle,\n  CheckCircle,\n  Stethoscope\n} from 'lucide-react';\nimport { supabase } from '../lib/supabase';\n\ninterface Medication {\n  id: string;\n  medication_code: string;\n  name: string;\n  generic_name: string;\n  manufacturer: string;\n  category: string;\n  dosage_form: string;\n  strength: string;\n  unit_price: number;\n  stock_quantity: number;\n}\n\ninterface PrescriptionItem {\n  medication_id: string;\n  medication_name: string;\n  dosage: string;\n  frequency: string;\n  frequency_times: string[]; // Morning, Afternoon, Evening, Night\n  meal_timing: string; // before_meal, after_meal, with_meal, empty_stomach\n  duration: string;\n  duration_days: number;\n  instructions: string;\n  quantity: number;\n  auto_calculate_quantity: boolean;\n  unit_price: number;\n  total_price: number;\n  stock_quantity: number;\n}\n\ninterface PrescriptionFormProps {\n  patientId: string;\n  patientName: string;\n  onClose: () => void;\n  onPrescriptionCreated: () => void;\n  currentUser: any;\n}\n\nexport default function PrescriptionForm({ \n  patientId, \n  patientName, \n  onClose, \n  onPrescriptionCreated, \n  currentUser \n}: PrescriptionFormProps) {\n  const [medications, setMedications] = useState<Medication[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [prescriptionItems, setPrescriptionItems] = useState<PrescriptionItem[]>([]);\n  const [diagnosis, setDiagnosis] = useState('');\n  const [notes, setNotes] = useState('');\n  const [followUpDate, setFollowUpDate] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [searchResults, setSearchResults] = useState<Medication[]>([]);\n  const [showMedicationSearch, setShowMedicationSearch] = useState(false);\n\n  useEffect(() => {\n    fetchMedications();\n  }, []);\n\n  const fetchMedications = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('medications')\n        .select('id, medication_code, name, generic_name, manufacturer, category, dosage_form, strength, unit_price, stock_quantity')\n        .gt('stock_quantity', 0)\n        .order('name', { ascending: true });\n      \n      if (error) throw error;\n      setMedications(data || []);\n    } catch (error) {\n      console.error('Error fetching medications:', error);\n    }\n  };\n\n  const searchMedications = (term: string) => {\n    if (!term.trim()) {\n      setSearchResults([]);\n      return;\n    }\n    \n    const filtered = medications.filter(med => \n      med.name.toLowerCase().includes(term.toLowerCase()) ||\n      med.generic_name.toLowerCase().includes(term.toLowerCase()) ||\n      med.category.toLowerCase().includes(term.toLowerCase())\n    );\n    setSearchResults(filtered);\n  };\n\n  const addMedicationToPrescription = (medication: Medication) => {\n    const newItem: PrescriptionItem = {\n      medication_id: medication.id,\n      medication_name: medication.name,\n      dosage: '',\n      frequency: '',\n      frequency_times: [],\n      meal_timing: '',\n      duration: '',\n      duration_days: 1,\n      instructions: '',\n      quantity: 1,\n      auto_calculate_quantity: true,\n      unit_price: medication.unit_price,\n      total_price: medication.unit_price,\n      stock_quantity: medication.stock_quantity\n    };\n    \n    setPrescriptionItems([...prescriptionItems, newItem]);\n    setSearchTerm('');\n    setSearchResults([]);\n    setShowMedicationSearch(false);\n  };\n\n  const calculateAutoQuantity = (frequencyTimes: string[], durationDays: number) => {\n    const timesPerDay = frequencyTimes.length;\n    return timesPerDay * durationDays;\n  };\n\n  const updatePrescriptionItem = (index: number, field: keyof PrescriptionItem, value: string | number | string[] | boolean) => {\n    const updatedItems = [...prescriptionItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n    \n    // Auto-calculate quantity if enabled\n    if (updatedItems[index].auto_calculate_quantity && \n        (field === 'frequency_times' || field === 'duration_days')) {\n      const autoQuantity = calculateAutoQuantity(\n        updatedItems[index].frequency_times, \n        updatedItems[index].duration_days\n      );\n      updatedItems[index].quantity = autoQuantity;\n      updatedItems[index].total_price = updatedItems[index].unit_price * autoQuantity;\n    } else if (field === 'quantity') {\n      updatedItems[index].total_price = updatedItems[index].unit_price * (value as number);\n    }\n    \n    setPrescriptionItems(updatedItems);\n  };\n\n  const removePrescriptionItem = (index: number) => {\n    setPrescriptionItems(prescriptionItems.filter((_, i) => i !== index));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (prescriptionItems.length === 0) {\n      alert('Please add at least one medication to the prescription.');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Create prescription record\n      const { data: prescriptionData, error: prescriptionError } = await supabase\n        .from('prescriptions')\n        .insert({\n          patient_id: patientId,\n          doctor_id: currentUser?.id || null,\n          issue_date: new Date().toISOString().split('T')[0],\n          instructions: `Diagnosis: ${diagnosis}\\nNotes: ${notes}\\nFollow-up: ${followUpDate || 'Not specified'}`,\n          status: 'active'\n        })\n        .select()\n        .single();\n\n      if (prescriptionError) throw prescriptionError;\n\n      const prescriptionId = prescriptionData.id;\n\n      // Create prescription items\n      for (const item of prescriptionItems) {\n        const { error: itemError } = await supabase\n          .from('prescription_items')\n          .insert({\n            prescription_id: prescriptionId,\n            medication_id: item.medication_id,\n            dosage: item.dosage,\n            frequency: item.frequency,\n            duration: item.duration,\n            instructions: item.instructions,\n            quantity: item.quantity,\n            unit_price: item.unit_price,\n            total_price: item.total_price\n          });\n\n        if (itemError) throw itemError;\n      }\n\n      onPrescriptionCreated();\n      onClose();\n    } catch (error) {\n      console.error('Error creating prescription:', error);\n      alert('Error creating prescription. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[95vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-100 p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-green-100 rounded-lg\">\n                <Pill className=\"h-6 w-6 text-green-600\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">New Prescription</h2>\n                <p className=\"text-sm text-gray-600\">For {patientName}</p>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Form Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Diagnosis and Notes */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  <Stethoscope className=\"h-4 w-4 inline mr-2\" />\n                  Diagnosis *\n                </label>\n                <textarea\n                  value={diagnosis}\n                  onChange={(e) => setDiagnosis(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Enter patient diagnosis...\"\n                  required\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  <FileText className=\"h-4 w-4 inline mr-2\" />\n                  Additional Notes\n                </label>\n                <textarea\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Additional instructions or notes...\"\n                />\n              </div>\n            </div>\n\n            {/* Follow-up Date */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                <Calendar className=\"h-4 w-4 inline mr-2\" />\n                Follow-up Date\n              </label>\n              <input\n                type=\"date\"\n                value={followUpDate}\n                onChange={(e) => setFollowUpDate(e.target.value)}\n                className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                min={new Date().toISOString().split('T')[0]}\n              />\n            </div>\n\n            {/* Medication Search */}\n            <div className=\"border-t pt-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-medium text-gray-900\">Medications</h3>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowMedicationSearch(!showMedicationSearch)}\n                  className=\"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Add Medication\n                </button>\n              </div>\n\n              {showMedicationSearch && (\n                <div className=\"mb-6 p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n                    <input\n                      type=\"text\"\n                      value={searchTerm}\n                      onChange={(e) => {\n                        setSearchTerm(e.target.value);\n                        searchMedications(e.target.value);\n                      }}\n                      className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                      placeholder=\"Search medications by name, generic name, or category...\"\n                    />\n                  </div>\n\n                  {searchResults.length > 0 && (\n                    <div className=\"mt-3 max-h-60 overflow-y-auto border border-gray-200 rounded-lg\">\n                      {searchResults.map((medication) => (\n                        <div\n                          key={medication.id}\n                          onClick={() => addMedicationToPrescription(medication)}\n                          className=\"p-3 hover:bg-green-50 cursor-pointer border-b border-gray-100 last:border-b-0\"\n                        >\n                          <div className=\"flex justify-between items-start\">\n                            <div>\n                              <h4 className=\"font-medium text-gray-900\">{medication.name}</h4>\n                              <p className=\"text-sm text-gray-600\">{medication.generic_name}</p>\n                              <p className=\"text-xs text-gray-500\">{medication.category}  {medication.dosage_form}  {medication.strength}</p>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"text-sm font-medium text-green-600\">{medication.unit_price}</p>\n                              <p className=\"text-xs text-gray-500\">{medication.stock_quantity} units available</p>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Prescription Items */}\n              {prescriptionItems.length > 0 && (\n                <div className=\"space-y-4\">\n                  {prescriptionItems.map((item, index) => (\n                    <div key={index} className=\"border border-gray-200 rounded-lg p-4 bg-white\">\n                      <div className=\"flex justify-between items-start mb-4\">\n                        <div>\n                          <h4 className=\"font-medium text-gray-900\">{item.medication_name}</h4>\n                          <p className=\"text-sm text-gray-600\">Stock: {item.stock_quantity} units available</p>\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={() => removePrescriptionItem(index)}\n                          className=\"p-1 text-red-500 hover:bg-red-50 rounded\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {/* Dosage */}\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Dosage</label>\n                          <input\n                            type=\"text\"\n                            value={item.dosage}\n                            onChange={(e) => updatePrescriptionItem(index, 'dosage', e.target.value)}\n                            className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                            placeholder=\"e.g., 500mg, 1 tablet\"\n                          />\n                        </div>\n\n                        {/* Frequency */}\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Frequency</label>\n                          <select\n                            value={item.frequency}\n                            onChange={(e) => updatePrescriptionItem(index, 'frequency', e.target.value)}\n                            className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                          >\n                            <option value=\"\">Select frequency</option>\n                            <option value=\"once_daily\">Once Daily</option>\n                            <option value=\"twice_daily\">Twice Daily</option>\n                            <option value=\"three_times_daily\">Three Times Daily</option>\n                            <option value=\"four_times_daily\">Four Times Daily</option>\n                            <option value=\"as_needed\">As Needed</option>\n                          </select>\n                        </div>\n\n                        {/* Duration */}\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Duration</label>\n                          <input\n                            type=\"text\"\n                            value={item.duration}\n                            onChange={(e) => updatePrescriptionItem(index, 'duration', e.target.value)}\n                            className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                            placeholder=\"e.g., 7 days, 2 weeks\"\n                          />\n                        </div>\n                      </div>\n\n                      {/* Frequency Times */}\n                      <div className=\"mt-4\">\n                        <label className=\"block text-xs font-medium text-gray-700 mb-2\">Frequency Times</label>\n                        <div className=\"flex flex-wrap gap-2\">\n                          {['Morning', 'Afternoon', 'Evening', 'Night'].map((time) => (\n                            <label key={time} className=\"flex items-center\">\n                              <input\n                                type=\"checkbox\"\n                                checked={item.frequency_times.includes(time)}\n                                onChange={(e) => {\n                                  const updatedTimes = e.target.checked\n                                    ? [...item.frequency_times, time]\n                                    : item.frequency_times.filter(t => t !== time);\n                                  updatePrescriptionItem(index, 'frequency_times', updatedTimes);\n                                }}\n                                className=\"mr-2 text-green-500 focus:ring-green-500\"\n                              />\n                              <span className=\"text-sm text-gray-700\">{time}</span>\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n\n                      {/* Meal Timing */}\n                      <div className=\"mt-4\">\n                        <label className=\"block text-xs font-medium text-gray-700 mb-2\">Meal Timing</label>\n                        <select\n                          value={item.meal_timing}\n                          onChange={(e) => updatePrescriptionItem(index, 'meal_timing', e.target.value)}\n                          className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                        >\n                          <option value=\"\">Select meal timing</option>\n                          <option value=\"before_meal\">Before Meal</option>\n                          <option value=\"after_meal\">After Meal</option>\n                          <option value=\"with_meal\">With Meal</option>\n                          <option value=\"empty_stomach\">Empty Stomach</option>\n                        </select>\n                      </div>\n\n                      {/* Instructions */}\n                      <div className=\"mt-4\">\n                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Instructions</label>\n                        <textarea\n                          value={item.instructions}\n                          onChange={(e) => updatePrescriptionItem(index, 'instructions', e.target.value)}\n                          className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                          placeholder=\"e.g., Take after meals, Avoid alcohol, Complete the full course\"\n                          rows={2}\n                        />\n                        {item.meal_timing && (\n                          <p className=\"mt-1 text-xs text-blue-600\">\n                            Meal timing: {item.meal_timing.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n                          </p>\n                        )}\n                        {item.frequency_times.length > 0 && (\n                          <p className=\"mt-1 text-xs text-green-600\">\n                            Times: {item.frequency_times.join(', ')} ({item.frequency_times.length} times daily)\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                  \n                  {/* Total Medications */}\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-lg font-semibold text-gray-900\">Total Medications:</span>\n                      <span className=\"text-2xl font-bold text-blue-600\">{prescriptionItems.length} items</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {prescriptionItems.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <Pill className=\"h-12 w-12 mx-auto mb-4 text-gray-300\" />\n                  <p>No medications added yet. Click \"Add Medication\" to start prescribing.</p>\n                </div>\n              )}\n            </div>\n          </form>\n        </div>\n\n        {/* Footer */}\n        <div className=\"border-t border-gray-200 p-6\">\n          <div className=\"flex justify-end gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={handleSubmit}\n              disabled={loading || prescriptionItems.length === 0}\n              className=\"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  Creating...\n                </>\n              ) : (\n                <>\n                  <CheckCircle className=\"h-4 w-4\" />\n                  Create Prescription\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3959, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/app/patients/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useEffect } from 'react';\nimport { \n  ArrowLeft, \n  Calendar, \n  File, \n  Pill, \n  Activity, \n  MessageSquare,\n  Edit,\n  Phone,\n  Mail,\n  MapPin,\n  Clock,\n  Plus,\n  AlertCircle,\n  FileText,\n  ChevronRight,\n  Heart,\n  Building,\n  User,\n  Users,\n  Shield,\n  Stethoscope,\n  ClipboardList,\n  Hash,\n  UserCheck,\n  Eye,\n  CheckCircle,\n  AlertTriangle,\n  X,\n  Bed,\n  LogIn,\n  LogOut\n} from 'lucide-react';\nimport { getPatientWithRelatedData } from '../../../src/lib/patientService';\nimport { getPatientVitals, recordVitals, updateVitalRecord } from '../../../src/lib/vitalsService';\nimport { getMedicalHistory, MedicalHistoryEvent } from '../../../src/lib/medicalHistoryService';\nimport MedicalHistoryForm from '../../../src/components/MedicalHistoryForm';\nimport AddDummyMedicalHistory from '../../../src/components/AddDummyMedicalHistory';\nimport MedicationHistory from '../../../src/components/MedicationHistory';\nimport { getCurrentUser, getCurrentUserProfile } from '../../../src/lib/supabase';\nimport PrescriptionForm from '../../../src/components/PrescriptionForm';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n\ninterface Patient {\n  id: string;\n  patient_id: string;\n  name: string;\n  date_of_birth: string;\n  gender: string;\n  phone: string;\n  email: string;\n  address: string;\n  blood_group: string;\n  allergies: string;\n  medical_history: string;\n  admission_date: string;\n  admission_time: string;\n  primary_complaint: string;\n  admission_type: string;\n  referring_doctor_facility: string;\n  department_ward: string;\n  room_number: string;\n  guardian_name: string;\n  guardian_relationship: string;\n  guardian_phone: string;\n  guardian_address: string;\n  emergency_contact_name: string;\n  emergency_contact_phone: string;\n  emergency_contact_relationship: string;\n  insurance_provider: string;\n  insurance_number: string;\n  initial_symptoms: string;\n  referred_by: string;\n  status: string;\n  created_at: string;\n  appointments: any[];\n  bed_allocations: any[];\n}\n\nexport default function PatientDetailsPage({ params }: { params: Promise<{ id: string }> }) {\n  // Unwrap the params Promise using React.use()\n  const unwrappedParams = React.use(params);\n  const router = useRouter();\n  const [patient, setPatient] = useState<Patient | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState('overview');\n  const [activeSubTab, setActiveSubTab] = useState('appointments');\n  const [vitals, setVitals] = useState<any[]>([]);\n  const [showVitalsForm, setShowVitalsForm] = useState(false);\n  const [editingVital, setEditingVital] = useState<any | null>(null);\n  const [currentUser, setCurrentUser] = useState<any | null>(null);\n  const [vitalsLoading, setVitalsLoading] = useState(false);\n  const [medicalHistory, setMedicalHistory] = useState<MedicalHistoryEvent[]>([]);\n  const [historyLoading, setHistoryLoading] = useState(false);\n  const [showMedicalHistoryForm, setShowMedicalHistoryForm] = useState(false);\n  const [showPrescriptionForm, setShowPrescriptionForm] = useState(false);\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      console.log('Fetching user profile...');\n      const userProfile = await getCurrentUserProfile();\n      console.log('User profile fetched:', userProfile);\n      setCurrentUser(userProfile);\n      \n      // If no user profile, try to get auth user for debugging\n      if (!userProfile) {\n        const authUser = await getCurrentUser();\n        console.log('Auth user (for debugging):', authUser);\n      }\n    };\n    fetchUser();\n  }, []);\n\n  useEffect(() => {\n    fetchPatientData();\n  }, [unwrappedParams.id]);\n\n  const fetchPatientData = async () => {\n    try {\n      setLoading(true);\n      const patientData = await getPatientWithRelatedData(unwrappedParams.id);\n      setPatient(patientData);\n      \n      // Fetch vitals data\n      setVitalsLoading(true);\n      try {\n        const vitalsData = await getPatientVitals(unwrappedParams.id);\n        setVitals(vitalsData);\n      } catch (vitalsError) {\n        console.error('Error fetching vitals data:', vitalsError);\n      } finally {\n        setVitalsLoading(false);\n      }\n\n      // Fetch medical history data\n      setHistoryLoading(true);\n      try {\n        const historyData = await getMedicalHistory(unwrappedParams.id);\n        setMedicalHistory(historyData);\n      } catch (historyError) {\n        console.error('Error fetching medical history data:', historyError);\n      } finally {\n        setHistoryLoading(false);\n      }\n    } catch (err) {\n      console.error('Error fetching patient data:', err);\n      setError(err instanceof Error ? err.message : 'Failed to load patient data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateAge = (dateOfBirth: string) => {\n    const birth = new Date(dateOfBirth);\n    const today = new Date();\n    let age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      age--;\n    }\n    \n    return age;\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status?.toLowerCase()) {\n      case 'critical':\n        return 'text-red-500 bg-red-50 border-red-200';\n      case 'stable':\n        return 'text-green-500 bg-green-50 border-green-200';\n      case 'recovering':\n        return 'text-orange-500 bg-orange-50 border-orange-200';\n      case 'active':\n        return 'text-blue-500 bg-blue-50 border-blue-200';\n      default:\n        return 'text-gray-500 bg-gray-50 border-gray-200';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return 'Not specified';\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const formatDateTime = (dateString: string) => {\n    if (!dateString) return 'Not specified';\n    return new Date(dateString).toLocaleString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading patient data...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <AlertCircle className=\"w-16 h-16 text-red-500 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Error Loading Patient</h2>\n          <p className=\"text-gray-600 mb-4\">{error}</p>\n          <Link href=\"/patients\">\n            <button className=\"bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors\">\n              Back to Patients\n            </button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  if (!patient) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <User className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Patient Not Found</h2>\n          <p className=\"text-gray-600 mb-4\">The requested patient could not be found.</p>\n          <Link href=\"/patients\">\n            <button className=\"bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors\">\n              Back to Patients\n            </button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/patients\">\n                <button className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\">\n                  <ArrowLeft className=\"h-5 w-5 text-gray-600\" />\n                </button>\n              </Link>\n              <div>\n                <h1 className=\"text-2xl font-bold text-gray-900\">{patient.name}</h1>\n                <div className=\"flex items-center gap-4 mt-1\">\n                  <span className=\"text-lg font-mono text-orange-600\">{patient.patient_id}</span>\n                  <span className={`px-3 py-1 rounded-full text-xs font-medium border ${getStatusColor(patient.status)}`}>\n                    {patient.status?.charAt(0).toUpperCase() + patient.status?.slice(1) || 'Active'}\n                  </span>\n                </div>\n              </div>\n            </div>\n            <div className=\"flex gap-3\">\n              <button \n                onClick={() => router.push(`/patients/${patient.patient_id}/edit`)}\n                className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors flex items-center gap-2\"\n              >\n                <Edit className=\"h-4 w-4\" />\n                Edit Patient\n              </button>\n              <button \n                onClick={() => setShowPrescriptionForm(true)}\n                className=\"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2\"\n              >\n                <Pill className=\"h-4 w-4\" />\n                Prescribe Medicine\n              </button>\n              <button className=\"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2\">\n                <Plus className=\"h-4 w-4\" />\n                New Appointment\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-6\">\n        {/* Patient Overview Cards */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n          {/* Personal Information Card */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"p-2 bg-blue-100 rounded-lg\">\n                <User className=\"h-5 w-5 text-blue-600\" />\n              </div>\n              <h3 className=\"font-semibold text-gray-900\">Personal Information</h3>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex items-center text-sm\">\n                <Calendar className=\"h-4 w-4 text-gray-400 mr-3\" />\n                <span className=\"text-gray-600\">Age:</span>\n                <span className=\"ml-2 font-medium\">{calculateAge(patient.date_of_birth)} years</span>\n              </div>\n              \n              <div className=\"flex items-center text-sm\">\n                <User className=\"h-4 w-4 text-gray-400 mr-3\" />\n                <span className=\"text-gray-600\">Gender:</span>\n                <span className=\"ml-2 font-medium capitalize\">{patient.gender}</span>\n              </div>\n              \n              <div className=\"flex items-center text-sm\">\n                <Phone className=\"h-4 w-4 text-gray-400 mr-3\" />\n                <span className=\"text-gray-600\">Phone:</span>\n                <span className=\"ml-2 font-medium\">{patient.phone}</span>\n              </div>\n              \n              <div className=\"flex items-center text-sm\">\n                <Mail className=\"h-4 w-4 text-gray-400 mr-3\" />\n                <span className=\"text-gray-600\">Email:</span>\n                <span className=\"ml-2 font-medium\">{patient.email}</span>\n              </div>\n              \n              <div className=\"flex items-start text-sm\">\n                <MapPin className=\"h-4 w-4 text-gray-400 mr-3 mt-0.5\" />\n                <div>\n                  <span className=\"text-gray-600\">Address:</span>\n                  <p className=\"ml-2 font-medium\">{patient.address}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Medical Information Card */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"p-2 bg-green-100 rounded-lg\">\n                <Heart className=\"h-5 w-5 text-green-600\" />\n              </div>\n              <h3 className=\"font-semibold text-gray-900\">Medical Information</h3>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex items-center text-sm\">\n                <Heart className=\"h-4 w-4 text-gray-400 mr-3\" />\n                <span className=\"text-gray-600\">Blood Group:</span>\n                <span className=\"ml-2 font-medium\">{patient.blood_group || 'Not specified'}</span>\n              </div>\n              \n              {patient.allergies && (\n                <div className=\"bg-red-50 p-3 rounded-lg border border-red-200\">\n                  <div className=\"flex items-center text-red-700 text-sm font-medium mb-1\">\n                    <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                    Allergies\n                  </div>\n                  <p className=\"text-red-600 text-sm\">{patient.allergies}</p>\n                </div>\n              )}\n              \n              {patient.initial_symptoms && (\n                <div className=\"bg-yellow-50 p-3 rounded-lg border border-yellow-200\">\n                  <div className=\"flex items-center text-yellow-700 text-sm font-medium mb-1\">\n                    <Stethoscope className=\"h-4 w-4 mr-2\" />\n                    Initial Symptoms\n                  </div>\n                  <p className=\"text-yellow-600 text-sm\">{patient.initial_symptoms}</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Admission Information Card */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"p-2 bg-purple-100 rounded-lg\">\n                <Building className=\"h-5 w-5 text-purple-600\" />\n              </div>\n              <h3 className=\"font-semibold text-gray-900\">Admission Information</h3>\n            </div>\n            \n            <div className=\"space-y-3\">\n              {patient.admission_date && (\n                <div className=\"flex items-center text-sm\">\n                  <Clock className=\"h-4 w-4 text-gray-400 mr-3\" />\n                  <span className=\"text-gray-600\">Admitted:</span>\n                  <span className=\"ml-2 font-medium\">{formatDateTime(patient.admission_date)}</span>\n                </div>\n              )}\n              \n              {patient.admission_type && (\n                <div className=\"flex items-center text-sm\">\n                  <FileText className=\"h-4 w-4 text-gray-400 mr-3\" />\n                  <span className=\"text-gray-600\">Type:</span>\n                  <span className=\"ml-2 font-medium capitalize\">{patient.admission_type}</span>\n                </div>\n              )}\n              \n              {patient.department_ward && (\n                <div className=\"flex items-center text-sm\">\n                  <Building className=\"h-4 w-4 text-gray-400 mr-3\" />\n                  <span className=\"text-gray-600\">Department:</span>\n                  <span className=\"ml-2 font-medium\">{patient.department_ward}</span>\n                </div>\n              )}\n              \n              {patient.room_number && (\n                <div className=\"flex items-center text-sm\">\n                  <MapPin className=\"h-4 w-4 text-gray-400 mr-3\" />\n                  <span className=\"text-gray-600\">Room:</span>\n                  <span className=\"ml-2 font-medium\">{patient.room_number}</span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Tabs Navigation */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 mb-6\">\n          <div className=\"border-b border-gray-200\">\n            <nav className=\"flex space-x-8 px-6\">\n              {[\n                { id: 'overview', name: 'Overview', icon: Eye },\n                { id: 'vitals', name: 'Vitals', icon: Activity },\n                { id: 'medical-history', name: 'Medical History', icon: Heart },\n                { id: 'medications', name: 'Medications', icon: Pill },\n                { id: 'appointments', name: 'Appointments & Admissions', icon: Calendar },\n                { id: 'billing', name: 'Billing', icon: FileText }\n              ].map((tab) => (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${\n                    activeTab === tab.id\n                      ? 'border-orange-500 text-orange-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  <tab.icon className=\"h-4 w-4\" />\n                  {tab.name}\n                </button>\n              ))}\n            </nav>\n          </div>\n\n          <div className=\"p-6\">\n            {/* Overview Tab */}\n            {activeTab === 'overview' && (\n              <div className=\"space-y-6\">\n                {patient.primary_complaint && (\n                  <div className=\"bg-orange-50 p-4 rounded-lg border border-orange-200\">\n                    <h4 className=\"font-medium text-orange-900 mb-2 flex items-center gap-2\">\n                      <ClipboardList className=\"h-4 w-4\" />\n                  Primary Complaint / Reason for Visit\n                    </h4>\n                    <p className=\"text-orange-800\">{patient.primary_complaint}</p>\n                  </div>\n                )}\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {patient.referring_doctor_facility && (\n                    <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                      <h4 className=\"font-medium text-blue-900 mb-2\">Referring Doctor/Facility</h4>\n                      <p className=\"text-blue-800\">{patient.referring_doctor_facility}</p>\n                    </div>\n                  )}\n\n                  {patient.referred_by && (\n                    <div className=\"bg-green-50 p-4 rounded-lg border border-green-200\">\n                      <h4 className=\"font-medium text-green-900 mb-2\">Referred By</h4>\n                      <p className=\"text-green-800\">{patient.referred_by}</p>\n                    </div>\n                  )}\n                </div>\n\n                {/* Recent Activity */}\n                <div>\n                  <h4 className=\"font-medium text-gray-900 mb-4\">Recent Activity</h4>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full mr-3\"></div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm text-gray-900\">Patient registered</p>\n                        <p className=\"text-xs text-gray-500\">{formatDateTime(patient.created_at)}</p>\n                      </div>\n                    </div>\n                    {patient.admission_date && (\n                      <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full mr-3\"></div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm text-gray-900\">Patient admitted</p>\n                          <p className=\"text-xs text-gray-500\">{formatDateTime(patient.admission_date)}</p>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Vitals Tab */}\n            {activeTab === 'vitals' && (\n              <div className=\"space-y-6\">\n                <div className=\"flex justify-between items-center\">\n                  <h3 className=\"text-lg font-medium text-gray-900\">Patient Vitals</h3>\n                  <button\n                    onClick={() => {\n                      setEditingVital(null);\n                      setShowVitalsForm(true);\n                    }}\n                    className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors flex items-center gap-2\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Record New Vitals\n                  </button>\n                </div>\n\n                {vitalsLoading ? (\n                  <div className=\"flex justify-center items-center py-12\">\n                    <div className=\"w-8 h-8 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin\"></div>\n                  </div>\n                ) : vitals.length === 0 ? (\n                  <div className=\"text-center py-12 bg-gray-50 rounded-lg border border-gray-200\">\n                    <Activity className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <h4 className=\"text-lg font-medium text-gray-900 mb-2\">No vitals recorded</h4>\n                    <p className=\"text-gray-500 mb-4\">Get started by recording new vitals for this patient.</p>\n                    <button\n                      onClick={() => {\n                        setEditingVital(null);\n                        setShowVitalsForm(true);\n                      }}\n                      className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors\"\n                    >\n                      Record First Vitals\n                    </button>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {vitals.map((vital) => (\n                      <div key={vital.id} className=\"bg-white rounded-lg border border-gray-200 p-4 relative\">\n                        {/* Alert indicator */}\n                        {vital.alerts && vital.alerts.length > 0 && (\n                          <div className=\"absolute top-2 right-2\">\n                            <div className=\"flex items-center gap-1 bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              {vital.alerts.length} Alert{vital.alerts.length > 1 ? 's' : ''}\n                            </div>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex justify-between items-start mb-3\">\n                          <div>\n                            <h4 className=\"font-medium text-gray-900\">\n                              Recorded on {new Date(vital.recorded_at).toLocaleString()}\n                            </h4>\n                            <div className=\"flex items-center gap-4 text-sm text-gray-500\">\n                              <span>Recorded by: {vital.recorded_by_user?.name || 'Unknown'}</span>\n                              {vital.recording_location && (\n                                <span>Location: {vital.recording_location}</span>\n                              )}\n                              {vital.recording_device && (\n                                <span>Device: {vital.recording_device}</span>\n                              )}\n                              {vital.version > 1 && (\n                                <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">\n                                  v{vital.version}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            {vital.is_validated && (\n                              <div className=\"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded text-xs\">\n                                <CheckCircle className=\"h-3 w-3\" />\n                                Validated\n                              </div>\n                            )}\n                            <button\n                              onClick={() => {\n                                setEditingVital(vital);\n                                setShowVitalsForm(true);\n                              }}\n                              className=\"text-orange-500 hover:text-orange-700 text-sm font-medium\"\n                            >\n                              Edit\n                            </button>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                          {vital.blood_pressure_systolic && vital.blood_pressure_diastolic && (\n                            <div className=\"bg-red-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-red-600 font-medium\">Blood Pressure</p>\n                              <p className=\"text-lg font-semibold text-red-800\">\n                                {vital.blood_pressure_systolic}/{vital.blood_pressure_diastolic}\n                              </p>\n                              <p className=\"text-xs text-red-600\">mmHg</p>\n                            </div>\n                          )}\n                          \n                          {vital.heart_rate && (\n                            <div className=\"bg-blue-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-blue-600 font-medium\">Heart Rate</p>\n                              <p className=\"text-lg font-semibold text-blue-800\">\n                                {vital.heart_rate} <span className=\"text-sm\">bpm</span>\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.temperature && (\n                            <div className=\"bg-yellow-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-yellow-600 font-medium\">Temperature</p>\n                              <p className=\"text-lg font-semibold text-yellow-800\">\n                                {vital.temperature}F\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.oxygen_saturation && (\n                            <div className=\"bg-green-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-green-600 font-medium\">Oxygen Saturation</p>\n                              <p className=\"text-lg font-semibold text-green-800\">\n                                {vital.oxygen_saturation}%\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.respiratory_rate && (\n                            <div className=\"bg-cyan-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-cyan-600 font-medium\">Respiratory Rate</p>\n                              <p className=\"text-lg font-semibold text-cyan-800\">\n                                {vital.respiratory_rate} <span className=\"text-sm\">bpm</span>\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.weight && (\n                            <div className=\"bg-purple-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-purple-600 font-medium\">Weight</p>\n                              <p className=\"text-lg font-semibold text-purple-800\">\n                                {vital.weight} <span className=\"text-sm\">kg</span>\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.height && (\n                            <div className=\"bg-indigo-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-indigo-600 font-medium\">Height</p>\n                              <p className=\"text-lg font-semibold text-indigo-800\">\n                                {vital.height} <span className=\"text-sm\">cm</span>\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.bmi && (\n                            <div className=\"bg-teal-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-teal-600 font-medium\">BMI</p>\n                              <p className=\"text-lg font-semibold text-teal-800\">{vital.bmi}</p>\n                            </div>\n                          )}\n                          \n                          {vital.blood_glucose && (\n                            <div className=\"bg-pink-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-pink-600 font-medium\">Blood Glucose</p>\n                              <p className=\"text-lg font-semibold text-pink-800\">\n                                {vital.blood_glucose} <span className=\"text-sm\">mg/dL</span>\n                              </p>\n                            </div>\n                          )}\n                          \n                          {vital.pain_scale !== undefined && vital.pain_scale !== null && (\n                            <div className=\"bg-orange-50 p-3 rounded-lg\">\n                              <p className=\"text-xs text-orange-600 font-medium\">Pain Scale</p>\n                              <p className=\"text-lg font-semibold text-orange-800\">\n                                {vital.pain_scale}/10\n                              </p>\n                            </div>\n                          )}\n                          \n                        </div>\n                        \n                        {vital.notes && (\n                          <div className=\"mt-3 pt-3 border-t border-gray-100\">\n                            <p className=\"text-sm text-gray-600\">\n                              <span className=\"font-medium\">Notes:</span> {vital.notes}\n                            </p>\n                          </div>\n                        )}\n                        \n                        {/* Metadata footer */}\n                        <div className=\"mt-3 pt-3 border-t border-gray-100 flex justify-between items-center text-xs text-gray-500\">\n                          <div className=\"flex items-center gap-4\">\n                            {vital.updated_at !== vital.created_at && (\n                              <span>Last updated: {new Date(vital.updated_at).toLocaleString()}</span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Medical History Tab */}\n            {activeTab === 'medical-history' && (\n              <div className=\"space-y-6\">\n                <div className=\"flex justify-between items-center\">\n                  <h3 className=\"text-lg font-medium text-gray-900\">Medical History Timeline</h3>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => setShowMedicalHistoryForm(true)}\n                      className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors flex items-center gap-2\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                      Add Medical Event\n                    </button>\n                    {patient?.id && (\n                      <AddDummyMedicalHistory \n                        patientId={patient.id} \n                        onSuccess={async () => {\n                          setHistoryLoading(true);\n                          try {\n                            const historyData = await getMedicalHistory(patient.id);\n                            setMedicalHistory(historyData);\n                          } catch (error) {\n                            console.error('Error fetching medical history:', error);\n                          } finally {\n                            setHistoryLoading(false);\n                          }\n                        }} \n                      />\n                    )}\n                  </div>\n                </div>\n                \n                {historyLoading ? (\n                  <div className=\"flex justify-center items-center py-12\">\n                    <div className=\"w-8 h-8 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin\"></div>\n                  </div>\n                ) : medicalHistory.length === 0 ? (\n                  <div className=\"text-center py-12 bg-gray-50 rounded-lg border border-gray-200\">\n                    <Heart className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <h4 className=\"text-lg font-medium text-gray-900 mb-2\">No medical history found</h4>\n                    <p className=\"text-gray-500 mb-4\">No medical events have been recorded for this patient.</p>\n                    <button\n                      onClick={() => setShowMedicalHistoryForm(true)}\n                      className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors\"\n                    >\n                      Record First Medical Event\n                    </button>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    {medicalHistory.map((event) => (\n                      <div key={event.id} className=\"flex gap-4\">\n                        <div className=\"flex flex-col items-center\">\n                          <div className=\"w-4 h-4 bg-orange-500 rounded-full\"></div>\n                          <div className=\"w-px h-full bg-gray-300\"></div>\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"font-semibold text-gray-700\">{event.event_name}</p>\n                          <p className=\"text-sm text-gray-500\">{new Date(event.event_date).toLocaleDateString()} - {event.event_type}</p>\n                          <p className=\"text-sm text-gray-600 mt-1\">{event.details}</p>\n                          {event.doctor_name && <p className=\"text-sm text-blue-600 mt-1\">Doctor: {event.doctor_name}</p>}\n                          {event.facility_name && <p className=\"text-sm text-purple-600 mt-1\">Facility: {event.facility_name}</p>}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                \n                {/* Medical History Form Modal */}\n                {showMedicalHistoryForm && patient?.id && (\n                  <MedicalHistoryForm\n                    patientId={patient.id}\n                    onClose={() => setShowMedicalHistoryForm(false)}\n                    onSuccess={async () => {\n                      setHistoryLoading(true);\n                      try {\n                        const historyData = await getMedicalHistory(patient.id);\n                        setMedicalHistory(historyData);\n                      } catch (error) {\n                        console.error('Error fetching medical history:', error);\n                      } finally {\n                        setHistoryLoading(false);\n                      }\n                    }}\n                  />\n                )}\n              </div>\n            )}\n\n            {/* Medications Tab */}\n            {activeTab === 'medications' && (\n              <MedicationHistory patientId={patient.id} />\n            )}\n\n            {/* Appointments & Admissions Tab */}\n            {activeTab === 'appointments' && (\n              <div className=\"space-y-6\">\n                {/* Sub-tabs for Appointments and Admissions */}\n                <div className=\"border-b border-gray-200\">\n                  <nav className=\"flex space-x-8\">\n                    <button\n                      onClick={() => setActiveSubTab('appointments')}\n                      className={`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${\n                        activeSubTab === 'appointments'\n                          ? 'border-orange-500 text-orange-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                    >\n                      <Calendar className=\"h-4 w-4\" />\n                      Appointments\n                    </button>\n                    <button\n                      onClick={() => setActiveSubTab('admissions')}\n                      className={`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${\n                        activeSubTab === 'admissions'\n                          ? 'border-orange-500 text-orange-600'\n                          : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                      }`}\n                    >\n                      <Bed className=\"h-4 w-4\" />\n                      Admission History\n                    </button>\n                  </nav>\n                </div>\n\n                {/* Appointments Sub-tab */}\n                {activeSubTab === 'appointments' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex justify-between items-center\">\n                      <h4 className=\"font-medium text-gray-900\">Appointment History</h4>\n                      <button className=\"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors flex items-center gap-2\">\n                        <Plus className=\"h-4 w-4\" />\n                        New Appointment\n                      </button>\n                    </div>\n\n                    {patient.appointments && patient.appointments.length > 0 ? (\n                      <div className=\"space-y-3\">\n                        {patient.appointments.map((appointment, index) => (\n                          <div key={index} className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\n                            <div className=\"flex justify-between items-start\">\n                              <div>\n                                <p className=\"font-medium text-gray-900\">{appointment.type}</p>\n                                <p className=\"text-sm text-gray-600\">\n                                  {formatDate(appointment.appointment_date)} at {appointment.appointment_time}\n                                </p>\n                                {appointment.doctor && (\n                                  <p className=\"text-sm text-gray-600\">\n                                    Dr. {appointment.doctor.user?.name || 'Unknown'} - {appointment.doctor.user?.specialization || 'General'}\n                                  </p>\n                                )}\n                                {appointment.symptoms && (\n                                  <p className=\"text-sm text-gray-500 mt-1\">Symptoms: {appointment.symptoms}</p>\n                                )}\n                              </div>\n                              <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                                appointment.status === 'completed' ? 'bg-green-100 text-green-800' :\n                                appointment.status === 'scheduled' ? 'bg-blue-100 text-blue-800' :\n                                'bg-gray-100 text-gray-800'\n                              }`}>\n                                {appointment.status}\n                              </span>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Calendar className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                        <p className=\"text-gray-500\">No appointments found</p>\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {/* Admissions Sub-tab */}\n                {activeSubTab === 'admissions' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex justify-between items-center\">\n                      <h4 className=\"font-medium text-gray-900\">Admission & Discharge History</h4>\n                    </div>\n\n                    {patient.bed_allocations && patient.bed_allocations.length > 0 ? (\n                      <div className=\"space-y-3\">\n                        {patient.bed_allocations.map((allocation, index) => (\n                          <div key={index} className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm\">\n                            <div className=\"flex justify-between items-start mb-3\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className={`p-2 rounded-lg ${\n                                  allocation.status === 'active' ? 'bg-green-100' : \n                                  allocation.status === 'discharged' ? 'bg-blue-100' : 'bg-gray-100'\n                                }`}>\n                                  {allocation.status === 'active' ? (\n                                    <LogIn className={`h-4 w-4 ${\n                                      allocation.status === 'active' ? 'text-green-600' : \n                                      allocation.status === 'discharged' ? 'text-blue-600' : 'text-gray-600'\n                                    }`} />\n                                  ) : (\n                                    <LogOut className={`h-4 w-4 ${\n                                      allocation.status === 'active' ? 'text-green-600' : \n                                      allocation.status === 'discharged' ? 'text-blue-600' : 'text-gray-600'\n                                    }`} />\n                                  )}\n                                </div>\n                                <div>\n                                  <h5 className=\"font-medium text-gray-900\">\n                                    {allocation.status === 'active' ? 'Current Admission' : 'Previous Admission'}\n                                  </h5>\n                                  <p className=\"text-sm text-gray-600\">\n                                    Bed: {allocation.bed?.bed_number || 'N/A'}  Room: {allocation.bed?.room_number || 'N/A'}\n                                  </p>\n                                </div>\n                              </div>\n                              <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                                allocation.status === 'active' ? 'bg-green-100 text-green-800' :\n                                allocation.status === 'discharged' ? 'bg-blue-100 text-blue-800' :\n                                'bg-gray-100 text-gray-800'\n                              }`}>\n                                {allocation.status}\n                              </span>\n                            </div>\n\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                              <div>\n                                <span className=\"text-gray-600\">Admission Date:</span>\n                                <p className=\"font-medium\">{formatDateTime(allocation.admission_date)}</p>\n                              </div>\n                              {allocation.discharge_date && (\n                                <div>\n                                  <span className=\"text-gray-600\">Discharge Date:</span>\n                                  <p className=\"font-medium\">{formatDateTime(allocation.discharge_date)}</p>\n                                </div>\n                              )}\n                              <div>\n                                <span className=\"text-gray-600\">Admission Type:</span>\n                                <p className=\"font-medium\">{allocation.admission_type || 'N/A'}</p>\n                              </div>\n                              {allocation.reason && (\n                                <div>\n                                  <span className=\"text-gray-600\">Reason:</span>\n                                  <p className=\"font-medium\">{allocation.reason}</p>\n                                </div>\n                              )}\n                              {allocation.daily_charges && (\n                                <div>\n                                  <span className=\"text-gray-600\">Daily Charges:</span>\n                                  <p className=\"font-medium\">{allocation.daily_charges}</p>\n                                </div>\n                              )}\n                              {allocation.total_charges && (\n                                <div>\n                                  <span className=\"text-gray-600\">Total Charges:</span>\n                                  <p className=\"font-medium\">{allocation.total_charges}</p>\n                                </div>\n                              )}\n                            </div>\n\n                            {allocation.status === 'active' && (\n                              <div className=\"mt-3 pt-3 border-t border-gray-200\">\n                                <div className=\"flex items-center gap-2 text-sm text-green-600\">\n                                  <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n                                  Currently admitted\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Bed className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                        <p className=\"text-gray-500\">No admission history found</p>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Billing Tab */}\n            {activeTab === 'billing' && (\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-900\">Billing Information</h4>\n                <div className=\"text-center py-8\">\n                  <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                  <p className=\"text-gray-500\">Billing information will be available soon</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n      {showVitalsForm && patient && (\n        <VitalsForm\n          patientId={patient.patient_id}\n          onClose={() => {\n            setShowVitalsForm(false);\n            setEditingVital(null);\n          }}\n          onVitalsRecorded={() => {\n            // Refresh vitals data\n            fetchPatientData();\n          }}\n          editingVital={editingVital}\n          currentUser={currentUser}\n        />\n      )}\n      \n      {showPrescriptionForm && patient && (\n        <PrescriptionForm\n          patientId={patient.patient_id}\n          patientName={patient.name}\n          currentUser={currentUser}\n          onClose={() => setShowPrescriptionForm(false)}\n          onPrescriptionCreated={() => {\n            // Refresh patient data to show new prescription\n            fetchPatientData();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\n// Vitals Form Component\nfunction VitalsForm({ \n  patientId, \n  onClose, \n  onVitalsRecorded, \n  editingVital, \n  currentUser \n}: { \n  patientId: string; \n  onClose: () => void; \n  onVitalsRecorded: () => void; \n  editingVital: any | null;\n  currentUser: any | null;\n}) {\n  const [formData, setFormData] = useState({\n    bloodPressureSystolic: '',\n    bloodPressureDiastolic: '',\n    heartRate: '',\n    temperature: '',\n    respiratoryRate: '',\n    oxygenSaturation: '',\n    weight: '',\n    height: '',\n    bloodGlucose: '',\n    painScale: '',\n    notes: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Initialize form with existing data when editing\n  useEffect(() => {\n    if (editingVital) {\n      setFormData({\n        bloodPressureSystolic: editingVital.blood_pressure_systolic?.toString() || '',\n        bloodPressureDiastolic: editingVital.blood_pressure_diastolic?.toString() || '',\n        heartRate: editingVital.heart_rate?.toString() || '',\n        temperature: editingVital.temperature?.toString() || '',\n        respiratoryRate: editingVital.respiratory_rate?.toString() || '',\n        oxygenSaturation: editingVital.oxygen_saturation?.toString() || '',\n        weight: editingVital.weight?.toString() || '',\n        height: editingVital.height?.toString() || '',\n        bloodGlucose: editingVital.blood_glucose?.toString() || '',\n        painScale: editingVital.pain_scale?.toString() || '',\n        notes: editingVital.notes || ''\n      });\n    }\n  }, [editingVital]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    try {\n      const vitalsData: any = {\n        patientId,\n        recordedBy: currentUser?.id || null,\n        bloodPressureSystolic: formData.bloodPressureSystolic ? parseInt(formData.bloodPressureSystolic) : undefined,\n        bloodPressureDiastolic: formData.bloodPressureDiastolic ? parseInt(formData.bloodPressureDiastolic) : undefined,\n        heartRate: formData.heartRate ? parseInt(formData.heartRate) : undefined,\n        temperature: formData.temperature ? parseFloat(formData.temperature) : undefined,\n        respiratoryRate: formData.respiratoryRate ? parseInt(formData.respiratoryRate) : undefined,\n        oxygenSaturation: formData.oxygenSaturation ? parseInt(formData.oxygenSaturation) : undefined,\n        weight: formData.weight ? parseFloat(formData.weight) : undefined,\n        height: formData.height ? parseFloat(formData.height) : undefined,\n        bloodGlucose: formData.bloodGlucose ? parseInt(formData.bloodGlucose) : undefined,\n        painScale: formData.painScale ? parseInt(formData.painScale) : undefined,\n        notes: formData.notes || undefined\n      };\n\n      if (editingVital) {\n        // Update existing vital record\n        await updateVitalRecord(editingVital.id, vitalsData);\n      } else {\n        // Record new vital signs\n        await recordVitals(vitalsData);\n      }\n\n      onVitalsRecorded();\n      onClose();\n    } catch (err) {\n      console.error('Error recording vitals:', err);\n      setError(err instanceof Error ? err.message : 'Failed to record vitals');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-xl font-bold text-gray-900\">\n              {editingVital ? 'Edit Vitals' : 'Record New Vitals'}\n            </h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <X className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm\">\n              {error}\n            </div>\n          )}\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Blood Pressure */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Systolic BP (mmHg)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"bloodPressureSystolic\"\n                  value={formData.bloodPressureSystolic}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Diastolic BP (mmHg)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"bloodPressureDiastolic\"\n                  value={formData.bloodPressureDiastolic}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n            </div>\n\n            {/* Vital Signs */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Heart Rate (bpm)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"heartRate\"\n                  value={formData.heartRate}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Temperature (C)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  name=\"temperature\"\n                  value={formData.temperature}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Respiratory Rate (bpm)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"respiratoryRate\"\n                  value={formData.respiratoryRate}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Oxygen Saturation (%)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"oxygenSaturation\"\n                  value={formData.oxygenSaturation}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n            </div>\n\n            {/* Physical Measurements */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Weight (kg)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  name=\"weight\"\n                  value={formData.weight}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Height (cm)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  name=\"height\"\n                  value={formData.height}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Blood Glucose (mg/dL)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"bloodGlucose\"\n                  value={formData.bloodGlucose}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Pain Scale (0-10)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"10\"\n                  name=\"painScale\"\n                  value={formData.painScale}\n                  onChange={handleChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                />\n              </div>\n            </div>\n\n            {/* Notes */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Notes\n              </label>\n              <textarea\n                name=\"notes\"\n                value={formData.notes}\n                onChange={handleChange}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                placeholder=\"Additional notes about the patient's condition...\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-3 pt-4\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50\"\n                disabled={loading}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                className=\"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50\"\n                disabled={loading}\n              >\n                {loading ? 'Saving...' : editingVital ? 'Update Vitals' : 'Record Vitals'}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}