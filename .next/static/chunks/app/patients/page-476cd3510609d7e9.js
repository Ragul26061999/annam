(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8773],{646:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1007:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1243:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},1558:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});var s=a(5155),r=a(2115),i=a(6874),n=a.n(i),l=a(5695),d=a(3904),o=a(1243),c=a(2318),m=a(3109),x=a(7580),u=a(4186),h=a(5339),g=a(1976),p=a(646),y=a(7924),b=a(5448),f=a(4020),j=a(9074),v=a(9420),N=a(4516),w=a(6643),_=a(4835),A=a(2657),k=a(4940),S=a(2099),D=a(4416);async function C(e){try{let{data:t,error:a}=await S.ND.from("beds").select("*").eq("id",e.bedId).eq("status","available").single();if(a||!t)throw Error("Bed is not available for allocation");let{data:s,error:r}=await S.ND.from("bed_allocations").select("*").eq("patient_id",e.patientId).eq("status","active").single();if(r&&"PGRST116"!==r.code)throw Error("Error checking existing allocation");if(s)throw Error("Patient already has an active bed allocation");let i={patient_id:e.patientId,bed_id:e.bedId,doctor_id:e.doctorId||null,admission_date:e.admissionDate,admission_type:e.admissionType,reason:e.reason,status:"active",daily_charges:0,total_charges:0},{data:n,error:l}=await S.ND.from("bed_allocations").insert([i]).select("\n        *,\n        patient:patients(name, patient_id),\n        bed:beds(id, bed_number, room_number, floor_number, bed_type),\n        doctor:doctors(license_number, user:users(name))\n      ").single();if(l)throw console.error("Error creating bed allocation:",l),Error("Failed to create bed allocation: ".concat(l.message));let{error:d}=await S.ND.from("beds").update({status:"occupied"}).eq("id",e.bedId);if(d)throw console.error("Error updating bed status:",d),await S.ND.from("bed_allocations").delete().eq("id",n.id),Error("Failed to update bed status");return n}catch(e){throw console.error("Error allocating bed:",e),e}}function I(e){let{isOpen:t,onClose:a,patient:i,onSuccess:n}=e,[l,d]=(0,r.useState)([]),[o,c]=(0,r.useState)([]),[m,x]=(0,r.useState)("all"),[u,g]=(0,r.useState)([]),[y,b]=(0,r.useState)([]),[f,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[_,A]=(0,r.useState)(null),[k,I]=(0,r.useState)(!1),[q,M]=(0,r.useState)({bedId:"",doctorId:"",admissionType:"scheduled",reason:"",admissionDate:new Date().toISOString().split("T")[0]}),[E,T]=(0,r.useState)(null),[P,F]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&(R(),z(),A(null),I(!1))},[t]);let R=async()=>{try{j(!0);let{data:e,error:t}=await S.ND.from("beds").select("\n          *,\n          department:departments(name)\n        ").eq("status","available").order("bed_number");if(t)throw t;let a=(null==e?void 0:e.map(e=>({...e,department:Array.isArray(e.department)?e.department[0]:e.department})))||[];d(a);let s=[...new Set(a.map(e=>{var t;return null==(t=e.department)?void 0:t.name}).filter(Boolean))];g(s),c(a)}catch(e){console.error("Error fetching beds:",e),A("Failed to load available beds")}finally{j(!1)}},z=async()=>{try{let{data:e,error:t}=await S.ND.from("doctors").select("\n          id,\n          license_number,\n          specialization,\n          user:users!inner(name)\n        ").eq("status","active").order("specialization");if(t)throw t;let a=(null==e?void 0:e.map(e=>({...e,user:Array.isArray(e.user)?e.user[0]:e.user})))||[];b(a)}catch(e){console.error("Error fetching doctors:",e),A("Failed to load doctors")}},B=e=>{x(e),"all"===e||""===e?c(l):c(l.filter(t=>{var a;return(null==(a=t.department)?void 0:a.name)===e})),M(e=>({...e,bedId:""})),T(null)},O=e=>{T(e),M(t=>({...t,bedId:e.id}))},L=e=>{F(e),M(t=>({...t,doctorId:e.license_number}))},H=async e=>{if(e.preventDefault(),!q.bedId)return void A("Please select a bed");try{N(!0),A(null);let e={patientId:i.id,bedId:q.bedId,doctorId:q.doctorId||void 0,admissionDate:q.admissionDate,admissionType:q.admissionType||"general",reason:q.reason||""};await C(e),I(!0),setTimeout(()=>{n(),a(),U()},2e3)}catch(e){console.error("Error admitting patient:",e),A(e.message||"Failed to admit patient")}finally{N(!1)}},U=()=>{M({bedId:"",doctorId:"",admissionType:"scheduled",reason:"",admissionDate:new Date().toISOString().split("T")[0]}),T(null),F(null),A(null),I(!1)},W=()=>{v||(U(),a())};if(!t)return null;let J=o.reduce((e,t)=>{let a="Floor ".concat(t.floor_number);return e[a]||(e[a]=[]),e[a].push(t),e},{});return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Patient Admission"}),(0,s.jsxs)("p",{className:"text-orange-100 mt-1",children:["Admit ",i.name," (",i.patient_id,")"]})]}),(0,s.jsx)("button",{onClick:W,disabled:v,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors disabled:opacity-50",children:(0,s.jsx)(D.A,{size:24})})]})}),(0,s.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:k?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(p.A,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Patient Admitted Successfully!"}),(0,s.jsxs)("p",{className:"text-gray-600",children:[i.name," has been admitted to Floor ",null==E?void 0:E.floor_number," - Bed ",null==E?void 0:E.bed_number]})]}):(0,s.jsxs)("form",{onSubmit:H,className:"space-y-6",children:[_&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center",children:[(0,s.jsx)(h.A,{className:"w-5 h-5 text-red-500 mr-3"}),(0,s.jsx)("span",{className:"text-red-700",children:_})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Patient Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Name:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"ID:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.patient_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Phone:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.phone})]}),i.primary_complaint&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Complaint:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.primary_complaint})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admission Date *"}),(0,s.jsx)("input",{type:"date",value:q.admissionDate,onChange:e=>M(t=>({...t,admissionDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",required:!0})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admission Type *"}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"emergency",label:"Emergency",color:"red"},{value:"scheduled",label:"Scheduled",color:"blue"},{value:"transfer",label:"Transfer",color:"yellow"}].map(e=>(0,s.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"admissionType",value:e.value,checked:q.admissionType===e.value,onChange:e=>M(t=>({...t,admissionType:e.target.value})),className:"sr-only"}),(0,s.jsx)("div",{className:"w-full p-3 rounded-lg border-2 text-center text-sm font-medium transition-all ".concat(q.admissionType===e.value?"border-".concat(e.color,"-500 bg-").concat(e.color,"-50 text-").concat(e.color,"-700"):"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:e.label})]},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attending Doctor *"}),f?(0,s.jsx)("div",{className:"animate-pulse bg-gray-200 h-12 rounded-lg"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2",children:y.map(e=>(0,s.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"doctor",value:e.license_number,checked:q.doctorId===e.license_number,onChange:()=>L(e),className:"sr-only"}),(0,s.jsxs)("div",{className:"w-full p-3 rounded-lg border text-sm transition-all ".concat(q.doctorId===e.license_number?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,s.jsx)("div",{className:"font-medium",children:e.user.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.specialization})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bed *"}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>B("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("all"===m||""===m?"bg-orange-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All Wards (",l.length,")"]}),u.map(e=>{let t=l.filter(t=>{var a;return(null==(a=t.department)?void 0:a.name)===e}).length;return(0,s.jsxs)("button",{type:"button",onClick:()=>B(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(m===e?"bg-orange-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e," (",t,")"]},e)})]})}),f?(0,s.jsx)("div",{className:"animate-pulse bg-gray-200 h-32 rounded-lg"}):0===o.length?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)(w.A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,s.jsxs)("p",{children:["No beds available in ",m||"any ward"]})]}):(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg",children:0===Object.keys(J).length?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)(w.A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No beds available on any floor"})]}):Object.entries(J).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"border-b border-gray-100 last:border-b-0",children:[(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-2 font-medium text-gray-700 text-sm flex items-center justify-between",children:[(0,s.jsx)("span",{children:t}),(0,s.jsxs)("span",{className:"text-xs bg-gray-200 px-2 py-1 rounded-full",children:[a.length," bed",1!==a.length?"s":""]})]}),(0,s.jsx)("div",{className:"p-2 grid grid-cols-4 md:grid-cols-6 gap-2",children:a.map(e=>{var t;return(0,s.jsxs)("label",{className:"flex items-center cursor-pointer group",children:[(0,s.jsx)("input",{type:"radio",name:"bedId",value:e.id,checked:q.bedId===e.id,onChange:()=>O(e),className:"sr-only"}),(0,s.jsxs)("div",{className:"w-full p-2 rounded-lg border-2 text-center text-sm transition-all group-hover:shadow-sm ".concat(q.bedId===e.id?"border-orange-500 bg-orange-50 text-orange-700 shadow-sm":"border-gray-200 bg-white text-gray-700 hover:border-orange-300 hover:bg-orange-25"),children:[(0,s.jsxs)("div",{className:"font-medium text-xs",children:["Bed ",e.bed_number]}),(null==(t=e.department)?void 0:t.name)&&(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1 truncate",children:e.department.name})]})]},e.id)})})]},t)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Admission *"}),(0,s.jsx)("textarea",{value:q.reason,onChange:e=>M(t=>({...t,reason:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Enter the reason for admission...",required:!0})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,s.jsx)("button",{type:"button",onClick:W,disabled:v,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:v||f,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 flex items-center justify-center",children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Admitting..."]}):"Admit Patient"})]})]})})]})})}var q=a(7434),M=a(1007),E=a(4616),T=a(2525),P=a(4229);class F{static async getFeeCategories(){let{data:e,error:t}=await S.ND.from("fee_categories").select("*").eq("is_active",!0).order("name");if(t)throw console.error("Error fetching fee categories:",t),t;return e||[]}static async getFeeRatesByCategory(e){let{data:t,error:a}=await S.ND.from("fee_rates").select("\n        *,\n        category:fee_categories(*)\n      ").eq("category_id",e).eq("is_active",!0).order("service_name");if(a)throw console.error("Error fetching fee rates:",a),a;return t||[]}static async getAllFeeRates(){let{data:e,error:t}=await S.ND.from("fee_rates").select("\n        *,\n        category:fee_categories(*)\n      ").eq("is_active",!0).order("service_name");if(t)throw console.error("Error fetching all fee rates:",t),t;return e||[]}static async calculateRoomCharges(e,t,a){try{var s,r;let{data:i,error:n}=await S.ND.from("beds").select("bed_number, room_number, department_ward").eq("id",e).single();if(n)throw n;let l=new Date(t),d=new Date(a),o=Math.abs(d.getTime()-l.getTime()),c=Math.max(1,Math.ceil(o/864e5)),m="General Ward Bed",x=800;(null==(s=i.department_ward)?void 0:s.toLowerCase().includes("icu"))?(m="ICU Bed",x=5e3):(null==(r=i.department_ward)?void 0:r.toLowerCase().includes("emergency"))?(m="Emergency Bed",x=1200):i.room_number&&!i.room_number.includes("Ward")&&(m="Private Room",x=2e3);let{data:u}=await S.ND.from("fee_rates").select("rate_per_unit").eq("service_name",m).eq("is_active",!0).single();u&&(x=u.rate_per_unit);let h=c*x;return{days:c,dailyRate:x,totalCharges:h,bedType:m}}catch(e){return console.error("Error calculating room charges:",e),{days:1,dailyRate:800,totalCharges:800,bedType:"General Ward Bed"}}}static async createPatientAdmission(e){let{data:t,error:a}=await S.ND.from("patient_admissions").insert(e).select().single();if(a)throw console.error("Error creating patient admission:",a),a;return t}static async updatePatientAdmission(e,t){let{data:a,error:s}=await S.ND.from("patient_admissions").update(t).eq("id",e).select().single();if(s)throw console.error("Error updating patient admission:",s),s;return a}static async getPatientAdmissionByBedAllocation(e){let{data:t,error:a}=await S.ND.from("patient_admissions").select("*").eq("bed_allocation_id",e).eq("status","active").single();if(a){if("PGRST116"===a.code)return null;throw console.error("Error fetching patient admission:",a),a}return t}static generateBillNumber(){let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),r=String(e.getTime()).slice(-6);return"BILL-".concat(t).concat(a).concat(s,"-").concat(r)}static async createBillingSummary(e){let{data:t,error:a}=await S.ND.from("billing_summary").insert(e).select().single();if(a)throw console.error("Error creating billing summary:",a),a;return t}static async createBillingItems(e){let{data:t,error:a}=await S.ND.from("billing_items").insert(e).select();if(a)throw console.error("Error creating billing items:",a),a;return t||[]}static calculateBillTotals(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=e.reduce((e,t)=>e+t.quantity*t.unit_rate,0),r=s*t/100,i=s*a/100;return{subtotal:Math.round(100*s)/100,taxAmount:Math.round(100*r)/100,discountAmount:Math.round(100*i)/100,totalAmount:Math.round(100*(s+r-i))/100}}static async getPatientAdmissionHistory(e){let{data:t,error:a}=await S.ND.from("patient_admissions").select("*").eq("patient_id",e).order("admission_date",{ascending:!1});if(a)throw console.error("Error fetching patient admission history:",a),a;return t||[]}static async getPatientBillingHistory(e){let{data:t,error:a}=await S.ND.from("billing_summary_detailed").select("*").eq("patient_id",e).order("bill_date",{ascending:!1});if(a)throw console.error("Error fetching patient billing history:",a),a;return t||[]}static async getBillingItemsForAdmission(e){let{data:t,error:a}=await S.ND.from("billing_items").select("*").eq("patient_admission_id",e).order("service_date",{ascending:!1});if(a)throw console.error("Error fetching billing items:",a),a;return t||[]}static async processDischarge(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;try{let{data:n,error:l}=await S.ND.from("bed_allocations").select("\n          *,\n          patient:patients(*),\n          bed:beds(*)\n        ").eq("id",e).single();if(l)throw l;let d=await this.getPatientAdmissionByBedAllocation(e);d||(d=await this.createPatientAdmission({patient_id:n.patient_id,bed_allocation_id:e,admission_date:n.admission_date,status:"active",admission_type:n.admission_type||"elective",room_charges:0,total_bill_amount:0}));let o=await this.calculateRoomCharges(n.bed_id,n.admission_date,t),c=[{patient_admission_id:d.id,service_name:o.bedType,quantity:o.days,unit_rate:o.dailyRate,service_date:new Date().toISOString().split("T")[0],notes:"Room charges for ".concat(o.days," days")},...s.map(e=>({...e,patient_admission_id:d.id}))],m=this.calculateBillTotals(c,r,i),x=await this.createBillingSummary({patient_admission_id:d.id,bill_number:this.generateBillNumber(),bill_date:new Date().toISOString(),subtotal:m.subtotal,tax_percentage:r,discount_percentage:i,payment_status:"pending",notes:a}),u=await this.createBillingItems(c.map(e=>({...e,billing_summary_id:x.id}))),h=await this.updatePatientAdmission(d.id,{discharge_date:t,status:"discharged",discharge_notes:a,room_charges:o.totalCharges,total_bill_amount:m.totalAmount}),{error:g}=await S.ND.from("bed_allocations").update({discharge_date:t,status:"discharged"}).eq("id",e);if(g)throw g;let{error:p}=await S.ND.from("beds").update({status:"available"}).eq("id",n.bed_id);if(p)throw p;return{admission:h,billing:x,items:u,roomCharges:o,totals:m}}catch(e){throw console.error("Error processing discharge:",e),e}}}let R=e=>{let{isOpen:t,onClose:a,patient:i,onDischargeSuccess:n}=e,[l,d]=(0,r.useState)(!1),[o,c]=(0,r.useState)(new Date().toISOString().slice(0,16)),[m,x]=(0,r.useState)(""),[g,p]=(0,r.useState)({days:0,dailyRate:0,totalCharges:0,bedType:""}),[y,b]=(0,r.useState)([]),[f,v]=(0,r.useState)([]),[N,_]=(0,r.useState)([]),[A,k]=(0,r.useState)(0),[C,I]=(0,r.useState)(0),[R,z]=(0,r.useState)({subtotal:0,taxAmount:0,discountAmount:0,totalAmount:0}),[B,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&L()},[t]),(0,r.useEffect)(()=>{t&&i&&H()},[t,i,o,y,A,C]);let L=async()=>{try{let[e,t]=await Promise.all([F.getFeeCategories(),F.getAllFeeRates()]);v(e.map(e=>({id:e.id,name:e.name,description:e.description||""}))),_(t.map(e=>({id:e.id,category_id:e.category_id,service_name:e.service_name,rate_per_unit:e.rate_per_unit,unit_type:e.unit_type})))}catch(e){console.error("Error loading fee data:",e),O("Failed to load fee data")}},H=async()=>{if(null==i?void 0:i.bed_allocation)try{let e=await F.calculateRoomCharges(i.bed_allocation.bed_id,i.bed_allocation.admission_date,o);p(e);let t=[{patient_admission_id:"",service_name:e.bedType,quantity:e.days,unit_rate:e.dailyRate,service_date:new Date().toISOString().split("T")[0],notes:"Room charges for ".concat(e.days," days")},...y.map(e=>({patient_admission_id:"",service_name:e.service_name,quantity:e.quantity,unit_rate:e.unit_rate,fee_rate_id:e.fee_rate_id,service_date:new Date().toISOString().split("T")[0],notes:e.notes}))],a=F.calculateBillTotals(t,A,C);z(a)}catch(e){console.error("Error calculating billing:",e),O("Failed to calculate billing")}},U=(e,t,a)=>{b(s=>s.map((s,r)=>r===e?{...s,[t]:a}:s))},W=e=>{b(t=>t.filter((t,a)=>a!==e))},J=(e,t)=>{let a=N.find(e=>e.id===t);a&&(U(e,"service_name",a.service_name),U(e,"unit_rate",a.rate_per_unit),U(e,"fee_rate_id",a.id))},V=async()=>{if(!i.bed_id)return void O("Patient is not currently admitted");d(!0),O(null);try{let e=new Date(o),{totalAmount:t}=R,{data:s,error:r}=await S.ND.from("bed_allocations").select("id").eq("patient_id",i.id).eq("bed_id",i.bed_id).is("discharge_date",null).single();if(r||!s)throw Error("Could not find active bed allocation for patient");let{error:l}=await S.ND.from("bed_allocations").update({discharge_date:e.toISOString(),status:"discharged",total_charges:t,updated_at:new Date().toISOString()}).eq("patient_id",i.id).eq("bed_id",i.bed_id).is("discharge_date",null);if(l)throw l;let d=y.map(e=>({patient_admission_id:"",service_name:e.service_name,quantity:e.quantity,unit_rate:e.unit_rate,fee_rate_id:e.fee_rate_id,service_date:new Date().toISOString().split("T")[0],notes:e.notes}));await F.processDischarge(s.id,e.toISOString(),m,d,A,C);let{error:c}=await S.ND.from("beds").update({status:"available"}).eq("id",i.bed_id);if(c)throw c;n(),a()}catch(e){console.error("Error discharging patient:",e),O("Failed to discharge patient. Please try again.")}finally{d(!1)}};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"bg-red-100 p-2 rounded-xl",children:(0,s.jsx)(q.A,{className:"h-6 w-6 text-red-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Discharge Patient"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[i.name," - ",i.patient_id]})]})]}),(0,s.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:(0,s.jsx)(D.A,{className:"h-5 w-5 text-gray-500"})})]}),B&&(0,s.jsxs)("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 text-red-500 mr-2"}),(0,s.jsx)("span",{className:"text-red-700",children:B})]}),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Patient Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(M.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Name:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.name})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(w.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Room:"}),(0,s.jsxs)("span",{className:"ml-2 font-medium",children:[i.department_ward," - ",i.room_number]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Admitted:"}),(0,s.jsx)("span",{className:"ml-2 font-medium",children:i.admission_date?new Date(i.admission_date).toLocaleDateString():"N/A"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Stay Duration:"}),(0,s.jsxs)("span",{className:"ml-2 font-medium",children:[g.days," days"]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discharge Date & Time"}),(0,s.jsx)("input",{type:"datetime-local",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Room Charges"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Bed Type:"}),(0,s.jsx)("p",{className:"font-medium",children:g.bedType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Days:"}),(0,s.jsx)("p",{className:"font-medium",children:g.days})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Daily Rate:"}),(0,s.jsxs)("p",{className:"font-medium",children:["₹",g.dailyRate]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,s.jsxs)("p",{className:"font-medium text-blue-600",children:["₹",g.totalCharges]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Additional Services"}),(0,s.jsxs)("button",{onClick:()=>{b([...y,{service_name:"",quantity:1,unit_rate:0,notes:""}])},className:"flex items-center bg-orange-500 text-white px-3 py-2 rounded-xl text-sm hover:bg-orange-600 transition-colors",children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"Add Service"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:y.map((e,t)=>(0,s.jsx)("div",{className:"bg-gray-50 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-5 gap-3 items-end",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Service"}),(0,s.jsxs)("select",{value:e.service_name,onChange:e=>{let a=N.find(t=>t.service_name===e.target.value);a&&J(t,a.id)},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500",children:[(0,s.jsx)("option",{value:"",children:"Select Service"}),N.map(e=>(0,s.jsx)("option",{value:e.service_name,children:e.service_name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantity"}),(0,s.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:e=>U(t,"quantity",parseInt(e.target.value)||1),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Unit Rate (₹)"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.unit_rate,onChange:e=>U(t,"unit_rate",parseFloat(e.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total (₹)"}),(0,s.jsx)("input",{type:"text",value:(e.quantity*e.unit_rate).toFixed(2),readOnly:!0,className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg bg-gray-100"})]}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:()=>W(t),className:"p-1 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:(0,s.jsx)(T.A,{className:"h-4 w-4"})})})]})},t))})]}),(0,s.jsxs)("div",{className:"bg-orange-50 rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Billing Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax (%)"}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:A,onChange:e=>k(parseFloat(e.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Discount (%)"}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:C,onChange:e=>I(parseFloat(e.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500"})]})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,s.jsxs)("span",{className:"font-medium",children:["₹",R.subtotal.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Tax (",A,"%):"]}),(0,s.jsxs)("span",{className:"font-medium",children:["₹",R.taxAmount.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Discount (",C,"%):"]}),(0,s.jsxs)("span",{className:"font-medium text-green-600",children:["-₹",R.discountAmount.toFixed(2)]})]}),(0,s.jsx)("div",{className:"border-t border-gray-300 pt-2",children:(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,s.jsx)("span",{children:"Total Amount:"}),(0,s.jsxs)("span",{className:"text-orange-600",children:["₹",R.totalAmount.toFixed(2)]})]})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discharge Notes (Optional)"}),(0,s.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Enter any discharge notes or instructions..."})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[(0,s.jsx)("button",{onClick:a,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{onClick:V,disabled:l,className:"flex items-center bg-red-500 text-white px-6 py-2 rounded-xl hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Discharge Patient"]})})]})]})}):null};function z(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)([]),[i,D]=(0,r.useState)(!0),[C,q]=(0,r.useState)(null),[M,E]=(0,r.useState)(""),[T,P]=(0,r.useState)(""),[F,z]=(0,r.useState)(0),[B,O]=(0,r.useState)(1),[L,H]=(0,r.useState)(!1),[U,W]=(0,r.useState)(0),[J,V]=(0,r.useState)(0),[G,X]=(0,r.useState)(!1),[Z,Y]=(0,r.useState)(null),[Q,K]=(0,r.useState)(!1),[$,ee]=(0,r.useState)(null);(0,r.useEffect)(()=>{ea()},[B,T,M]);let et=async(e,t,a)=>{try{let s={};"admission_type"===t?s.admission_type=a:"status"===t&&(s.status=a);let{error:r}=await S.ND.from("patients").update(s).eq("id",e);if(r){console.error("Error updating patient status:",r),alert("Failed to update patient status. Please try again.");return}if("admission_type"===t&&"elective"===a){let{data:t,error:a}=await S.ND.from("bed_allocations").select("allocation_id, bed_id").eq("patient_id",e).eq("status","active").is("discharge_date",null).single();if(!a&&t&&confirm("This patient has an active bed allocation. Do you want to discharge them from the bed as well?")){let e=new Date().toISOString().split("T")[0],a=new Date().toTimeString().split(" ")[0];await S.ND.from("bed_allocations").update({discharge_date:e,discharge_time:a,status:"discharged",discharge_summary:"Discharged via patient dashboard - status changed to non-critical"}).eq("allocation_id",t.allocation_id),await S.ND.from("beds").update({status:"available"}).eq("id",t.bed_id)}}await ea()}catch(e){console.error("Error updating patient status:",e),alert("Failed to update patient status. Please try again.")}},ea=async()=>{try{D(!0);let{data:e,error:t}=await S.ND.from("patients").select("*").eq("status","active").order("created_at",{ascending:!1});if(t){console.error("Error fetching patients:",t),q("Failed to fetch patients");return}let{data:s,error:r}=await S.ND.from("bed_allocations").select("patient_id, bed_id, admission_date, discharge_date, status").eq("status","active").is("discharge_date",null);r&&console.error("Error fetching bed allocations:",r);let i=new Map;s&&s.forEach(e=>{i.set(e.patient_id,{bed_id:e.bed_id,admission_date:e.admission_date,discharge_date:e.discharge_date})});let n=(null==e?void 0:e.map(e=>{var t,a,s;return{...e,bed_id:(null==(t=i.get(e.id))?void 0:t.bed_id)||null,admission_date:(null==(a=i.get(e.id))?void 0:a.admission_date)||null,discharge_date:(null==(s=i.get(e.id))?void 0:s.discharge_date)||null}}))||[];a(n),z(n.length);let l=n.filter(e=>null!==e.bed_id).length,d=n.filter(e=>"emergency"===e.admission_type).length;W(l),V(d)}catch(e){console.error("Error:",e),q("Failed to fetch patients")}finally{D(!1)}},es=async()=>{H(!0),await ea(),H(!1)},er=e=>{Y(e),X(!0)},ei=e=>{ee(e),K(!0)},en=e=>{E(e),O(1)},el=e=>{P(e),O(1)},ed=e=>{if(!e)return"N/A";let t=new Date(e),a=new Date,s=a.getFullYear()-t.getFullYear(),r=a.getMonth()-t.getMonth();return(r<0||0===r&&a.getDate()<t.getDate())&&s--,s},eo=e=>null!==e.bed_id,ec=e=>"emergency"===e.admission_type,em=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return e?e.length>t?"".concat(e.substring(0,t),"..."):e:"Not specified"},ex=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),eu=e=>{let t=["from-purple-500 to-pink-500","from-blue-500 to-cyan-500","from-green-500 to-emerald-500","from-orange-500 to-red-500","from-indigo-500 to-purple-500","from-pink-500 to-rose-500","from-cyan-500 to-blue-500","from-emerald-500 to-green-500"];return t[Math.abs(e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0))%t.length]},eh={total:F,newToday:t.filter(e=>{let t=new Date().toDateString();return new Date(e.created_at).toDateString()===t}).length,critical:J,admitted:U},eg=t.filter(e=>{var t;let a=!M||e.name.toLowerCase().includes(M.toLowerCase())||e.patient_id.toLowerCase().includes(M.toLowerCase())||(null==(t=e.phone)?void 0:t.includes(M)),s=!T||"critical"===T&&ec(e)||"admitted"===T&&eo(e)||"active"===T&&"active"===e.status;return a&&s});return i&&0===t.length?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading patients..."})]})}):(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Patients"}),(0,s.jsx)("p",{className:"text-gray-500 mt-1",children:"Manage patient records and information"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{onClick:es,disabled:L,className:"flex items-center bg-white border border-gray-300 text-gray-700 px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md hover:bg-gray-50 disabled:opacity-50",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 mr-2 ".concat(L?"animate-spin":"")}),"Refresh"]}),(0,s.jsx)(n(),{href:"/patients/emergency-register",children:(0,s.jsxs)("button",{className:"flex items-center bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,s.jsx)(o.A,{size:16,className:"mr-2"}),"Emergency Register"]})}),(0,s.jsx)(n(),{href:"/patients/register",children:(0,s.jsxs)("button",{className:"flex items-center bg-orange-500 hover:bg-orange-600 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,s.jsx)(c.A,{size:16,className:"mr-2"}),"Register New Patient"]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Total Patients"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:eh.total.toLocaleString()}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:[(0,s.jsx)(m.A,{className:"h-3 w-3 text-green-500 mr-1"}),(0,s.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Active"})]})]}),(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:(0,s.jsx)(x.A,{className:"h-6 w-6 text-white"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"New Today"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:eh.newToday.toLocaleString()}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:[(0,s.jsx)(u.A,{className:"h-3 w-3 text-blue-500 mr-1"}),(0,s.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Today"})]})]}),(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:(0,s.jsx)(c.A,{className:"h-6 w-6 text-white"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Critical"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:eh.critical.toLocaleString()}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:[(0,s.jsx)(h.A,{className:"h-3 w-3 text-red-500 mr-1"}),(0,s.jsx)("span",{className:"text-sm font-medium text-red-600",children:"Emergency"})]})]}),(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center",children:(0,s.jsx)(g.A,{className:"h-6 w-6 text-white"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Admitted"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:eh.admitted.toLocaleString()}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:[(0,s.jsx)(p.A,{className:"h-3 w-3 text-orange-500 mr-1"}),(0,s.jsx)("span",{className:"text-sm font-medium text-orange-600",children:"In Beds"})]})]}),(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl flex items-center justify-center",children:(0,s.jsx)(p.A,{className:"h-6 w-6 text-white"})})]})})]}),(0,s.jsx)("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(y.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search patients by name, ID, or phone...",value:M,onChange:e=>en(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)("select",{value:T,onChange:e=>el(e.target.value),className:"px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white",children:[(0,s.jsx)("option",{value:"",children:"All Status"}),(0,s.jsx)("option",{value:"active",children:"Active"}),(0,s.jsx)("option",{value:"critical",children:"Critical"}),(0,s.jsx)("option",{value:"admitted",children:"Admitted"})]})})]})}),C&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 text-red-500 mr-2"}),(0,s.jsx)("p",{className:"text-red-700",children:C})]})}),eg.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:eg.map(t=>{var a,r;return(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 hover:shadow-md transition-shadow duration-200",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r ".concat(eu(t.name)," rounded-xl flex items-center justify-center text-white font-bold text-sm"),children:ex(t.name)}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:t.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.A,{className:"h-3 w-3 text-gray-400"}),(0,s.jsx)("p",{className:"text-sm text-orange-600 font-mono",children:t.patient_id})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[ec(t)&&(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800 flex items-center gap-1",children:[(0,s.jsx)(h.A,{size:10}),"Critical"]}),eo(t)&&(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 flex items-center gap-1",children:[(0,s.jsx)(p.A,{size:10}),"Admitted"]}),(0,s.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:(0,s.jsx)(f.A,{size:16,className:"text-gray-500"})})]})]}),(0,s.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,s.jsx)(j.A,{size:14,className:"mr-2"}),"Age: ",ed(t.date_of_birth)," • ",(null==(a=t.gender)?void 0:a.charAt(0).toUpperCase())+(null==(r=t.gender)?void 0:r.slice(1))," • ",t.blood_group||"Unknown"]}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,s.jsx)(v.A,{size:14,className:"mr-2"}),t.phone]}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,s.jsx)(N.A,{size:14,className:"mr-2"}),em(t.address,35)]})]}),t.primary_complaint&&(0,s.jsxs)("div",{className:"bg-orange-50 rounded-xl p-3 mb-4",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-orange-700 mb-1",children:"Primary Complaint"}),(0,s.jsx)("p",{className:"text-sm text-orange-900",children:em(t.primary_complaint,50)})]}),t.department_ward&&(0,s.jsxs)("div",{className:"bg-blue-50 rounded-xl p-3 mb-4",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-blue-700 mb-1",children:"Current Department"}),(0,s.jsxs)("p",{className:"text-sm text-blue-900",children:[t.department_ward," ",t.room_number&&"- ".concat(t.room_number)]})]}),t.allergies&&(0,s.jsxs)("div",{className:"bg-red-50 rounded-xl p-3 mb-4 border border-red-200",children:[(0,s.jsxs)("p",{className:"text-xs font-medium text-red-700 mb-1 flex items-center",children:[(0,s.jsx)(h.A,{size:12,className:"mr-1"}),"Allergies"]}),(0,s.jsx)("p",{className:"text-sm text-red-900",children:em(t.allergies,40)})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3 mb-4",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Patient Status"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Critical Status"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"critical-".concat(t.id),checked:"emergency"===t.admission_type,onChange:()=>et(t.id,"admission_type","emergency"),className:"w-4 h-4 text-red-600 bg-gray-100 border-gray-300 focus:ring-red-500 focus:ring-2"}),(0,s.jsx)("span",{className:"ml-1 text-xs text-red-700",children:"Critical"})]}),(0,s.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"critical-".concat(t.id),checked:"emergency"!==t.admission_type,onChange:()=>et(t.id,"admission_type","elective"),className:"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 focus:ring-gray-500 focus:ring-2"}),(0,s.jsx)("span",{className:"ml-1 text-xs text-gray-700",children:"Stable"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Admission Status"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(eo(t)?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:eo(t)?"Admitted":"Outpatient"}),eo(t)?(0,s.jsxs)("button",{onClick:()=>ei(t),className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors flex items-center gap-1",children:[(0,s.jsx)(_.A,{size:10}),"Discharge"]}):(0,s.jsxs)("button",{onClick:()=>er(t),className:"px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-700 hover:bg-orange-200 transition-colors flex items-center gap-1",children:[(0,s.jsx)(w.A,{size:10}),"Admit"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(n(),{href:"/patients/".concat(t.patient_id),className:"flex-1",children:(0,s.jsxs)("button",{className:"w-full flex items-center justify-center bg-orange-50 text-orange-600 py-2 px-3 rounded-xl text-sm font-medium hover:bg-orange-100 transition-colors",children:[(0,s.jsx)(A.A,{size:14,className:"mr-1"}),"View"]})}),(0,s.jsxs)("button",{onClick:()=>e.push("/patients/".concat(t.patient_id,"/edit")),className:"flex-1 flex items-center justify-center bg-gray-50 text-gray-700 py-2 px-3 rounded-xl text-sm font-medium hover:bg-gray-100 transition-colors",children:[(0,s.jsx)(k.A,{size:14,className:"mr-1"}),"Edit"]})]})]},t.id)})}):!i&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(x.A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No patients found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:M||T?"Try adjusting your search or filters.":"Start by registering your first patient."}),(0,s.jsx)(n(),{href:"/patients/register",children:(0,s.jsx)("button",{className:"bg-orange-500 text-white px-6 py-3 rounded-xl hover:bg-orange-600 transition-colors font-medium",children:"Register New Patient"})})]}),F>20&&(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-2",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600 px-4 py-2",children:["Showing ",eg.length," of ",F," patients"]})})}),Z&&(0,s.jsx)(I,{isOpen:G,onClose:()=>{X(!1),Y(null)},patient:Z,onSuccess:()=>{ea()}}),$&&(0,s.jsx)(R,{isOpen:Q,onClose:()=>{K(!1),ee(null)},patient:$,onDischargeSuccess:()=>{ea()}})]})}},1976:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},2099:(e,t,a)=>{"use strict";a.d(t,{HW:()=>i,ND:()=>s,Ru:()=>r,sh:()=>n});let s=(0,a(5647).UU)("https://zusheijhebsmjiyyeiqq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1c2hlaWpoZWJzbWppeXllaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MjI0NDAsImV4cCI6MjA2NzM5ODQ0MH0.iwGPaOJPa6OvwX_iA1xvRt5cM72DWfd8Br1pwRTemRc"),r=async(e,t)=>{let{data:a,error:r}=await s.auth.signInWithPassword({email:e,password:t});return{data:a,error:r}},i=async()=>{let{data:{user:e}}=await s.auth.getUser();return e},n=async()=>{let{data:{user:e}}=await s.auth.getUser();if(console.log("Auth user:",e),!e)return console.log("No authenticated user found"),null;let{data:t,error:a}=await s.from("users").select("*").eq("auth_id",e.id).single();return(console.log("User profile query result:",{userProfile:t,error:a}),a)?(console.error("Error fetching user profile:",a),null):(console.log("Returning user profile:",t),t)}},2318:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},2525:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2657:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3109:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},3904:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4020:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},4186:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},4416:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},4516:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},4616:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4835:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},4940:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("pen-line",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]])},5339:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5448:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]])},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},6643:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]])},7400:(e,t,a)=>{Promise.resolve().then(a.bind(a,1558))},7434:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},7580:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},9420:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[8800,2500,8441,1684,7358],()=>t(7400)),_N_E=e.O()}]);