{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = 'https://zusheijhebsmjiyyeiqq.supabase.co';\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1c2hlaWpoZWJzbWppeXllaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MjI0NDAsImV4cCI6MjA2NzM5ODQ0MH0.iwGPaOJPa6OvwX_iA1xvRt5cM72DWfd8Br1pwRTemRc';\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const signInWithEmail = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  });\n  return { data, error };\n};\n\nexport const signUpWithEmail = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${window.location.origin}/auth/callback`,\n    },\n  });\n  return { data, error };\n};\n\n// Function to create admin user without email confirmation\nexport const createAdminUser = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${window.location.origin}/auth/callback`,\n      data: {\n        email_confirm: true,\n      },\n    },\n  });\n  return { data, error };\n};\n\nexport const signOut = async () => {\n  await supabase.auth.signOut();\n};\n\nexport const getCurrentUser = async () => {\n  const { data: { user } } = await supabase.auth.getUser();\n  return user;\n};\n\nexport const getCurrentUserProfile = async () => {\n  const { data: { user } } = await supabase.auth.getUser();\n  console.log('Auth user:', user);\n  \n  if (!user) {\n    console.log('No authenticated user found');\n    return null;\n  }\n\n  // Get the user profile from our users table\n  const { data: userProfile, error } = await supabase\n    .from('users')\n    .select('*')\n    .eq('auth_id', user.id)\n    .single();\n\n  console.log('User profile query result:', { userProfile, error });\n\n  if (error) {\n    console.error('Error fetching user profile:', error);\n    return null;\n  }\n\n  console.log('Returning user profile:', userProfile);\n  return userProfile;\n};\n"],"names":[],"mappings":";;;;;;;;;AAAA;;AAEA,MAAM,cAAc;AACpB,MAAM,kBAAkB;AAEjB,MAAM,WAAW,CAAA,GAAA,0LAAA,CAAA,eAAY,AAAD,EAAE,aAAa;AAE3C,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;QAC7D;QACA;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAEO,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;QACjD;QACA;QACA,SAAS;YACP,iBAAiB,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC;QAC5D;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAGO,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;QACjD;QACA;QACA,SAAS;YACP,iBAAiB,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC;YAC1D,MAAM;gBACJ,eAAe;YACjB;QACF;IACF;IACA,OAAO;QAAE;QAAM;IAAM;AACvB;AAEO,MAAM,UAAU;IACrB,MAAM,SAAS,IAAI,CAAC,OAAO;AAC7B;AAEO,MAAM,iBAAiB;IAC5B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,OAAO;AACT;AAEO,MAAM,wBAAwB;IACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,QAAQ,GAAG,CAAC,cAAc;IAE1B,IAAI,CAAC,MAAM;QACT,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,4CAA4C;IAC5C,MAAM,EAAE,MAAM,WAAW,EAAE,KAAK,EAAE,GAAG,MAAM,SACxC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,QAAQ,GAAG,CAAC,8BAA8B;QAAE;QAAa;IAAM;IAE/D,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,2BAA2B;IACvC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/lib/bedAllocationService.ts"],"sourcesContent":["import { supabase } from './supabase';\n\n// Types for bed allocation management\nexport interface BedAllocationData {\n  patientId: string;\n  bedId: string;\n  doctorId?: string;\n  admissionDate: string;\n  admissionType: 'emergency' | 'scheduled' | 'transfer';\n  reason: string;\n}\n\nexport interface BedAllocation {\n  id: string;\n  patient_id: string;\n  bed_id: string;\n  doctor_id: string;\n  admission_date: string;\n  discharge_date?: string;\n  admission_type: string;\n  reason: string;\n  status: string;\n  daily_charges: number;\n  total_charges: number;\n  created_at: string;\n  updated_at: string;\n  patient: {\n    name: string;\n    patient_id: string;\n  };\n  bed: Bed;\n  doctor: {\n    license_number: string;\n    user: {\n      name: string;\n    };\n  };\n}\n\nexport interface Bed {\n  id: string;\n  bed_number: string;\n  room_number: string;\n  floor_number: number;\n  bed_type: string;\n  status: 'available' | 'occupied' | 'maintenance' | 'reserved';\n  department_id?: string;\n  daily_rate?: number;\n  features?: string[];\n}\n\nexport interface BedStats {\n  total: number;\n  available: number;\n  occupied: number;\n  maintenance: number;\n  reserved: number;\n  occupancyRate: number;\n}\n\n/**\n * Generate a unique bed allocation ID\n * Format: BA{Year}{Month}{Day}{Sequential}\n * Example: BA202501150001\n */\nexport async function generateAllocationId(): Promise<string> {\n  const now = new Date();\n  const year = now.getFullYear().toString();\n  const month = (now.getMonth() + 1).toString().padStart(2, '0');\n  const day = now.getDate().toString().padStart(2, '0');\n  const datePrefix = `${year}${month}${day}`;\n  \n  try {\n    // Get count of existing allocations for today\n    const { count, error } = await supabase\n      .from('bed_allocations')\n      .select('id', { count: 'exact', head: true })\n      .like('allocation_id', `BA${datePrefix}%`);\n    \n    if (error) {\n      console.error('Error getting allocation count:', error);\n      throw new Error('Failed to generate allocation ID');\n    }\n    \n    const sequence = ((count || 0) + 1).toString().padStart(4, '0');\n    return `BA${datePrefix}${sequence}`;\n  } catch (error) {\n    console.error('Error generating allocation ID:', error);\n    throw error;\n  }\n}\n\n/**\n * Allocate bed to patient\n */\nexport async function allocateBed(allocationData: BedAllocationData): Promise<BedAllocation> {\n  try {\n    // Check if bed is available\n    const { data: bed, error: bedError } = await supabase\n      .from('beds')\n      .select('*')\n      .eq('id', allocationData.bedId)\n      .eq('status', 'available')\n      .single();\n\n    if (bedError || !bed) {\n      throw new Error('Bed is not available for allocation');\n    }\n\n    // Check if patient already has an active allocation\n    const { data: existingAllocation, error: existingError } = await supabase\n      .from('bed_allocations')\n      .select('*')\n      .eq('patient_id', allocationData.patientId)\n      .eq('status', 'active')\n      .single();\n\n    if (existingError && existingError.code !== 'PGRST116') {\n      throw new Error('Error checking existing allocation');\n    }\n\n    if (existingAllocation) {\n      throw new Error('Patient already has an active bed allocation');\n    }\n\n    // Create allocation record with available columns\n    const allocationRecord = {\n      patient_id: allocationData.patientId,\n      bed_id: allocationData.bedId,\n      doctor_id: allocationData.doctorId || null,\n      admission_date: allocationData.admissionDate,\n      admission_type: allocationData.admissionType,\n      reason: allocationData.reason,\n      status: 'active',\n      daily_charges: 0,\n      total_charges: 0\n    };\n\n    const { data: allocation, error: allocationError } = await supabase\n      .from('bed_allocations')\n      .insert([allocationRecord])\n      .select(`\n        *,\n        patient:patients(name, patient_id),\n        bed:beds(id, bed_number, room_number, floor_number, bed_type),\n        doctor:doctors(license_number, user:users(name))\n      `)\n      .single();\n\n    if (allocationError) {\n      console.error('Error creating bed allocation:', allocationError);\n      throw new Error(`Failed to create bed allocation: ${allocationError.message}`);\n    }\n\n    // Update bed status to occupied\n    const { error: updateError } = await supabase\n      .from('beds')\n      .update({ status: 'occupied' })\n      .eq('id', allocationData.bedId);\n\n    if (updateError) {\n      console.error('Error updating bed status:', updateError);\n      // Rollback allocation if bed status update fails\n      await supabase\n        .from('bed_allocations')\n        .delete()\n        .eq('id', allocation.id);\n      throw new Error('Failed to update bed status');\n    }\n\n    return allocation;\n  } catch (error) {\n    console.error('Error allocating bed:', error);\n    throw error;\n  }\n}\n\n/**\n * Discharge patient from bed\n */\nexport async function dischargeBed(\n  allocationId: string,\n  dischargeData: {\n    dischargeDate: string;\n    dischargeTime: string;\n    dischargeSummary?: string;\n  }\n): Promise<BedAllocation> {\n  try {\n    // Get current allocation\n    const { data: allocation, error: allocationError } = await supabase\n      .from('bed_allocations')\n      .select('*, bed:beds(bed_id)')\n      .eq('allocation_id', allocationId)\n      .eq('status', 'active')\n      .single();\n\n    if (allocationError || !allocation) {\n      throw new Error('Active bed allocation not found');\n    }\n\n    // Update allocation with discharge information\n    const { data: updatedAllocation, error: updateError } = await supabase\n      .from('bed_allocations')\n      .update({\n        discharge_date: dischargeData.dischargeDate,\n        discharge_time: dischargeData.dischargeTime,\n        discharge_summary: dischargeData.dischargeSummary || null,\n        status: 'discharged'\n      })\n      .eq('allocation_id', allocationId)\n      .select(`\n        *,\n        patient:patients(id, patient_id, name, phone),\n        bed:beds(id, bed_id, bed_number, room_number, floor_number, ward_name, bed_type),\n        doctor:doctors(\n          id, \n          doctor_id, \n          specialization, \n          user:users(name, phone)\n        ),\n        allocated_by_user:users!allocated_by(id, name, role)\n      `)\n      .single();\n\n    if (updateError) {\n      console.error('Error updating bed allocation:', updateError);\n      throw new Error(`Failed to discharge patient: ${updateError.message}`);\n    }\n\n    // Update bed status to available\n    const { error: bedUpdateError } = await supabase\n      .from('beds')\n      .update({ status: 'available' })\n      .eq('bed_id', allocation.bed.bed_id);\n\n    if (bedUpdateError) {\n      console.error('Error updating bed status after discharge:', bedUpdateError);\n      // Note: Don't rollback discharge, just log the error\n    }\n\n    return updatedAllocation;\n  } catch (error) {\n    console.error('Error discharging patient:', error);\n    throw error;\n  }\n}\n\n/**\n * Transfer patient to another bed\n */\nexport async function transferBed(\n  allocationId: string,\n  newBedId: string,\n  reason: string\n): Promise<BedAllocation> {\n  try {\n    // Check if new bed is available\n    const { data: newBed, error: newBedError } = await supabase\n      .from('beds')\n      .select('*')\n      .eq('bed_id', newBedId)\n      .eq('status', 'available')\n      .single();\n\n    if (newBedError || !newBed) {\n      throw new Error('New bed is not available for transfer');\n    }\n\n    // Get current allocation\n    const { data: currentAllocation, error: currentError } = await supabase\n      .from('bed_allocations')\n      .select('*, bed:beds(bed_id)')\n      .eq('allocation_id', allocationId)\n      .eq('status', 'active')\n      .single();\n\n    if (currentError || !currentAllocation) {\n      throw new Error('Active bed allocation not found');\n    }\n\n    // Update current allocation to transferred\n    const { error: updateCurrentError } = await supabase\n      .from('bed_allocations')\n      .update({\n        status: 'transferred',\n        discharge_summary: `Transferred to bed ${newBedId}. Reason: ${reason}`\n      })\n      .eq('allocation_id', allocationId);\n\n    if (updateCurrentError) {\n      throw new Error('Failed to update current allocation');\n    }\n\n    // Create new allocation\n    const newAllocationId = await generateAllocationId();\n    const newAllocationRecord = {\n      allocation_id: newAllocationId,\n      patient_id: currentAllocation.patient_id,\n      bed_id: newBedId,\n      doctor_id: currentAllocation.doctor_id,\n      admission_date: new Date().toISOString().split('T')[0],\n      admission_time: new Date().toTimeString().split(' ')[0],\n      admission_type: 'transfer',\n      reason_for_admission: `Transfer from bed ${currentAllocation.bed.bed_id}. Reason: ${reason}`,\n      status: 'active',\n      allocated_by: currentAllocation.allocated_by\n    };\n\n    const { data: newAllocation, error: newAllocationError } = await supabase\n      .from('bed_allocations')\n      .insert([newAllocationRecord])\n      .select(`\n        *,\n        patient:patients(id, patient_id, name, phone),\n        bed:beds(id, bed_id, bed_number, room_number, floor_number, ward_name, bed_type),\n        doctor:doctors(\n          id, \n          doctor_id, \n          specialization, \n          user:users(name, phone)\n        ),\n        allocated_by_user:users!allocated_by(id, name, role)\n      `)\n      .single();\n\n    if (newAllocationError) {\n      throw new Error(`Failed to create new allocation: ${newAllocationError.message}`);\n    }\n\n    // Update bed statuses\n    await Promise.all([\n      supabase\n        .from('beds')\n        .update({ status: 'available' })\n        .eq('bed_id', currentAllocation.bed.bed_id),\n      supabase\n        .from('beds')\n        .update({ status: 'occupied' })\n        .eq('bed_id', newBedId)\n    ]);\n\n    return newAllocation;\n  } catch (error) {\n    console.error('Error transferring patient:', error);\n    throw error;\n  }\n}\n\n/**\n * Get all bed allocations with filtering\n */\nexport async function getBedAllocations(options: {\n  page?: number;\n  limit?: number;\n  patientId?: string;\n  doctorId?: string;\n  bedId?: string;\n  status?: string;\n  admissionType?: string;\n  dateRange?: { start: string; end: string };\n  searchTerm?: string;\n} = {}): Promise<{\n  allocations: BedAllocation[];\n  total: number;\n  page: number;\n  limit: number;\n}> {\n  try {\n    const { \n      page = 1, \n      limit = 20, \n      patientId, \n      doctorId, \n      bedId, \n      status, \n      admissionType,\n      dateRange,\n      searchTerm \n    } = options;\n    const offset = (page - 1) * limit;\n\n    let query = supabase\n      .from('bed_allocations')\n      .select(`\n        *,\n        patient:patients(name, patient_id),\n        bed:beds(id, bed_number, room_number, floor_number, bed_type),\n        doctor:doctors(license_number, user:users(name))\n      `, { count: 'exact' });\n\n    // Apply filters\n    if (patientId) query = query.eq('patient_id', patientId);\n    if (doctorId) query = query.eq('doctor_id', doctorId);\n    if (bedId) query = query.eq('bed_id', bedId);\n    if (status) query = query.eq('status', status);\n    if (admissionType) query = query.eq('admission_type', admissionType);\n    \n    if (dateRange) {\n      query = query.gte('admission_date', dateRange.start)\n                   .lte('admission_date', dateRange.end);\n    }\n\n    if (searchTerm) {\n      query = query.or(`\n        allocation_id.ilike.%${searchTerm}%,\n        reason_for_admission.ilike.%${searchTerm}%,\n        discharge_summary.ilike.%${searchTerm}%\n      `);\n    }\n\n    const { data: allocations, error, count } = await query\n      .range(offset, offset + limit - 1)\n      .order('admission_date', { ascending: false })\n      .order('admission_time', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching bed allocations:', error);\n      throw new Error(`Failed to fetch bed allocations: ${error.message}`);\n    }\n\n    return {\n      allocations: allocations || [],\n      total: count || 0,\n      page,\n      limit\n    };\n  } catch (error) {\n    console.error('Error fetching bed allocations:', error);\n    throw error;\n  }\n}\n\n/**\n * Get all beds with their current status\n */\nexport async function getAllBeds(options: {\n  page?: number;\n  limit?: number;\n  bedType?: string;\n  status?: string;\n  wardName?: string;\n  floorNumber?: number;\n  searchTerm?: string;\n} = {}): Promise<{\n  beds: Bed[];\n  total: number;\n  page: number;\n  limit: number;\n}> {\n  try {\n    const { \n      page = 1, \n      limit = 50, \n      bedType, \n      status, \n      wardName, \n      floorNumber,\n      searchTerm \n    } = options;\n    const offset = (page - 1) * limit;\n\n    let query = supabase\n      .from('beds')\n      .select(`\n        *,\n        current_allocation:bed_allocations!bed_id(\n          *,\n          patient:patients(id, patient_id, name, phone),\n          doctor:doctors(\n            id, \n            doctor_id, \n            specialization, \n            user:users(name)\n          )\n        )\n      `, { count: 'exact' });\n\n    // Apply filters\n    if (bedType) query = query.eq('bed_type', bedType);\n    if (status) query = query.eq('status', status);\n    if (wardName) query = query.eq('ward_name', wardName);\n    if (floorNumber) query = query.eq('floor_number', floorNumber);\n\n    if (searchTerm) {\n      query = query.or(`\n        bed_id.ilike.%${searchTerm}%,\n        bed_number.ilike.%${searchTerm}%,\n        room_number.ilike.%${searchTerm}%,\n        ward_name.ilike.%${searchTerm}%\n      `);\n    }\n\n    const { data: beds, error, count } = await query\n      .range(offset, offset + limit - 1)\n      .order('floor_number', { ascending: true })\n      .order('room_number', { ascending: true })\n      .order('bed_number', { ascending: true });\n\n    if (error) {\n      console.error('Error fetching beds:', error);\n      throw new Error(`Failed to fetch beds: ${error.message}`);\n    }\n\n    return {\n      beds: beds || [],\n      total: count || 0,\n      page,\n      limit\n    };\n  } catch (error) {\n    console.error('Error fetching beds:', error);\n    throw error;\n  }\n}\n\n/**\n * Get bed statistics\n */\nexport async function getBedStats(): Promise<BedStats> {\n  try {\n    const { data: beds, error } = await supabase\n      .from('beds')\n      .select('status');\n\n    if (error) {\n      console.error('Error fetching bed stats:', error);\n      throw new Error(`Failed to fetch bed stats: ${error.message}`);\n    }\n\n    const total = beds?.length || 0;\n    const available = beds?.filter(b => b.status === 'available').length || 0;\n    const occupied = beds?.filter(b => b.status === 'occupied').length || 0;\n    const maintenance = beds?.filter(b => b.status === 'maintenance').length || 0;\n    const reserved = beds?.filter(b => b.status === 'reserved').length || 0;\n    const occupancyRate = total > 0 ? (occupied / total) * 100 : 0;\n\n    return {\n      total,\n      available,\n      occupied,\n      maintenance,\n      reserved,\n      occupancyRate: Math.round(occupancyRate * 10) / 10\n    };\n  } catch (error) {\n    console.error('Error getting bed stats:', error);\n    throw error;\n  }\n}\n\n/**\n * Get available beds by type\n */\nexport async function getAvailableBeds(\n  bedType?: string,\n  wardName?: string,\n  floorNumber?: number\n): Promise<Bed[]> {\n  try {\n    let query = supabase\n      .from('beds')\n      .select('*')\n      .eq('status', 'available');\n\n    if (bedType) query = query.eq('bed_type', bedType);\n    if (wardName) query = query.eq('ward_name', wardName);\n    if (floorNumber) query = query.eq('floor_number', floorNumber);\n\n    const { data: beds, error } = await query\n      .order('floor_number', { ascending: true })\n      .order('room_number', { ascending: true })\n      .order('bed_number', { ascending: true });\n\n    if (error) {\n      console.error('Error fetching available beds:', error);\n      throw new Error(`Failed to fetch available beds: ${error.message}`);\n    }\n\n    return beds || [];\n  } catch (error) {\n    console.error('Error fetching available beds:', error);\n    throw error;\n  }\n}\n\n/**\n * Get patient bed allocation history\n */\nexport async function getPatientBedHistory(patientId: string): Promise<BedAllocation[]> {\n  try {\n    const { data: allocations, error } = await supabase\n      .from('bed_allocations')\n      .select(`\n        *,\n        bed:beds(id, bed_number, room_number, floor_number, bed_type),\n        doctor:doctors(license_number, user:users(name))\n      `)\n      .eq('patient_id', patientId)\n      .order('admission_date', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patient bed history:', error);\n      throw new Error(`Failed to fetch patient bed history: ${error.message}`);\n    }\n\n    return allocations || [];\n  } catch (error) {\n    console.error('Error fetching patient bed history:', error);\n    throw error;\n  }\n}\n\n/**\n * Update bed status\n */\nexport async function updateBedStatus(\n  bedId: string,\n  status: 'available' | 'occupied' | 'maintenance' | 'reserved'\n): Promise<Bed> {\n  try {\n    const { data: bed, error } = await supabase\n      .from('beds')\n      .update({ status })\n      .eq('bed_id', bedId)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating bed status:', error);\n      throw new Error(`Failed to update bed status: ${error.message}`);\n    }\n\n    return bed;\n  } catch (error) {\n    console.error('Error updating bed status:', error);\n    throw error;\n  }\n}\n\n/**\n * Get bed allocation by ID\n */\nexport async function getBedAllocationById(allocationId: string): Promise<BedAllocation> {\n  try {\n    const { data: allocation, error } = await supabase\n      .from('bed_allocations')\n      .select(`\n        *,\n        patient:patients(name, patient_id),\n        bed:beds(id, bed_number, room_number, floor_number, bed_type),\n        doctor:doctors(license_number, user:users(name))\n      `)\n      .eq('id', allocationId)\n      .single();\n\n    if (error) {\n      console.error('Error fetching bed allocation:', error);\n      throw new Error(`Bed allocation not found: ${error.message}`);\n    }\n\n    return allocation;\n  } catch (error) {\n    console.error('Error fetching bed allocation:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/AdmissionModal.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useEffect } from 'react';\nimport { X, Bed, Building, User, Calendar, Clock, AlertCircle, CheckCircle } from 'lucide-react';\nimport { supabase } from '../lib/supabase';\nimport { allocateBed } from '../lib/bedAllocationService';\n\ninterface AdmissionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  patient: {\n    id: string;\n    patient_id: string;\n    name: string;\n    phone: string;\n    primary_complaint?: string;\n  };\n  onSuccess: () => void;\n}\n\ninterface Bed {\n  id: string;\n  bed_number: string;\n  room_number: string;\n  bed_type: string;\n  status: string;\n  floor_number: number;\n  department_id?: string;\n  department?: {\n    name: string;\n  };\n}\n\ninterface Doctor {\n  id: string;\n  license_number: string;\n  specialization: string;\n  user: {\n    name: string;\n  };\n}\n\nexport default function AdmissionModal({ isOpen, onClose, patient, onSuccess }: AdmissionModalProps) {\n  const [availableBeds, setAvailableBeds] = useState<Bed[]>([]);\n  const [filteredBeds, setFilteredBeds] = useState<Bed[]>([]);\n  const [selectedWard, setSelectedWard] = useState<string>('all');\n  const [wards, setWards] = useState<string[]>([]);\n  const [doctors, setDoctors] = useState<Doctor[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  const [formData, setFormData] = useState({\n    bedId: '',\n    doctorId: '',\n    admissionType: 'scheduled' as 'emergency' | 'scheduled' | 'transfer',\n    reason: '',\n    admissionDate: new Date().toISOString().split('T')[0],\n  });\n\n  const [selectedBed, setSelectedBed] = useState<Bed | null>(null);\n  const [selectedDoctor, setSelectedDoctor] = useState<Doctor | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchAvailableBeds();\n      fetchDoctors();\n      setError(null);\n      setSuccess(false);\n    }\n  }, [isOpen]);\n\n  const fetchAvailableBeds = async () => {\n    try {\n      setLoading(true);\n      const { data: beds, error } = await supabase\n        .from('beds')\n        .select(`\n          *,\n          department:departments(name)\n        `)\n        .eq('status', 'available')\n        .order('bed_number');\n\n      if (error) throw error;\n      \n      const bedsWithDepartment = beds?.map(bed => ({\n        ...bed,\n        department: Array.isArray(bed.department) ? bed.department[0] : bed.department\n      })) || [];\n      \n      setAvailableBeds(bedsWithDepartment);\n      \n      // Extract unique ward names\n      const uniqueWards = [...new Set(bedsWithDepartment\n        .map(bed => bed.department?.name)\n        .filter(Boolean)\n      )] as string[];\n      setWards(uniqueWards);\n      \n      // Initially show all beds\n      setFilteredBeds(bedsWithDepartment);\n    } catch (err) {\n      console.error('Error fetching beds:', err);\n      setError('Failed to load available beds');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchDoctors = async () => {\n    try {\n      const { data: doctors, error } = await supabase\n        .from('doctors')\n        .select(`\n          id,\n          license_number,\n          specialization,\n          user:users!inner(name)\n        `)\n        .eq('status', 'active')\n        .order('specialization');\n\n      if (error) throw error;\n      \n      // Transform the data to match our interface\n      const transformedDoctors = doctors?.map(doctor => ({\n        ...doctor,\n        user: Array.isArray(doctor.user) ? doctor.user[0] : doctor.user\n      })) || [];\n      \n      setDoctors(transformedDoctors);\n    } catch (err) {\n      console.error('Error fetching doctors:', err);\n      setError('Failed to load doctors');\n    }\n  };\n\n  const handleWardFilter = (wardName: string) => {\n    setSelectedWard(wardName);\n    if (wardName === 'all' || wardName === '') {\n      setFilteredBeds(availableBeds);\n    } else {\n      const filtered = availableBeds.filter(bed => bed.department?.name === wardName);\n      setFilteredBeds(filtered);\n    }\n    // Reset bed selection when changing ward\n    setFormData(prev => ({ ...prev, bedId: '' }));\n    setSelectedBed(null);\n  };\n\n  const handleBedSelect = (bed: Bed) => {\n    setSelectedBed(bed);\n    setFormData(prev => ({ ...prev, bedId: bed.id }));\n  };\n\n  const handleDoctorSelect = (doctor: Doctor) => {\n    setSelectedDoctor(doctor);\n    setFormData(prev => ({ ...prev, doctorId: doctor.license_number }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.bedId) {\n      setError('Please select a bed');\n      return;\n    }\n\n    try {\n      setSubmitting(true);\n      setError(null);\n\n      const allocationData = {\n        patientId: patient.id,\n        bedId: formData.bedId,\n        doctorId: formData.doctorId || undefined,\n        admissionDate: formData.admissionDate,\n        admissionType: formData.admissionType || 'general',\n        reason: formData.reason || '',\n      };\n\n      await allocateBed(allocationData);\n      \n      setSuccess(true);\n      setTimeout(() => {\n        onSuccess();\n        onClose();\n        resetForm();\n      }, 2000);\n\n    } catch (err: any) {\n      console.error('Error admitting patient:', err);\n      setError(err.message || 'Failed to admit patient');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      bedId: '',\n      doctorId: '',\n      admissionType: 'scheduled' as 'emergency' | 'scheduled' | 'transfer',\n      reason: '',\n      admissionDate: new Date().toISOString().split('T')[0],\n    });\n    setSelectedBed(null);\n    setSelectedDoctor(null);\n    setError(null);\n    setSuccess(false);\n  };\n\n  const handleClose = () => {\n    if (!submitting) {\n      resetForm();\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  // Group filtered beds by floor\n  const bedsByFloor = filteredBeds.reduce((acc, bed) => {\n    const floor = `Floor ${bed.floor_number}`;\n    if (!acc[floor]) acc[floor] = [];\n    acc[floor].push(bed);\n    return acc;\n  }, {} as Record<string, Bed[]>);\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-2xl font-bold\">Patient Admission</h2>\n              <p className=\"text-orange-100 mt-1\">\n                Admit {patient.name} ({patient.patient_id})\n              </p>\n            </div>\n            <button\n              onClick={handleClose}\n              disabled={submitting}\n              className=\"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors disabled:opacity-50\"\n            >\n              <X size={24} />\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-120px)]\">\n          {success ? (\n            <div className=\"text-center py-8\">\n              <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-4\" />\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                Patient Admitted Successfully!\n              </h3>\n              <p className=\"text-gray-600\">\n                {patient.name} has been admitted to Floor {selectedBed?.floor_number} - Bed {selectedBed?.bed_number}\n              </p>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {error && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center\">\n                  <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" />\n                  <span className=\"text-red-700\">{error}</span>\n                </div>\n              )}\n\n              {/* Patient Info */}\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <h3 className=\"font-semibold text-gray-900 mb-2\">Patient Information</h3>\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-gray-600\">Name:</span>\n                    <span className=\"ml-2 font-medium\">{patient.name}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-600\">ID:</span>\n                    <span className=\"ml-2 font-medium\">{patient.patient_id}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-600\">Phone:</span>\n                    <span className=\"ml-2 font-medium\">{patient.phone}</span>\n                  </div>\n                  {patient.primary_complaint && (\n                    <div>\n                      <span className=\"text-gray-600\">Complaint:</span>\n                      <span className=\"ml-2 font-medium\">{patient.primary_complaint}</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Admission Details */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Admission Date *\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.admissionDate}\n                    onChange={(e) => setFormData(prev => ({ ...prev, admissionDate: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                    required\n                  />\n                </div>\n              </div>\n\n              {/* Admission Type */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Admission Type *\n                </label>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {[\n                    { value: 'emergency', label: 'Emergency', color: 'red' },\n                    { value: 'scheduled', label: 'Scheduled', color: 'blue' },\n                    { value: 'transfer', label: 'Transfer', color: 'yellow' }\n                  ].map((type) => (\n                    <label key={type.value} className=\"flex items-center cursor-pointer\">\n                      <input\n                        type=\"radio\"\n                        name=\"admissionType\"\n                        value={type.value}\n                        checked={formData.admissionType === type.value}\n                        onChange={(e) => setFormData(prev => ({ ...prev, admissionType: e.target.value as any }))}\n                        className=\"sr-only\"\n                      />\n                      <div className={`w-full p-3 rounded-lg border-2 text-center text-sm font-medium transition-all ${\n                        formData.admissionType === type.value\n                          ? `border-${type.color}-500 bg-${type.color}-50 text-${type.color}-700`\n                          : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n                      }`}>\n                        {type.label}\n                      </div>\n                    </label>\n                  ))}\n                </div>\n              </div>\n\n              {/* Doctor Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Attending Doctor *\n                </label>\n                {loading ? (\n                  <div className=\"animate-pulse bg-gray-200 h-12 rounded-lg\"></div>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2\">\n                    {doctors.map((doctor) => (\n                      <label key={doctor.id} className=\"flex items-center cursor-pointer\">\n                        <input\n                          type=\"radio\"\n                          name=\"doctor\"\n                          value={doctor.license_number}\n                          checked={formData.doctorId === doctor.license_number}\n                          onChange={() => handleDoctorSelect(doctor)}\n                          className=\"sr-only\"\n                        />\n                        <div className={`w-full p-3 rounded-lg border text-sm transition-all ${\n                          formData.doctorId === doctor.license_number\n                            ? 'border-orange-500 bg-orange-50 text-orange-700'\n                            : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'\n                        }`}>\n                          <div className=\"font-medium\">{doctor.user.name}</div>\n                          <div className=\"text-xs text-gray-500\">{doctor.specialization}</div>\n                        </div>\n                      </label>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Bed Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Select Bed *\n                </label>\n                \n                {/* Ward Filter */}\n                <div className=\"mb-3\">\n                  <div className=\"flex flex-wrap gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => handleWardFilter('all')}\n                      className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n                        selectedWard === 'all' || selectedWard === ''\n                          ? 'bg-orange-500 text-white shadow-sm'\n                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                      }`}\n                    >\n                      All Wards ({availableBeds.length})\n                    </button>\n                    {wards.map((ward) => {\n                      const wardBedCount = availableBeds.filter(bed => bed.department?.name === ward).length;\n                      return (\n                        <button\n                          key={ward}\n                          type=\"button\"\n                          onClick={() => handleWardFilter(ward)}\n                          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n                            selectedWard === ward\n                              ? 'bg-orange-500 text-white shadow-sm'\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                          }`}\n                        >\n                          {ward} ({wardBedCount})\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n\n                {loading ? (\n                  <div className=\"animate-pulse bg-gray-200 h-32 rounded-lg\"></div>\n                ) : filteredBeds.length === 0 ? (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <Bed className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                    <p>No beds available in {selectedWard || 'any ward'}</p>\n                  </div>\n                ) : (\n                  <div className=\"max-h-64 overflow-y-auto border border-gray-200 rounded-lg\">\n                    {Object.keys(bedsByFloor).length === 0 ? (\n                      <div className=\"text-center py-8 text-gray-500\">\n                        <Bed className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                        <p>No beds available on any floor</p>\n                      </div>\n                    ) : (\n                      Object.entries(bedsByFloor).map(([floor, beds]) => (\n                        <div key={floor} className=\"border-b border-gray-100 last:border-b-0\">\n                          <div className=\"bg-gray-50 px-4 py-2 font-medium text-gray-700 text-sm flex items-center justify-between\">\n                            <span>{floor}</span>\n                            <span className=\"text-xs bg-gray-200 px-2 py-1 rounded-full\">\n                              {(beds as Bed[]).length} bed{(beds as Bed[]).length !== 1 ? 's' : ''}\n                            </span>\n                          </div>\n                          <div className=\"p-2 grid grid-cols-4 md:grid-cols-6 gap-2\">\n                            {(beds as Bed[]).map((bed) => (\n                              <label key={bed.id} className=\"flex items-center cursor-pointer group\">\n                                <input\n                                  type=\"radio\"\n                                  name=\"bedId\"\n                                  value={bed.id}\n                                  checked={formData.bedId === bed.id}\n                                  onChange={() => handleBedSelect(bed)}\n                                  className=\"sr-only\"\n                                />\n                                <div className={`w-full p-2 rounded-lg border-2 text-center text-sm transition-all group-hover:shadow-sm ${\n                                  formData.bedId === bed.id\n                                    ? 'border-orange-500 bg-orange-50 text-orange-700 shadow-sm'\n                                    : 'border-gray-200 bg-white text-gray-700 hover:border-orange-300 hover:bg-orange-25'\n                                }`}>\n                                  <div className=\"font-medium text-xs\">Bed {bed.bed_number}</div>\n                                  {bed.department?.name && (\n                                    <div className=\"text-xs text-gray-400 mt-1 truncate\">\n                                      {bed.department.name}\n                                    </div>\n                                  )}\n                                </div>\n                              </label>\n                            ))}\n                          </div>\n                        </div>\n                      ))\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Reason for Admission */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Reason for Admission *\n                </label>\n                <textarea\n                  value={formData.reason}\n                  onChange={(e) => setFormData(prev => ({ ...prev, reason: e.target.value }))}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500\"\n                  placeholder=\"Enter the reason for admission...\"\n                  required\n                />\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex gap-3 pt-4 border-t\">\n                <button\n                  type=\"button\"\n                  onClick={handleClose}\n                  disabled={submitting}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={submitting || loading}\n                  className=\"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 flex items-center justify-center\"\n                >\n                  {submitting ? (\n                    <>\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                      Admitting...\n                    </>\n                  ) : (\n                    'Admit Patient'\n                  )}\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1458, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/services/billingService.ts"],"sourcesContent":["import { supabase } from '../lib/supabase';\n\nexport interface FeeCategory {\n  id: string;\n  name: string;\n  description?: string;\n  is_active: boolean;\n}\n\nexport interface FeeRate {\n  id: string;\n  category_id: string;\n  service_name: string;\n  rate_per_unit: number;\n  unit_type: 'per_service' | 'per_day' | 'per_hour' | 'per_item';\n  description?: string;\n  is_active: boolean;\n  category?: FeeCategory;\n}\n\nexport interface PatientAdmission {\n  id: string;\n  patient_id: string;\n  bed_allocation_id?: string;\n  admission_date: string;\n  discharge_date?: string;\n  status: 'active' | 'discharged' | 'transferred';\n  admission_type: 'emergency' | 'elective' | 'transfer';\n  primary_diagnosis?: string;\n  secondary_diagnosis?: string;\n  treatment_summary?: string;\n  discharge_notes?: string;\n  total_stay_days?: number;\n  room_charges: number;\n  total_bill_amount: number;\n}\n\nexport interface BillingItem {\n  id?: string;\n  patient_admission_id: string;\n  billing_summary_id?: string;\n  fee_rate_id?: string;\n  service_name: string;\n  quantity: number;\n  unit_rate: number;\n  total_amount?: number;\n  service_date: string;\n  notes?: string;\n}\n\nexport interface BillingSummary {\n  id?: string;\n  patient_admission_id: string;\n  bill_number: string;\n  bill_date: string;\n  subtotal: number;\n  tax_percentage: number;\n  tax_amount?: number;\n  discount_percentage: number;\n  discount_amount?: number;\n  total_amount?: number;\n  payment_status: 'pending' | 'partial' | 'paid' | 'cancelled';\n  payment_method?: 'cash' | 'card' | 'upi' | 'insurance' | 'cheque';\n  payment_date?: string;\n  notes?: string;\n}\n\nexport class BillingService {\n  \n  /**\n   * Get all active fee categories\n   */\n  static async getFeeCategories(): Promise<FeeCategory[]> {\n    const { data, error } = await supabase\n      .from('fee_categories')\n      .select('*')\n      .eq('is_active', true)\n      .order('name');\n\n    if (error) {\n      console.error('Error fetching fee categories:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Get fee rates by category\n   */\n  static async getFeeRatesByCategory(categoryId: string): Promise<FeeRate[]> {\n    const { data, error } = await supabase\n      .from('fee_rates')\n      .select(`\n        *,\n        category:fee_categories(*)\n      `)\n      .eq('category_id', categoryId)\n      .eq('is_active', true)\n      .order('service_name');\n\n    if (error) {\n      console.error('Error fetching fee rates:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Get all active fee rates with categories\n   */\n  static async getAllFeeRates(): Promise<FeeRate[]> {\n    const { data, error } = await supabase\n      .from('fee_rates')\n      .select(`\n        *,\n        category:fee_categories(*)\n      `)\n      .eq('is_active', true)\n      .order('service_name');\n\n    if (error) {\n      console.error('Error fetching all fee rates:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Calculate room charges based on bed type and stay duration\n   */\n  static async calculateRoomCharges(\n    bedId: string, \n    admissionDate: string, \n    dischargeDate: string\n  ): Promise<{ days: number; dailyRate: number; totalCharges: number; bedType: string }> {\n    try {\n      // Get bed information\n      const { data: bedData, error: bedError } = await supabase\n        .from('beds')\n        .select('bed_number, room_number, department_ward')\n        .eq('id', bedId)\n        .single();\n\n      if (bedError) throw bedError;\n\n      // Calculate stay duration\n      const admission = new Date(admissionDate);\n      const discharge = new Date(dischargeDate);\n      const diffTime = Math.abs(discharge.getTime() - admission.getTime());\n      const diffDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\n\n      // Determine bed type and get rate\n      let bedType = 'General Ward Bed';\n      let dailyRate = 800; // Default rate\n\n      if (bedData.department_ward?.toLowerCase().includes('icu')) {\n        bedType = 'ICU Bed';\n        dailyRate = 5000;\n      } else if (bedData.department_ward?.toLowerCase().includes('emergency')) {\n        bedType = 'Emergency Bed';\n        dailyRate = 1200;\n      } else if (bedData.room_number && !bedData.room_number.includes('Ward')) {\n        bedType = 'Private Room';\n        dailyRate = 2000;\n      }\n\n      // Try to get actual rate from fee_rates table\n      const { data: rateData } = await supabase\n        .from('fee_rates')\n        .select('rate_per_unit')\n        .eq('service_name', bedType)\n        .eq('is_active', true)\n        .single();\n\n      if (rateData) {\n        dailyRate = rateData.rate_per_unit;\n      }\n\n      const totalCharges = diffDays * dailyRate;\n\n      return {\n        days: diffDays,\n        dailyRate,\n        totalCharges,\n        bedType\n      };\n    } catch (error) {\n      console.error('Error calculating room charges:', error);\n      // Return default values if calculation fails\n      return {\n        days: 1,\n        dailyRate: 800,\n        totalCharges: 800,\n        bedType: 'General Ward Bed'\n      };\n    }\n  }\n\n  /**\n   * Create a patient admission record\n   */\n  static async createPatientAdmission(admission: Omit<PatientAdmission, 'id'>): Promise<PatientAdmission> {\n    const { data, error } = await supabase\n      .from('patient_admissions')\n      .insert(admission)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating patient admission:', error);\n      throw error;\n    }\n\n    return data;\n  }\n\n  /**\n   * Update patient admission (for discharge)\n   */\n  static async updatePatientAdmission(\n    admissionId: string, \n    updates: Partial<PatientAdmission>\n  ): Promise<PatientAdmission> {\n    const { data, error } = await supabase\n      .from('patient_admissions')\n      .update(updates)\n      .eq('id', admissionId)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating patient admission:', error);\n      throw error;\n    }\n\n    return data;\n  }\n\n  /**\n   * Get patient admission by bed allocation\n   */\n  static async getPatientAdmissionByBedAllocation(bedAllocationId: string): Promise<PatientAdmission | null> {\n    const { data, error } = await supabase\n      .from('patient_admissions')\n      .select('*')\n      .eq('bed_allocation_id', bedAllocationId)\n      .eq('status', 'active')\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return null; // No record found\n      }\n      console.error('Error fetching patient admission:', error);\n      throw error;\n    }\n\n    return data;\n  }\n\n  /**\n   * Generate unique bill number\n   */\n  static generateBillNumber(): string {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0');\n    const day = String(now.getDate()).padStart(2, '0');\n    const time = String(now.getTime()).slice(-6);\n    \n    return `BILL-${year}${month}${day}-${time}`;\n  }\n\n  /**\n   * Create billing summary\n   */\n  static async createBillingSummary(summary: Omit<BillingSummary, 'id'>): Promise<BillingSummary> {\n    const { data, error } = await supabase\n      .from('billing_summary')\n      .insert(summary)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating billing summary:', error);\n      throw error;\n    }\n\n    return data;\n  }\n\n  /**\n   * Create billing items\n   */\n  static async createBillingItems(items: BillingItem[]): Promise<BillingItem[]> {\n    const { data, error } = await supabase\n      .from('billing_items')\n      .insert(items)\n      .select();\n\n    if (error) {\n      console.error('Error creating billing items:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Calculate bill totals\n   */\n  static calculateBillTotals(\n    items: BillingItem[], \n    taxPercentage: number = 0, \n    discountPercentage: number = 0\n  ) {\n    const subtotal = items.reduce((sum, item) => sum + (item.quantity * item.unit_rate), 0);\n    const taxAmount = (subtotal * taxPercentage) / 100;\n    const discountAmount = (subtotal * discountPercentage) / 100;\n    const totalAmount = subtotal + taxAmount - discountAmount;\n\n    return {\n      subtotal: Math.round(subtotal * 100) / 100,\n      taxAmount: Math.round(taxAmount * 100) / 100,\n      discountAmount: Math.round(discountAmount * 100) / 100,\n      totalAmount: Math.round(totalAmount * 100) / 100\n    };\n  }\n\n  /**\n   * Get patient admission history\n   */\n  static async getPatientAdmissionHistory(patientId: string): Promise<PatientAdmission[]> {\n    const { data, error } = await supabase\n      .from('patient_admissions')\n      .select('*')\n      .eq('patient_id', patientId)\n      .order('admission_date', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patient admission history:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Get billing history for a patient\n   */\n  static async getPatientBillingHistory(patientId: string) {\n    const { data, error } = await supabase\n      .from('billing_summary_detailed')\n      .select('*')\n      .eq('patient_id', patientId)\n      .order('bill_date', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching patient billing history:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Get detailed billing items for an admission\n   */\n  static async getBillingItemsForAdmission(admissionId: string): Promise<BillingItem[]> {\n    const { data, error } = await supabase\n      .from('billing_items')\n      .select('*')\n      .eq('patient_admission_id', admissionId)\n      .order('service_date', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching billing items:', error);\n      throw error;\n    }\n\n    return data || [];\n  }\n\n  /**\n   * Process complete discharge with billing\n   */\n  static async processDischarge(\n    bedAllocationId: string,\n    dischargeDate: string,\n    dischargeNotes: string,\n    additionalServices: BillingItem[] = [],\n    taxPercentage: number = 0,\n    discountPercentage: number = 0\n  ) {\n    try {\n      // Get bed allocation details\n      const { data: bedAllocation, error: bedError } = await supabase\n        .from('bed_allocations')\n        .select(`\n          *,\n          patient:patients(*),\n          bed:beds(*)\n        `)\n        .eq('id', bedAllocationId)\n        .single();\n\n      if (bedError) throw bedError;\n\n      // Get or create patient admission record\n      let patientAdmission = await this.getPatientAdmissionByBedAllocation(bedAllocationId);\n      \n      if (!patientAdmission) {\n        // Create admission record if it doesn't exist\n        patientAdmission = await this.createPatientAdmission({\n          patient_id: bedAllocation.patient_id,\n          bed_allocation_id: bedAllocationId,\n          admission_date: bedAllocation.admission_date,\n          status: 'active',\n          admission_type: bedAllocation.admission_type || 'elective',\n          room_charges: 0,\n          total_bill_amount: 0\n        });\n      }\n\n      // Calculate room charges\n      const roomCharges = await this.calculateRoomCharges(\n        bedAllocation.bed_id,\n        bedAllocation.admission_date,\n        dischargeDate\n      );\n\n      // Prepare billing items\n      const billingItems: BillingItem[] = [\n        {\n          patient_admission_id: patientAdmission.id,\n          service_name: roomCharges.bedType,\n          quantity: roomCharges.days,\n          unit_rate: roomCharges.dailyRate,\n          service_date: new Date().toISOString().split('T')[0],\n          notes: `Room charges for ${roomCharges.days} days`\n        },\n        ...additionalServices.map(service => ({\n          ...service,\n          patient_admission_id: patientAdmission.id\n        }))\n      ];\n\n      // Calculate totals\n      const totals = this.calculateBillTotals(billingItems, taxPercentage, discountPercentage);\n\n      // Create billing summary\n      const billingSummary = await this.createBillingSummary({\n        patient_admission_id: patientAdmission.id,\n        bill_number: this.generateBillNumber(),\n        bill_date: new Date().toISOString(),\n        subtotal: totals.subtotal,\n        tax_percentage: taxPercentage,\n        discount_percentage: discountPercentage,\n        payment_status: 'pending',\n        notes: dischargeNotes\n      });\n\n      // Create billing items\n      const createdItems = await this.createBillingItems(\n        billingItems.map(item => ({\n          ...item,\n          billing_summary_id: billingSummary.id\n        }))\n      );\n\n      // Update patient admission\n      const updatedAdmission = await this.updatePatientAdmission(patientAdmission.id, {\n        discharge_date: dischargeDate,\n        status: 'discharged',\n        discharge_notes: dischargeNotes,\n        room_charges: roomCharges.totalCharges,\n        total_bill_amount: totals.totalAmount\n      });\n\n      // Update bed allocation\n      const { error: updateError } = await supabase\n        .from('bed_allocations')\n        .update({ \n          discharge_date: dischargeDate,\n          status: 'discharged'\n        })\n        .eq('id', bedAllocationId);\n\n      if (updateError) throw updateError;\n\n      // Update bed status\n      const { error: bedUpdateError } = await supabase\n        .from('beds')\n        .update({ status: 'available' })\n        .eq('id', bedAllocation.bed_id);\n\n      if (bedUpdateError) throw bedUpdateError;\n\n      return {\n        admission: updatedAdmission,\n        billing: billingSummary,\n        items: createdItems,\n        roomCharges,\n        totals\n      };\n\n    } catch (error) {\n      console.error('Error processing discharge:', error);\n      throw error;\n    }\n  }\n}\n\nexport default BillingService;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1764, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/src/components/DischargeModal.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useEffect } from 'react';\nimport { X, Calculator, FileText, Clock, Bed, Plus, Trash2, Save, AlertCircle, User, Calendar } from 'lucide-react';\nimport { supabase } from '../lib/supabase';\nimport BillingService from '../services/billingService';\n\ninterface Patient {\n  id: string;\n  patient_id: string;\n  name: string;\n  phone: string;\n  bed_id?: string | null;\n  admission_date?: string | null;\n  department_ward?: string;\n  room_number?: string;\n  bed_allocation_id?: string | null;\n}\n\ninterface LocalBillingItem {\n  id: string;\n  category: string;\n  service_name: string;\n  quantity: number;\n  unit_rate: number;\n  total_amount: number;\n  service_date: string;\n  notes?: string;\n}\n\ninterface LocalFeeCategory {\n  id: string;\n  name: string;\n  description: string;\n}\n\ninterface LocalFeeRate {\n  id: string;\n  category_id: string;\n  service_name: string;\n  rate_per_unit: number;\n  unit_type: string;\n}\n\ninterface DischargeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  patient: any;\n  onDischargeSuccess: () => void;\n}\n\ninterface AdditionalService {\n  service_name: string;\n  quantity: number;\n  unit_rate: number;\n  fee_rate_id?: string;\n  notes?: string;\n}\n\nconst DischargeModal: React.FC<DischargeModalProps> = ({\n  isOpen,\n  onClose,\n  patient,\n  onDischargeSuccess\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [dischargeDate, setDischargeDate] = useState(new Date().toISOString().slice(0, 16));\n  const [dischargeNotes, setDischargeNotes] = useState('');\n  const [roomCharges, setRoomCharges] = useState({\n    days: 0,\n    dailyRate: 0,\n    totalCharges: 0,\n    bedType: ''\n  });\n  const [additionalServices, setAdditionalServices] = useState<AdditionalService[]>([]);\n  const [feeCategories, setFeeCategories] = useState<LocalFeeCategory[]>([]);\n  const [feeRates, setFeeRates] = useState<LocalFeeRate[]>([]);\n  const [taxPercentage, setTaxPercentage] = useState(0);\n  const [discountPercentage, setDiscountPercentage] = useState(0);\n  const [billTotals, setBillTotals] = useState({\n    subtotal: 0,\n    taxAmount: 0,\n    discountAmount: 0,\n    totalAmount: 0\n  });\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      loadFeeData();\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (isOpen && patient) {\n      calculateBilling();\n    }\n  }, [isOpen, patient, dischargeDate, additionalServices, taxPercentage, discountPercentage]);\n\n  const loadFeeData = async () => {\n    try {\n      const [categories, rates] = await Promise.all([\n        BillingService.getFeeCategories(),\n        BillingService.getAllFeeRates()\n      ]);\n      \n      // Convert to local format for compatibility\n      setFeeCategories(categories.map(cat => ({\n        id: cat.id,\n        name: cat.name,\n        description: cat.description || ''\n      })));\n      \n      setFeeRates(rates.map(rate => ({\n        id: rate.id,\n        category_id: rate.category_id,\n        service_name: rate.service_name,\n        rate_per_unit: rate.rate_per_unit,\n        unit_type: rate.unit_type\n      })));\n    } catch (error) {\n      console.error('Error loading fee data:', error);\n      setError('Failed to load fee data');\n    }\n  };\n\n  const calculateBilling = async () => {\n    if (!patient?.bed_allocation) return;\n\n    try {\n      // Calculate room charges using BillingService\n      const charges = await BillingService.calculateRoomCharges(\n        patient.bed_allocation.bed_id,\n        patient.bed_allocation.admission_date,\n        dischargeDate\n      );\n      \n      setRoomCharges(charges);\n\n      // Prepare all billing items for calculation\n      const allItems = [\n        {\n          patient_admission_id: '',\n          service_name: charges.bedType,\n          quantity: charges.days,\n          unit_rate: charges.dailyRate,\n          service_date: new Date().toISOString().split('T')[0],\n          notes: `Room charges for ${charges.days} days`\n        },\n        ...additionalServices.map(service => ({\n          patient_admission_id: '',\n          service_name: service.service_name,\n          quantity: service.quantity,\n          unit_rate: service.unit_rate,\n          fee_rate_id: service.fee_rate_id,\n          service_date: new Date().toISOString().split('T')[0],\n          notes: service.notes\n        }))\n      ];\n\n      // Calculate totals using BillingService\n      const totals = BillingService.calculateBillTotals(allItems, taxPercentage, discountPercentage);\n      setBillTotals(totals);\n\n    } catch (error) {\n      console.error('Error calculating billing:', error);\n      setError('Failed to calculate billing');\n    }\n  };\n\n  const addAdditionalService = () => {\n    const newService: AdditionalService = {\n      service_name: '',\n      quantity: 1,\n      unit_rate: 0,\n      notes: ''\n    };\n    setAdditionalServices([...additionalServices, newService]);\n  };\n\n  const updateAdditionalService = (index: number, field: keyof AdditionalService, value: any) => {\n    setAdditionalServices(services => \n      services.map((service, i) => \n        i === index ? { ...service, [field]: value } : service\n      )\n    );\n  };\n\n  const removeAdditionalService = (index: number) => {\n    setAdditionalServices(services => services.filter((_, i) => i !== index));\n  };\n\n  const handleServiceSelection = (index: number, serviceId: string) => {\n    const selectedRate = feeRates.find(rate => rate.id === serviceId);\n    if (selectedRate) {\n      updateAdditionalService(index, 'service_name', selectedRate.service_name);\n      updateAdditionalService(index, 'unit_rate', selectedRate.rate_per_unit);\n      updateAdditionalService(index, 'fee_rate_id', selectedRate.id);\n    }\n  };\n\n  const handleDischarge = async () => {\n    if (!patient.bed_id) {\n      setError('Patient is not currently admitted');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const dischargeDateTime = new Date(dischargeDate);\n      const { totalAmount } = billTotals;\n\n      // First, get the bed allocation ID for this patient\n      const { data: bedAllocation, error: allocationError } = await supabase\n        .from('bed_allocations')\n        .select('id')\n        .eq('patient_id', patient.id)\n        .eq('bed_id', patient.bed_id)\n        .is('discharge_date', null)\n        .single();\n\n      if (allocationError || !bedAllocation) {\n        throw new Error('Could not find active bed allocation for patient');\n      }\n\n      // Update bed allocation with discharge date\n      const { error: bedError } = await supabase\n        .from('bed_allocations')\n        .update({\n          discharge_date: dischargeDateTime.toISOString(),\n          status: 'discharged',\n          total_charges: totalAmount,\n          updated_at: new Date().toISOString()\n        })\n        .eq('patient_id', patient.id)\n        .eq('bed_id', patient.bed_id)\n        .is('discharge_date', null);\n\n      if (bedError) throw bedError;\n\n      // Use BillingService to handle discharge\n       const additionalBillingItems = additionalServices.map(service => ({\n         patient_admission_id: '',\n         service_name: service.service_name,\n         quantity: service.quantity,\n         unit_rate: service.unit_rate,\n         fee_rate_id: service.fee_rate_id,\n         service_date: new Date().toISOString().split('T')[0],\n         notes: service.notes\n       }));\n\n       await BillingService.processDischarge(\n         bedAllocation.id,\n         dischargeDateTime.toISOString(),\n         dischargeNotes,\n         additionalBillingItems,\n         taxPercentage,\n         discountPercentage\n       );\n\n      // Update bed status to available\n      const { error: bedStatusError } = await supabase\n        .from('beds')\n        .update({ status: 'available' })\n        .eq('id', patient.bed_id);\n\n      if (bedStatusError) throw bedStatusError;\n\n      onDischargeSuccess();\n      onClose();\n    } catch (error) {\n      console.error('Error discharging patient:', error);\n      setError('Failed to discharge patient. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"bg-red-100 p-2 rounded-xl\">\n              <FileText className=\"h-6 w-6 text-red-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-gray-900\">Discharge Patient</h2>\n              <p className=\"text-sm text-gray-600\">{patient.name} - {patient.patient_id}</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n          >\n            <X className=\"h-5 w-5 text-gray-500\" />\n          </button>\n        </div>\n\n        {error && (\n          <div className=\"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center\">\n            <AlertCircle className=\"h-5 w-5 text-red-500 mr-2\" />\n            <span className=\"text-red-700\">{error}</span>\n          </div>\n        )}\n\n        <div className=\"p-6 space-y-6\">\n          {/* Patient Info */}\n          <div className=\"bg-gray-50 rounded-xl p-4\">\n            <h3 className=\"font-semibold text-gray-900 mb-3\">Patient Information</h3>\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div className=\"flex items-center\">\n                <User className=\"h-4 w-4 text-gray-400 mr-2\" />\n                <span className=\"text-gray-600\">Name:</span>\n                <span className=\"ml-2 font-medium\">{patient.name}</span>\n              </div>\n              <div className=\"flex items-center\">\n                <Bed className=\"h-4 w-4 text-gray-400 mr-2\" />\n                <span className=\"text-gray-600\">Room:</span>\n                <span className=\"ml-2 font-medium\">{patient.department_ward} - {patient.room_number}</span>\n              </div>\n              <div className=\"flex items-center\">\n                <Calendar className=\"h-4 w-4 text-gray-400 mr-2\" />\n                <span className=\"text-gray-600\">Admitted:</span>\n                <span className=\"ml-2 font-medium\">\n                  {patient.admission_date ? new Date(patient.admission_date).toLocaleDateString() : 'N/A'}\n                </span>\n              </div>\n              <div className=\"flex items-center\">\n                <Clock className=\"h-4 w-4 text-gray-400 mr-2\" />\n                <span className=\"text-gray-600\">Stay Duration:</span>\n                <span className=\"ml-2 font-medium\">{roomCharges.days} days</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Discharge Details */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Discharge Date & Time\n            </label>\n            <input\n              type=\"datetime-local\"\n              value={dischargeDate}\n              onChange={(e) => setDischargeDate(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\n            />\n          </div>\n\n          {/* Room Charges */}\n          <div className=\"bg-blue-50 rounded-xl p-4\">\n            <h3 className=\"font-semibold text-gray-900 mb-3\">Room Charges</h3>\n            <div className=\"grid grid-cols-4 gap-4 text-sm\">\n              <div>\n                <span className=\"text-gray-600\">Bed Type:</span>\n                <p className=\"font-medium\">{roomCharges.bedType}</p>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Days:</span>\n                <p className=\"font-medium\">{roomCharges.days}</p>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Daily Rate:</span>\n                <p className=\"font-medium\">{roomCharges.dailyRate}</p>\n              </div>\n              <div>\n                <span className=\"text-gray-600\">Total:</span>\n                <p className=\"font-medium text-blue-600\">{roomCharges.totalCharges}</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Additional Services */}\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"font-semibold text-gray-900\">Additional Services</h3>\n              <button\n                onClick={addAdditionalService}\n                className=\"flex items-center bg-orange-500 text-white px-3 py-2 rounded-xl text-sm hover:bg-orange-600 transition-colors\"\n              >\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Service\n              </button>\n            </div>\n\n            <div className=\"space-y-3\">\n              {additionalServices.map((service, index) => (\n                <div key={index} className=\"bg-gray-50 rounded-xl p-4\">\n                  <div className=\"grid grid-cols-5 gap-3 items-end\">\n                    <div>\n                      <label className=\"block text-xs font-medium text-gray-700 mb-1\">Service</label>\n                      <select\n                        value={service.service_name}\n                        onChange={(e) => {\n                          const selectedRate = feeRates.find(rate => rate.service_name === e.target.value);\n                          if (selectedRate) {\n                            handleServiceSelection(index, selectedRate.id);\n                          }\n                        }}\n                        className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500\"\n                      >\n                        <option value=\"\">Select Service</option>\n                        {feeRates.map(rate => (\n                          <option key={rate.id} value={rate.service_name}>{rate.service_name}</option>\n                        ))}\n                      </select>\n                    </div>\n                    <div>\n                      <label className=\"block text-xs font-medium text-gray-700 mb-1\">Quantity</label>\n                      <input\n                        type=\"number\"\n                        min=\"1\"\n                        value={service.quantity}\n                        onChange={(e) => updateAdditionalService(index, 'quantity', parseInt(e.target.value) || 1)}\n                        className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-xs font-medium text-gray-700 mb-1\">Unit Rate ()</label>\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={service.unit_rate}\n                        onChange={(e) => updateAdditionalService(index, 'unit_rate', parseFloat(e.target.value) || 0)}\n                        className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-xs font-medium text-gray-700 mb-1\">Total ()</label>\n                      <input\n                        type=\"text\"\n                        value={(service.quantity * service.unit_rate).toFixed(2)}\n                        readOnly\n                        className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg bg-gray-100\"\n                      />\n                    </div>\n                    <div>\n                      <button\n                        onClick={() => removeAdditionalService(index)}\n                        className=\"p-1 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Billing Summary */}\n          <div className=\"bg-orange-50 rounded-xl p-4\">\n            <h3 className=\"font-semibold text-gray-900 mb-4\">Billing Summary</h3>\n            <div className=\"grid grid-cols-3 gap-4 mb-4\">\n              <div>\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">Tax (%)</label>\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.1\"\n                  value={taxPercentage}\n                  onChange={(e) => setTaxPercentage(parseFloat(e.target.value) || 0)}\n                  className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">Discount (%)</label>\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.1\"\n                  value={discountPercentage}\n                  onChange={(e) => setDiscountPercentage(parseFloat(e.target.value) || 0)}\n                  className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-orange-500\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Subtotal:</span>\n                <span className=\"font-medium\">{billTotals.subtotal.toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Tax ({taxPercentage}%):</span>\n                <span className=\"font-medium\">{billTotals.taxAmount.toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Discount ({discountPercentage}%):</span>\n                <span className=\"font-medium text-green-600\">-{billTotals.discountAmount.toFixed(2)}</span>\n              </div>\n              <div className=\"border-t border-gray-300 pt-2\">\n                <div className=\"flex justify-between text-lg font-bold\">\n                  <span>Total Amount:</span>\n                  <span className=\"text-orange-600\">{billTotals.totalAmount.toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Discharge Notes */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Discharge Notes (Optional)\n            </label>\n            <textarea\n              value={dischargeNotes}\n              onChange={(e) => setDischargeNotes(e.target.value)}\n              rows={3}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\n              placeholder=\"Enter any discharge notes or instructions...\"\n            />\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-end space-x-3 p-6 border-t border-gray-200\">\n          <button\n            onClick={onClose}\n            className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleDischarge}\n            disabled={loading}\n            className=\"flex items-center bg-red-500 text-white px-6 py-2 rounded-xl hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {loading ? (\n              <>\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                Processing...\n              </>\n            ) : (\n              <>\n                <Save className=\"h-4 w-4 mr-2\" />\n                Discharge Patient\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DischargeModal;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2936, "column": 0}, "map": {"version":3,"sources":["file:///Users/nisha/Desktop/hms/untitled%20folder/project/app/patients/page.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { \n  Users, \n  Search, \n  Filter, \n  Plus, \n  Eye, \n  Edit3, \n  MoreVertical,\n  UserPlus,\n  Calendar,\n  Phone,\n  MapPin,\n  Heart,\n  AlertCircle,\n  CheckCircle,\n  TrendingUp,\n  Clock,\n  RefreshCw,\n  Hash,\n  AlertTriangle,\n  Bed,\n  LogOut\n} from 'lucide-react';\nimport { getAllPatients } from '../../src/lib/patientService';\nimport { supabase } from '../../src/lib/supabase';\nimport AdmissionModal from '../../src/components/AdmissionModal';\nimport DischargeModal from '../../src/components/DischargeModal';\n\ninterface Patient {\n  id: string;\n  patient_id: string;\n  name: string;\n  date_of_birth: string;\n  gender: string;\n  phone: string;\n  email: string;\n  address: string;\n  blood_group: string;\n  allergies: string;\n  status: string;\n  primary_complaint: string;\n  admission_type: string;\n  department_ward: string;\n  room_number: string;\n  created_at: string;\n  // Bed allocation fields\n  bed_id?: string | null;\n  admission_date?: string | null;\n  discharge_date?: string | null;\n}\n\nexport default function PatientsPage() {\n  const router = useRouter();\n  const [patients, setPatients] = useState<Patient[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState('');\n  const [totalPatients, setTotalPatients] = useState(0);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [refreshing, setRefreshing] = useState(false);\n  const [admittedCount, setAdmittedCount] = useState(0);\n  const [criticalCount, setCriticalCount] = useState(0);\n  \n  // Admission modal state\n  const [admissionModalOpen, setAdmissionModalOpen] = useState(false);\n  const [selectedPatientForAdmission, setSelectedPatientForAdmission] = useState<Patient | null>(null);\n  \n  // Discharge modal state\n  const [dischargeModalOpen, setDischargeModalOpen] = useState(false);\n  const [selectedPatientForDischarge, setSelectedPatientForDischarge] = useState<Patient | null>(null);\n\n  useEffect(() => {\n    fetchPatients();\n  }, [currentPage, statusFilter, searchTerm]);\n\n  const fetchAdmittedCount = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('bed_allocations')\n        .select('patient_id')\n        .is('discharge_date', null)\n        .eq('status', 'active');\n      \n      if (error) {\n        console.error('Error fetching admitted count:', error);\n        setAdmittedCount(0);\n      } else {\n        setAdmittedCount(data?.length || 0);\n      }\n    } catch (err) {\n      console.error('Error fetching admitted count:', err);\n      setAdmittedCount(0);\n    }\n  };\n\n  const updatePatientStatus = async (patientId: string, field: 'admission_type' | 'status', value: string) => {\n    try {\n      // Update patient status in database using existing fields\n      const updateData: any = {};\n      \n      if (field === 'admission_type') {\n        updateData.admission_type = value;\n      } else if (field === 'status') {\n        updateData.status = value;\n      }\n\n      const { error } = await supabase\n        .from('patients')\n        .update(updateData)\n        .eq('id', patientId);\n\n      if (error) {\n        console.error('Error updating patient status:', error);\n        alert('Failed to update patient status. Please try again.');\n        return;\n      }\n\n      // If changing from emergency to elective, handle bed discharge if needed\n      if (field === 'admission_type' && value === 'elective') {\n        // Check for active bed allocation\n        const { data: activeAllocation, error: allocationError } = await supabase\n          .from('bed_allocations')\n          .select('allocation_id, bed_id')\n          .eq('patient_id', patientId)\n          .eq('status', 'active')\n          .is('discharge_date', null)\n          .single();\n\n        if (!allocationError && activeAllocation) {\n          // Ask user if they want to discharge from bed\n          const shouldDischarge = confirm('This patient has an active bed allocation. Do you want to discharge them from the bed as well?');\n          \n          if (shouldDischarge) {\n            const currentDate = new Date().toISOString().split('T')[0];\n            const currentTime = new Date().toTimeString().split(' ')[0];\n            \n            await supabase\n              .from('bed_allocations')\n              .update({\n                discharge_date: currentDate,\n                discharge_time: currentTime,\n                status: 'discharged',\n                discharge_summary: 'Discharged via patient dashboard - status changed to non-critical'\n              })\n              .eq('allocation_id', activeAllocation.allocation_id);\n\n            // Update bed status to available\n            await supabase\n              .from('beds')\n              .update({ status: 'available' })\n              .eq('id', activeAllocation.bed_id);\n          }\n        }\n      }\n\n      // Refresh patient data to get updated info\n      await fetchPatients();\n      \n    } catch (error) {\n      console.error('Error updating patient status:', error);\n      alert('Failed to update patient status. Please try again.');\n    }\n  };\n\n  const fetchPatients = async () => {\n    try {\n      setLoading(true);\n      \n      // Fetch all active patients\n      const { data: patientsData, error: patientsError } = await supabase\n        .from('patients')\n        .select('*')\n        .eq('status', 'active')\n        .order('created_at', { ascending: false });\n\n      if (patientsError) {\n        console.error('Error fetching patients:', patientsError);\n        setError('Failed to fetch patients');\n        return;\n      }\n\n      // Fetch bed allocations for admitted patients\n      const { data: bedAllocations, error: bedError } = await supabase\n        .from('bed_allocations')\n        .select('patient_id, bed_id, admission_date, discharge_date, status')\n        .eq('status', 'active')\n        .is('discharge_date', null);\n\n      if (bedError) {\n        console.error('Error fetching bed allocations:', bedError);\n      }\n\n      // Create a map of patient IDs to bed info\n      const bedMap = new Map();\n      if (bedAllocations) {\n        bedAllocations.forEach(allocation => {\n          bedMap.set(allocation.patient_id, {\n            bed_id: allocation.bed_id,\n            admission_date: allocation.admission_date,\n            discharge_date: allocation.discharge_date\n          });\n        });\n      }\n\n      // Transform the data to include bed allocation info\n      const transformedData = patientsData?.map(patient => ({\n        ...patient,\n        bed_id: bedMap.get(patient.id)?.bed_id || null,\n        admission_date: bedMap.get(patient.id)?.admission_date || null,\n        discharge_date: bedMap.get(patient.id)?.discharge_date || null,\n      })) || [];\n\n      setPatients(transformedData);\n      setTotalPatients(transformedData.length);\n      \n      // Calculate counts\n      const admitted = transformedData.filter(p => p.bed_id !== null).length;\n      const critical = transformedData.filter(p => p.admission_type === 'emergency').length;\n      \n      setAdmittedCount(admitted);\n      setCriticalCount(critical);\n      \n    } catch (err) {\n      console.error('Error:', err);\n      setError('Failed to fetch patients');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    await fetchPatients();\n    setRefreshing(false);\n  };\n\n  const handleAdmitPatient = (patient: Patient) => {\n    setSelectedPatientForAdmission(patient);\n    setAdmissionModalOpen(true);\n  };\n\n  const handleAdmissionSuccess = () => {\n    // Refresh the patients list to show updated admission status\n    fetchPatients();\n  };\n\n  const handleDischargePatient = (patient: Patient) => {\n    setSelectedPatientForDischarge(patient);\n    setDischargeModalOpen(true);\n  };\n\n  const handleDischargeSuccess = () => {\n    // Refresh the patients list to show updated discharge status\n    fetchPatients();\n  };\n\n  const handleSearch = (value: string) => {\n    setSearchTerm(value);\n    setCurrentPage(1); // Reset to first page when searching\n  };\n\n  const handleStatusFilter = (status: string) => {\n    setStatusFilter(status);\n    setCurrentPage(1); // Reset to first page when filtering\n  };\n\n  const calculateAge = (dateOfBirth: string) => {\n    if (!dateOfBirth) return 'N/A';\n    const birth = new Date(dateOfBirth);\n    const today = new Date();\n    let age = today.getFullYear() - birth.getFullYear();\n    const monthDiff = today.getMonth() - birth.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      age--;\n    }\n    \n    return age;\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status?.toLowerCase()) {\n      case 'critical':\n        return 'bg-red-100 text-red-800';\n      case 'stable':\n        return 'bg-green-100 text-green-800';\n      case 'recovering':\n        return 'bg-orange-100 text-orange-800';\n      case 'active':\n        return 'bg-blue-100 text-blue-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  // Function to determine if patient is admitted (has active bed allocation)\n  const isPatientAdmitted = (patient: Patient) => {\n    return patient.bed_id !== null;\n  };\n\n  // Function to determine if patient is critical (emergency admission type)\n  const isPatientCritical = (patient: Patient) => {\n    return patient.admission_type === 'emergency';\n  };\n\n  const getTruncatedText = (text: string, maxLength: number = 30) => {\n    if (!text) return 'Not specified';\n    return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map(n => n[0])\n      .join('')\n      .toUpperCase()\n      .substring(0, 2);\n  };\n\n  const getGradientColors = (name: string) => {\n    const colors = [\n      'from-purple-500 to-pink-500',\n      'from-blue-500 to-cyan-500',\n      'from-green-500 to-emerald-500',\n      'from-orange-500 to-red-500',\n      'from-indigo-500 to-purple-500',\n      'from-pink-500 to-rose-500',\n      'from-cyan-500 to-blue-500',\n      'from-emerald-500 to-green-500'\n    ];\n    \n    const hash = name.split('').reduce((a, b) => {\n      a = ((a << 5) - a) + b.charCodeAt(0);\n      return a & a;\n    }, 0);\n    \n    return colors[Math.abs(hash) % colors.length];\n  };\n\n  // Calculate stats from real data\n  const stats = {\n    total: totalPatients,\n    newToday: patients.filter(p => {\n      const today = new Date().toDateString();\n      return new Date(p.created_at).toDateString() === today;\n    }).length,\n    critical: criticalCount,\n    admitted: admittedCount\n  };\n\n  // Filter patients based on search and status\n  const filteredPatients = patients.filter(patient => {\n    const matchesSearch = !searchTerm || \n      patient.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      patient.patient_id.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      patient.phone?.includes(searchTerm);\n    \n    const matchesStatus = !statusFilter || \n      (statusFilter === 'critical' && isPatientCritical(patient)) ||\n      (statusFilter === 'admitted' && isPatientAdmitted(patient)) ||\n      (statusFilter === 'active' && patient.status === 'active');\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  if (loading && patients.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading patients...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Patients</h1>\n          <p className=\"text-gray-500 mt-1\">Manage patient records and information</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={handleRefresh}\n            disabled={refreshing}\n            className=\"flex items-center bg-white border border-gray-300 text-gray-700 px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md hover:bg-gray-50 disabled:opacity-50\"\n          >\n            <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\n            Refresh\n          </button>\n          <Link href=\"/patients/emergency-register\">\n            <button className=\"flex items-center bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md\">\n              <AlertTriangle size={16} className=\"mr-2\" />\n              Emergency Register\n            </button>\n          </Link>\n          <Link href=\"/patients/register\">\n            <button className=\"flex items-center bg-orange-500 hover:bg-orange-600 text-white px-4 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 shadow-sm hover:shadow-md\">\n              <UserPlus size={16} className=\"mr-2\" />\n              Register New Patient\n            </button>\n          </Link>\n        </div>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-2xl p-5 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs font-semibold text-gray-600 uppercase tracking-wide\">Total Patients</p>\n              <p className=\"text-2xl font-bold text-gray-900 mt-1\">{stats.total.toLocaleString()}</p>\n              <div className=\"flex items-center mt-2\">\n                <TrendingUp className=\"h-3 w-3 text-green-500 mr-1\" />\n                <span className=\"text-sm font-medium text-green-600\">Active</span>\n              </div>\n            </div>\n            <div className=\"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center\">\n              <Users className=\"h-6 w-6 text-white\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-2xl p-5 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs font-semibold text-gray-600 uppercase tracking-wide\">New Today</p>\n              <p className=\"text-2xl font-bold text-gray-900 mt-1\">{stats.newToday.toLocaleString()}</p>\n              <div className=\"flex items-center mt-2\">\n                <Clock className=\"h-3 w-3 text-blue-500 mr-1\" />\n                <span className=\"text-sm font-medium text-blue-600\">Today</span>\n              </div>\n            </div>\n            <div className=\"w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center\">\n              <UserPlus className=\"h-6 w-6 text-white\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-2xl p-5 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs font-semibold text-gray-600 uppercase tracking-wide\">Critical</p>\n              <p className=\"text-2xl font-bold text-gray-900 mt-1\">{stats.critical.toLocaleString()}</p>\n              <div className=\"flex items-center mt-2\">\n                <AlertCircle className=\"h-3 w-3 text-red-500 mr-1\" />\n                <span className=\"text-sm font-medium text-red-600\">Emergency</span>\n              </div>\n            </div>\n            <div className=\"w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center\">\n              <Heart className=\"h-6 w-6 text-white\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-2xl p-5 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs font-semibold text-gray-600 uppercase tracking-wide\">Admitted</p>\n              <p className=\"text-2xl font-bold text-gray-900 mt-1\">{stats.admitted.toLocaleString()}</p>\n              <div className=\"flex items-center mt-2\">\n                <CheckCircle className=\"h-3 w-3 text-orange-500 mr-1\" />\n                <span className=\"text-sm font-medium text-orange-600\">In Beds</span>\n              </div>\n            </div>\n            <div className=\"w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl flex items-center justify-center\">\n              <CheckCircle className=\"h-6 w-6 text-white\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Search and Filter */}\n      <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-gray-100\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"flex-1 relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search patients by name, ID, or phone...\"\n              value={searchTerm}\n              onChange={(e) => handleSearch(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\n            />\n          </div>\n          <div className=\"flex gap-2\">\n            <select\n              value={statusFilter}\n              onChange={(e) => handleStatusFilter(e.target.value)}\n              className=\"px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white\"\n            >\n              <option value=\"\">All Status</option>\n              <option value=\"active\">Active</option>\n              <option value=\"critical\">Critical</option>\n              <option value=\"admitted\">Admitted</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\n          <div className=\"flex items-center\">\n            <AlertCircle className=\"h-5 w-5 text-red-500 mr-2\" />\n            <p className=\"text-red-700\">{error}</p>\n          </div>\n        </div>\n      )}\n\n      {/* Patients Grid */}\n      {filteredPatients.length > 0 ? (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6\">\n          {filteredPatients.map((patient) => (\n            <div key={patient.id} className=\"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 hover:shadow-md transition-shadow duration-200\">\n              <div className=\"flex items-start justify-between mb-4\">\n                <div className=\"flex items-center\">\n                  <div className={`w-12 h-12 bg-gradient-to-r ${getGradientColors(patient.name)} rounded-xl flex items-center justify-center text-white font-bold text-sm`}>\n                    {getInitials(patient.name)}\n                  </div>\n                  <div className=\"ml-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{patient.name}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Hash className=\"h-3 w-3 text-gray-400\" />\n                      <p className=\"text-sm text-orange-600 font-mono\">{patient.patient_id}</p>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {/* Show Critical badge for emergency patients */}\n                  {isPatientCritical(patient) && (\n                    <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800 flex items-center gap-1\">\n                      <AlertCircle size={10} />\n                      Critical\n                    </span>\n                  )}\n                  \n                  {/* Show Admitted badge only for patients with bed allocation */}\n                  {isPatientAdmitted(patient) && (\n                    <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 flex items-center gap-1\">\n                      <CheckCircle size={10} />\n                      Admitted\n                    </span>\n                  )}\n                  \n                  <button className=\"p-1 hover:bg-gray-100 rounded-lg transition-colors\">\n                    <MoreVertical size={16} className=\"text-gray-500\" />\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2 mb-4\">\n                <div className=\"flex items-center text-sm text-gray-600\">\n                  <Calendar size={14} className=\"mr-2\" />\n                  Age: {calculateAge(patient.date_of_birth)}  {patient.gender?.charAt(0).toUpperCase() + patient.gender?.slice(1)}  {patient.blood_group || 'Unknown'}\n                </div>\n                <div className=\"flex items-center text-sm text-gray-600\">\n                  <Phone size={14} className=\"mr-2\" />\n                  {patient.phone}\n                </div>\n                <div className=\"flex items-center text-sm text-gray-600\">\n                  <MapPin size={14} className=\"mr-2\" />\n                  {getTruncatedText(patient.address, 35)}\n                </div>\n              </div>\n\n              {patient.primary_complaint && (\n                <div className=\"bg-orange-50 rounded-xl p-3 mb-4\">\n                  <p className=\"text-xs font-medium text-orange-700 mb-1\">Primary Complaint</p>\n                  <p className=\"text-sm text-orange-900\">{getTruncatedText(patient.primary_complaint, 50)}</p>\n                </div>\n              )}\n\n              {patient.department_ward && (\n                <div className=\"bg-blue-50 rounded-xl p-3 mb-4\">\n                  <p className=\"text-xs font-medium text-blue-700 mb-1\">Current Department</p>\n                  <p className=\"text-sm text-blue-900\">{patient.department_ward} {patient.room_number && `- ${patient.room_number}`}</p>\n                </div>\n              )}\n\n              {patient.allergies && (\n                <div className=\"bg-red-50 rounded-xl p-3 mb-4 border border-red-200\">\n                  <p className=\"text-xs font-medium text-red-700 mb-1 flex items-center\">\n                    <AlertCircle size={12} className=\"mr-1\" />\n                    Allergies\n                  </p>\n                  <p className=\"text-sm text-red-900\">{getTruncatedText(patient.allergies, 40)}</p>\n                </div>\n              )}\n\n              {/* Patient Status Controls */}\n              <div className=\"bg-gray-50 rounded-xl p-3 mb-4\">\n                <p className=\"text-xs font-medium text-gray-700 mb-2\">Patient Status</p>\n                <div className=\"space-y-2\">\n                  {/* Critical Status - Based on admission_type */}\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">Critical Status</span>\n                    <div className=\"flex items-center gap-2\">\n                      <label className=\"flex items-center cursor-pointer\">\n                        <input\n                          type=\"radio\"\n                          name={`critical-${patient.id}`}\n                          checked={patient.admission_type === 'emergency'}\n                          onChange={() => updatePatientStatus(patient.id, 'admission_type', 'emergency')}\n                          className=\"w-4 h-4 text-red-600 bg-gray-100 border-gray-300 focus:ring-red-500 focus:ring-2\"\n                        />\n                        <span className=\"ml-1 text-xs text-red-700\">Critical</span>\n                      </label>\n                      <label className=\"flex items-center cursor-pointer\">\n                        <input\n                          type=\"radio\"\n                          name={`critical-${patient.id}`}\n                          checked={patient.admission_type !== 'emergency'}\n                          onChange={() => updatePatientStatus(patient.id, 'admission_type', 'elective')}\n                          className=\"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 focus:ring-gray-500 focus:ring-2\"\n                        />\n                        <span className=\"ml-1 text-xs text-gray-700\">Stable</span>\n                      </label>\n                    </div>\n                  </div>\n                  \n                  {/* Admission Status Display - Read only based on bed allocation */}\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">Admission Status</span>\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n                        isPatientAdmitted(patient) \n                          ? 'bg-green-100 text-green-800' \n                          : 'bg-gray-100 text-gray-600'\n                      }`}>\n                        {isPatientAdmitted(patient) ? 'Admitted' : 'Outpatient'}\n                      </span>\n                      {!isPatientAdmitted(patient) ? (\n                        <button\n                          onClick={() => handleAdmitPatient(patient)}\n                          className=\"px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-700 hover:bg-orange-200 transition-colors flex items-center gap-1\"\n                        >\n                          <Bed size={10} />\n                          Admit\n                        </button>\n                      ) : (\n                        <button\n                          onClick={() => handleDischargePatient(patient)}\n                          className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors flex items-center gap-1\"\n                        >\n                          <LogOut size={10} />\n                          Discharge\n                        </button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Link href={`/patients/${patient.patient_id}`} className=\"flex-1\">\n                  <button className=\"w-full flex items-center justify-center bg-orange-50 text-orange-600 py-2 px-3 rounded-xl text-sm font-medium hover:bg-orange-100 transition-colors\">\n                    <Eye size={14} className=\"mr-1\" />\n                    View\n                  </button>\n                </Link>\n                <button \n                  onClick={() => router.push(`/patients/${patient.patient_id}/edit`)}\n                  className=\"flex-1 flex items-center justify-center bg-gray-50 text-gray-700 py-2 px-3 rounded-xl text-sm font-medium hover:bg-gray-100 transition-colors\"\n                >\n                  <Edit3 size={14} className=\"mr-1\" />\n                  Edit\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        !loading && (\n          <div className=\"text-center py-12\">\n            <Users className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No patients found</h3>\n            <p className=\"text-gray-600 mb-6\">\n              {searchTerm || statusFilter ? 'Try adjusting your search or filters.' : 'Start by registering your first patient.'}\n            </p>\n            <Link href=\"/patients/register\">\n              <button className=\"bg-orange-500 text-white px-6 py-3 rounded-xl hover:bg-orange-600 transition-colors font-medium\">\n                Register New Patient\n              </button>\n            </Link>\n          </div>\n        )\n      )}\n\n      {/* Pagination */}\n      {totalPatients > 20 && (\n        <div className=\"flex justify-center\">\n          <div className=\"bg-white rounded-xl border border-gray-200 p-2\">\n            <p className=\"text-sm text-gray-600 px-4 py-2\">\n              Showing {filteredPatients.length} of {totalPatients} patients\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Admission Modal */}\n      {selectedPatientForAdmission && (\n        <AdmissionModal\n          isOpen={admissionModalOpen}\n          onClose={() => {\n            setAdmissionModalOpen(false);\n            setSelectedPatientForAdmission(null);\n          }}\n          patient={selectedPatientForAdmission}\n          onSuccess={handleAdmissionSuccess}\n        />\n      )}\n\n      {/* Discharge Modal */}\n      {selectedPatientForDischarge && (\n        <DischargeModal\n          isOpen={dischargeModalOpen}\n          onClose={() => {\n            setDischargeModalOpen(false);\n            setSelectedPatientForDischarge(null);\n          }}\n          patient={selectedPatientForDischarge}\n          onDischargeSuccess={handleDischargeSuccess}\n        />\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBA;AACA;AACA;;;AA9BA;;;;;;;;AAuDe,SAAS;;IACtB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAa,EAAE;IACtD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEnD,wBAAwB;IACxB,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7D,MAAM,CAAC,6BAA6B,+BAA+B,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAkB;IAE/F,wBAAwB;IACxB,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7D,MAAM,CAAC,6BAA6B,+BAA+B,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAkB;IAE/F,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR;QACF;iCAAG;QAAC;QAAa;QAAc;KAAW;IAE1C,MAAM,qBAAqB;QACzB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CACnC,IAAI,CAAC,mBACL,MAAM,CAAC,cACP,EAAE,CAAC,kBAAkB,MACrB,EAAE,CAAC,UAAU;YAEhB,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,kCAAkC;gBAChD,iBAAiB;YACnB,OAAO;gBACL,iBAAiB,MAAM,UAAU;YACnC;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,kCAAkC;YAChD,iBAAiB;QACnB;IACF;IAEA,MAAM,sBAAsB,OAAO,WAAmB,OAAoC;QACxF,IAAI;YACF,0DAA0D;YAC1D,MAAM,aAAkB,CAAC;YAEzB,IAAI,UAAU,kBAAkB;gBAC9B,WAAW,cAAc,GAAG;YAC9B,OAAO,IAAI,UAAU,UAAU;gBAC7B,WAAW,MAAM,GAAG;YACtB;YAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CAC7B,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM;YAEZ,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,kCAAkC;gBAChD,MAAM;gBACN;YACF;YAEA,yEAAyE;YACzE,IAAI,UAAU,oBAAoB,UAAU,YAAY;gBACtD,kCAAkC;gBAClC,MAAM,EAAE,MAAM,gBAAgB,EAAE,OAAO,eAAe,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CACtE,IAAI,CAAC,mBACL,MAAM,CAAC,yBACP,EAAE,CAAC,cAAc,WACjB,EAAE,CAAC,UAAU,UACb,EAAE,CAAC,kBAAkB,MACrB,MAAM;gBAET,IAAI,CAAC,mBAAmB,kBAAkB;oBACxC,8CAA8C;oBAC9C,MAAM,kBAAkB,QAAQ;oBAEhC,IAAI,iBAAiB;wBACnB,MAAM,cAAc,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;wBAC1D,MAAM,cAAc,IAAI,OAAO,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;wBAE3D,MAAM,yHAAA,CAAA,WAAQ,CACX,IAAI,CAAC,mBACL,MAAM,CAAC;4BACN,gBAAgB;4BAChB,gBAAgB;4BAChB,QAAQ;4BACR,mBAAmB;wBACrB,GACC,EAAE,CAAC,iBAAiB,iBAAiB,aAAa;wBAErD,iCAAiC;wBACjC,MAAM,yHAAA,CAAA,WAAQ,CACX,IAAI,CAAC,QACL,MAAM,CAAC;4BAAE,QAAQ;wBAAY,GAC7B,EAAE,CAAC,MAAM,iBAAiB,MAAM;oBACrC;gBACF;YACF;YAEA,2CAA2C;YAC3C,MAAM;QAER,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM;QACR;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI;YACF,WAAW;YAEX,4BAA4B;YAC5B,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CAChE,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAU,UACb,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM;YAE1C,IAAI,eAAe;gBACjB,QAAQ,KAAK,CAAC,4BAA4B;gBAC1C,SAAS;gBACT;YACF;YAEA,8CAA8C;YAC9C,MAAM,EAAE,MAAM,cAAc,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,yHAAA,CAAA,WAAQ,CAC7D,IAAI,CAAC,mBACL,MAAM,CAAC,8DACP,EAAE,CAAC,UAAU,UACb,EAAE,CAAC,kBAAkB;YAExB,IAAI,UAAU;gBACZ,QAAQ,KAAK,CAAC,mCAAmC;YACnD;YAEA,0CAA0C;YAC1C,MAAM,SAAS,IAAI;YACnB,IAAI,gBAAgB;gBAClB,eAAe,OAAO,CAAC,CAAA;oBACrB,OAAO,GAAG,CAAC,WAAW,UAAU,EAAE;wBAChC,QAAQ,WAAW,MAAM;wBACzB,gBAAgB,WAAW,cAAc;wBACzC,gBAAgB,WAAW,cAAc;oBAC3C;gBACF;YACF;YAEA,oDAAoD;YACpD,MAAM,kBAAkB,cAAc,IAAI,CAAA,UAAW,CAAC;oBACpD,GAAG,OAAO;oBACV,QAAQ,OAAO,GAAG,CAAC,QAAQ,EAAE,GAAG,UAAU;oBAC1C,gBAAgB,OAAO,GAAG,CAAC,QAAQ,EAAE,GAAG,kBAAkB;oBAC1D,gBAAgB,OAAO,GAAG,CAAC,QAAQ,EAAE,GAAG,kBAAkB;gBAC5D,CAAC,MAAM,EAAE;YAET,YAAY;YACZ,iBAAiB,gBAAgB,MAAM;YAEvC,mBAAmB;YACnB,MAAM,WAAW,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,MAAM,MAAM;YACtE,MAAM,WAAW,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,cAAc,KAAK,aAAa,MAAM;YAErF,iBAAiB;YACjB,iBAAiB;QAEnB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,UAAU;YACxB,SAAS;QACX,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,gBAAgB;QACpB,cAAc;QACd,MAAM;QACN,cAAc;IAChB;IAEA,MAAM,qBAAqB,CAAC;QAC1B,+BAA+B;QAC/B,sBAAsB;IACxB;IAEA,MAAM,yBAAyB;QAC7B,6DAA6D;QAC7D;IACF;IAEA,MAAM,yBAAyB,CAAC;QAC9B,+BAA+B;QAC/B,sBAAsB;IACxB;IAEA,MAAM,yBAAyB;QAC7B,6DAA6D;QAC7D;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,cAAc;QACd,eAAe,IAAI,qCAAqC;IAC1D;IAEA,MAAM,qBAAqB,CAAC;QAC1B,gBAAgB;QAChB,eAAe,IAAI,qCAAqC;IAC1D;IAEA,MAAM,eAAe,CAAC;QACpB,IAAI,CAAC,aAAa,OAAO;QACzB,MAAM,QAAQ,IAAI,KAAK;QACvB,MAAM,QAAQ,IAAI;QAClB,IAAI,MAAM,MAAM,WAAW,KAAK,MAAM,WAAW;QACjD,MAAM,YAAY,MAAM,QAAQ,KAAK,MAAM,QAAQ;QAEnD,IAAI,YAAY,KAAM,cAAc,KAAK,MAAM,OAAO,KAAK,MAAM,OAAO,IAAK;YAC3E;QACF;QAEA,OAAO;IACT;IAEA,MAAM,iBAAiB,CAAC;QACtB,OAAQ,QAAQ;YACd,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,2EAA2E;IAC3E,MAAM,oBAAoB,CAAC;QACzB,OAAO,QAAQ,MAAM,KAAK;IAC5B;IAEA,0EAA0E;IAC1E,MAAM,oBAAoB,CAAC;QACzB,OAAO,QAAQ,cAAc,KAAK;IACpC;IAEA,MAAM,mBAAmB,CAAC,MAAc,YAAoB,EAAE;QAC5D,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,KAAK,MAAM,GAAG,YAAY,GAAG,KAAK,SAAS,CAAC,GAAG,WAAW,GAAG,CAAC,GAAG;IAC1E;IAEA,MAAM,cAAc,CAAC;QACnB,OAAO,KACJ,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,IAAK,CAAC,CAAC,EAAE,EACb,IAAI,CAAC,IACL,WAAW,GACX,SAAS,CAAC,GAAG;IAClB;IAEA,MAAM,oBAAoB,CAAC;QACzB,MAAM,SAAS;YACb;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,MAAM,OAAO,KAAK,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,GAAG;YACrC,IAAI,AAAC,CAAC,KAAK,CAAC,IAAI,IAAK,EAAE,UAAU,CAAC;YAClC,OAAO,IAAI;QACb,GAAG;QAEH,OAAO,MAAM,CAAC,KAAK,GAAG,CAAC,QAAQ,OAAO,MAAM,CAAC;IAC/C;IAEA,iCAAiC;IACjC,MAAM,QAAQ;QACZ,OAAO;QACP,UAAU,SAAS,MAAM,CAAC,CAAA;YACxB,MAAM,QAAQ,IAAI,OAAO,YAAY;YACrC,OAAO,IAAI,KAAK,EAAE,UAAU,EAAE,YAAY,OAAO;QACnD,GAAG,MAAM;QACT,UAAU;QACV,UAAU;IACZ;IAEA,6CAA6C;IAC7C,MAAM,mBAAmB,SAAS,MAAM,CAAC,CAAA;QACvC,MAAM,gBAAgB,CAAC,cACrB,QAAQ,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW,OAC1D,QAAQ,UAAU,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW,OAChE,QAAQ,KAAK,EAAE,SAAS;QAE1B,MAAM,gBAAgB,CAAC,gBACpB,iBAAiB,cAAc,kBAAkB,YACjD,iBAAiB,cAAc,kBAAkB,YACjD,iBAAiB,YAAY,QAAQ,MAAM,KAAK;QAEnD,OAAO,iBAAiB;IAC1B;IAEA,IAAI,WAAW,SAAS,MAAM,KAAK,GAAG;QACpC,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAE,WAAU;kCAAgB;;;;;;;;;;;;;;;;;IAIrC;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;;0CACC,6LAAC;gCAAG,WAAU;0CAAmC;;;;;;0CACjD,6LAAC;gCAAE,WAAU;0CAAqB;;;;;;;;;;;;kCAEpC,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,SAAS;gCACT,UAAU;gCACV,WAAU;;kDAEV,6LAAC,mNAAA,CAAA,YAAS;wCAAC,WAAW,CAAC,aAAa,EAAE,aAAa,iBAAiB,IAAI;;;;;;oCAAI;;;;;;;0CAG9E,6LAAC,+JAAA,CAAA,UAAI;gCAAC,MAAK;0CACT,cAAA,6LAAC;oCAAO,WAAU;;sDAChB,6LAAC,2NAAA,CAAA,gBAAa;4CAAC,MAAM;4CAAI,WAAU;;;;;;wCAAS;;;;;;;;;;;;0CAIhD,6LAAC,+JAAA,CAAA,UAAI;gCAAC,MAAK;0CACT,cAAA,6LAAC;oCAAO,WAAU;;sDAChB,6LAAC,iNAAA,CAAA,WAAQ;4CAAC,MAAM;4CAAI,WAAU;;;;;;wCAAS;;;;;;;;;;;;;;;;;;;;;;;;0BAQ/C,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAE,WAAU;sDAA8D;;;;;;sDAC3E,6LAAC;4CAAE,WAAU;sDAAyC,MAAM,KAAK,CAAC,cAAc;;;;;;sDAChF,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,qNAAA,CAAA,aAAU;oDAAC,WAAU;;;;;;8DACtB,6LAAC;oDAAK,WAAU;8DAAqC;;;;;;;;;;;;;;;;;;8CAGzD,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,uMAAA,CAAA,QAAK;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kCAKvB,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAE,WAAU;sDAA8D;;;;;;sDAC3E,6LAAC;4CAAE,WAAU;sDAAyC,MAAM,QAAQ,CAAC,cAAc;;;;;;sDACnF,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,uMAAA,CAAA,QAAK;oDAAC,WAAU;;;;;;8DACjB,6LAAC;oDAAK,WAAU;8DAAoC;;;;;;;;;;;;;;;;;;8CAGxD,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,iNAAA,CAAA,WAAQ;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kCAK1B,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAE,WAAU;sDAA8D;;;;;;sDAC3E,6LAAC;4CAAE,WAAU;sDAAyC,MAAM,QAAQ,CAAC,cAAc;;;;;;sDACnF,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,uNAAA,CAAA,cAAW;oDAAC,WAAU;;;;;;8DACvB,6LAAC;oDAAK,WAAU;8DAAmC;;;;;;;;;;;;;;;;;;8CAGvD,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,uMAAA,CAAA,QAAK;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kCAKvB,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAE,WAAU;sDAA8D;;;;;;sDAC3E,6LAAC;4CAAE,WAAU;sDAAyC,MAAM,QAAQ,CAAC,cAAc;;;;;;sDACnF,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,8NAAA,CAAA,cAAW;oDAAC,WAAU;;;;;;8DACvB,6LAAC;oDAAK,WAAU;8DAAsC;;;;;;;;;;;;;;;;;;8CAG1D,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,8NAAA,CAAA,cAAW;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAO/B,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,yMAAA,CAAA,SAAM;oCAAC,WAAU;;;;;;8CAClB,6LAAC;oCACC,MAAK;oCACL,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;oCAC5C,WAAU;;;;;;;;;;;;sCAGd,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,OAAO;gCACP,UAAU,CAAC,IAAM,mBAAmB,EAAE,MAAM,CAAC,KAAK;gCAClD,WAAU;;kDAEV,6LAAC;wCAAO,OAAM;kDAAG;;;;;;kDACjB,6LAAC;wCAAO,OAAM;kDAAS;;;;;;kDACvB,6LAAC;wCAAO,OAAM;kDAAW;;;;;;kDACzB,6LAAC;wCAAO,OAAM;kDAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAOhC,uBACC,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,uNAAA,CAAA,cAAW;4BAAC,WAAU;;;;;;sCACvB,6LAAC;4BAAE,WAAU;sCAAgB;;;;;;;;;;;;;;;;;YAMlC,iBAAiB,MAAM,GAAG,kBACzB,6LAAC;gBAAI,WAAU;0BACZ,iBAAiB,GAAG,CAAC,CAAC,wBACrB,6LAAC;wBAAqB,WAAU;;0CAC9B,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAI,WAAW,CAAC,2BAA2B,EAAE,kBAAkB,QAAQ,IAAI,EAAE,yEAAyE,CAAC;0DACrJ,YAAY,QAAQ,IAAI;;;;;;0DAE3B,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAG,WAAU;kEAA+B,QAAQ,IAAI;;;;;;kEACzD,6LAAC;wDAAI,WAAU;;0EACb,6LAAC,qMAAA,CAAA,OAAI;gEAAC,WAAU;;;;;;0EAChB,6LAAC;gEAAE,WAAU;0EAAqC,QAAQ,UAAU;;;;;;;;;;;;;;;;;;;;;;;;kDAI1E,6LAAC;wCAAI,WAAU;;4CAEZ,kBAAkB,0BACjB,6LAAC;gDAAK,WAAU;;kEACd,6LAAC,uNAAA,CAAA,cAAW;wDAAC,MAAM;;;;;;oDAAM;;;;;;;4CAM5B,kBAAkB,0BACjB,6LAAC;gDAAK,WAAU;;kEACd,6LAAC,8NAAA,CAAA,cAAW;wDAAC,MAAM;;;;;;oDAAM;;;;;;;0DAK7B,6LAAC;gDAAO,WAAU;0DAChB,cAAA,6LAAC,6NAAA,CAAA,eAAY;oDAAC,MAAM;oDAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;0CAKxC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;0DACb,6LAAC,6MAAA,CAAA,WAAQ;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAAS;4CACjC,aAAa,QAAQ,aAAa;4CAAE;4CAAI,QAAQ,MAAM,EAAE,OAAO,GAAG,gBAAgB,QAAQ,MAAM,EAAE,MAAM;4CAAG;4CAAI,QAAQ,WAAW,IAAI;;;;;;;kDAE9I,6LAAC;wCAAI,WAAU;;0DACb,6LAAC,uMAAA,CAAA,QAAK;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAC1B,QAAQ,KAAK;;;;;;;kDAEhB,6LAAC;wCAAI,WAAU;;0DACb,6LAAC,6MAAA,CAAA,SAAM;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAC3B,iBAAiB,QAAQ,OAAO,EAAE;;;;;;;;;;;;;4BAItC,QAAQ,iBAAiB,kBACxB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDAA2C;;;;;;kDACxD,6LAAC;wCAAE,WAAU;kDAA2B,iBAAiB,QAAQ,iBAAiB,EAAE;;;;;;;;;;;;4BAIvF,QAAQ,eAAe,kBACtB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDAAyC;;;;;;kDACtD,6LAAC;wCAAE,WAAU;;4CAAyB,QAAQ,eAAe;4CAAC;4CAAE,QAAQ,WAAW,IAAI,CAAC,EAAE,EAAE,QAAQ,WAAW,EAAE;;;;;;;;;;;;;4BAIpH,QAAQ,SAAS,kBAChB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;;0DACX,6LAAC,uNAAA,CAAA,cAAW;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAAS;;;;;;;kDAG5C,6LAAC;wCAAE,WAAU;kDAAwB,iBAAiB,QAAQ,SAAS,EAAE;;;;;;;;;;;;0CAK7E,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDAAyC;;;;;;kDACtD,6LAAC;wCAAI,WAAU;;0DAEb,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAK,WAAU;kEAAwB;;;;;;kEACxC,6LAAC;wDAAI,WAAU;;0EACb,6LAAC;gEAAM,WAAU;;kFACf,6LAAC;wEACC,MAAK;wEACL,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,EAAE;wEAC9B,SAAS,QAAQ,cAAc,KAAK;wEACpC,UAAU,IAAM,oBAAoB,QAAQ,EAAE,EAAE,kBAAkB;wEAClE,WAAU;;;;;;kFAEZ,6LAAC;wEAAK,WAAU;kFAA4B;;;;;;;;;;;;0EAE9C,6LAAC;gEAAM,WAAU;;kFACf,6LAAC;wEACC,MAAK;wEACL,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,EAAE;wEAC9B,SAAS,QAAQ,cAAc,KAAK;wEACpC,UAAU,IAAM,oBAAoB,QAAQ,EAAE,EAAE,kBAAkB;wEAClE,WAAU;;;;;;kFAEZ,6LAAC;wEAAK,WAAU;kFAA6B;;;;;;;;;;;;;;;;;;;;;;;;0DAMnD,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;wDAAK,WAAU;kEAAwB;;;;;;kEACxC,6LAAC;wDAAI,WAAU;;0EACb,6LAAC;gEAAK,WAAW,CAAC,2CAA2C,EAC3D,kBAAkB,WACd,gCACA,6BACJ;0EACC,kBAAkB,WAAW,aAAa;;;;;;4DAE5C,CAAC,kBAAkB,yBAClB,6LAAC;gEACC,SAAS,IAAM,mBAAmB;gEAClC,WAAU;;kFAEV,6LAAC,mMAAA,CAAA,MAAG;wEAAC,MAAM;;;;;;oEAAM;;;;;;qFAInB,6LAAC;gEACC,SAAS,IAAM,uBAAuB;gEACtC,WAAU;;kFAEV,6LAAC,6MAAA,CAAA,SAAM;wEAAC,MAAM;;;;;;oEAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CAShC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,+JAAA,CAAA,UAAI;wCAAC,MAAM,CAAC,UAAU,EAAE,QAAQ,UAAU,EAAE;wCAAE,WAAU;kDACvD,cAAA,6LAAC;4CAAO,WAAU;;8DAChB,6LAAC,mMAAA,CAAA,MAAG;oDAAC,MAAM;oDAAI,WAAU;;;;;;gDAAS;;;;;;;;;;;;kDAItC,6LAAC;wCACC,SAAS,IAAM,OAAO,IAAI,CAAC,CAAC,UAAU,EAAE,QAAQ,UAAU,CAAC,KAAK,CAAC;wCACjE,WAAU;;0DAEV,6LAAC,6MAAA,CAAA,QAAK;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAAS;;;;;;;;;;;;;;uBAvJhC,QAAQ,EAAE;;;;;;;;;uBA+JxB,CAAC,yBACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,uMAAA,CAAA,QAAK;wBAAC,WAAU;;;;;;kCACjB,6LAAC;wBAAG,WAAU;kCAA2C;;;;;;kCACzD,6LAAC;wBAAE,WAAU;kCACV,cAAc,eAAe,0CAA0C;;;;;;kCAE1E,6LAAC,+JAAA,CAAA,UAAI;wBAAC,MAAK;kCACT,cAAA,6LAAC;4BAAO,WAAU;sCAAkG;;;;;;;;;;;;;;;;;YAS3H,gBAAgB,oBACf,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAE,WAAU;;4BAAkC;4BACpC,iBAAiB,MAAM;4BAAC;4BAAK;4BAAc;;;;;;;;;;;;;;;;;YAO3D,6CACC,6LAAC,uIAAA,CAAA,UAAc;gBACb,QAAQ;gBACR,SAAS;oBACP,sBAAsB;oBACtB,+BAA+B;gBACjC;gBACA,SAAS;gBACT,WAAW;;;;;;YAKd,6CACC,6LAAC,uIAAA,CAAA,UAAc;gBACb,QAAQ;gBACR,SAAS;oBACP,sBAAsB;oBACtB,+BAA+B;gBACjC;gBACA,SAAS;gBACT,oBAAoB;;;;;;;;;;;;AAK9B;GAxqBwB;;QACP,qIAAA,CAAA,YAAS;;;KADF","debugId":null}}]
}